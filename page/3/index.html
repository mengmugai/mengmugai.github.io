<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <link rel="dns-prefetch" href="http://yoursite.com">
  <title>萌木盖的博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="萌木盖的博客">
<meta property="og:url" content="http://yoursite.com/page/3/index.html">
<meta property="og:site_name" content="萌木盖的博客">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="萌木盖的博客">
  
    <link rel="alternative" href="/atom.xml" title="萌木盖的博客" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" type="text/css" href="/./main.0cf68a.css">
  <style type="text/css">
  
    #container.show {
      background: linear-gradient(200deg,#a0cfe4,#e8c37e);
    }
  </style>
  

  

</head>

<body>
  <div id="container" q-class="show:isCtnShow">
    <canvas id="anm-canvas" class="anm-canvas"></canvas>
    <div class="left-col" q-class="show:isShow">
      
<div class="overlay" style="background: #4d4d4d"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			<img src="/mmg.png" class="js-avatar">
		</a>
		<hgroup>
		  <h1 class="header-author"><a href="/">萌木盖</a></h1>
		</hgroup>
		
		<p class="header-subtitle">啦啦啦，搭这个博客快累死了~</p>
		

		<nav class="header-menu">
			<ul>
			
				<li><a href="/">主页</a></li>
	        
				<li><a href="https://space.bilibili.com/13894927/#/">B站</a></li>
	        
				<li><a href="/categories">分类</a></li>
	        
			</ul>
		</nav>
		<nav class="header-smart-menu">
    		
    			
    			<a q-on="click: openSlider(e, 'innerArchive')" href="javascript:void(0)">所有文章</a>
    			
            
    			
    			<a q-on="click: openSlider(e, 'friends')" href="javascript:void(0)">友链</a>
    			
            
    			
    			<a q-on="click: openSlider(e, 'aboutme')" href="javascript:void(0)">关于我</a>
    			
            
		</nav>
		<nav class="header-nav">
			<div class="social">
				
					<a class="github" target="_blank" href="https://github.com/mengmugai" title="github"><i class="icon-github"></i></a>
		        
					<a class="weibo" target="_blank" href="#" title="weibo"><i class="icon-weibo"></i></a>
		        
					<a class="rss" target="_blank" href="#" title="rss"><i class="icon-rss"></i></a>
		        
					<a class="zhihu" target="_blank" href="#" title="zhihu"><i class="icon-zhihu"></i></a>
		        
					<a class="qq" target="_blank" href="/188690805" title="qq"><i class="icon-qq"></i></a>
		        
					<a class="mail" target="_blank" href="/grmg@foxmail.com" title="mail"><i class="icon-mail"></i></a>
		        
			</div>
		</nav>
	</header>		
</div>

    </div>
    <div class="mid-col" q-class="show:isShow,hide:isShow|isFalse">
      
<nav id="mobile-nav">
  	<div class="overlay js-overlay" style="background: #4d4d4d"></div>
	<div class="btnctn js-mobile-btnctn">
  		<div class="slider-trigger list" q-on="click: openSlider(e)"><i class="icon icon-sort"></i></div>
	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img src="/mmg.png" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author js-header-author">萌木盖</h1>
			</hgroup>
			
			<p class="header-subtitle"><i class="icon icon-quo-left"></i>啦啦啦，搭这个博客快累死了~<i class="icon icon-quo-right"></i></p>
			
			
			
				
			
				
			
				
			
			
			
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/mengmugai" title="github"><i class="icon-github"></i></a>
			        
						<a class="weibo" target="_blank" href="#" title="weibo"><i class="icon-weibo"></i></a>
			        
						<a class="rss" target="_blank" href="#" title="rss"><i class="icon-rss"></i></a>
			        
						<a class="zhihu" target="_blank" href="#" title="zhihu"><i class="icon-zhihu"></i></a>
			        
						<a class="qq" target="_blank" href="/188690805" title="qq"><i class="icon-qq"></i></a>
			        
						<a class="mail" target="_blank" href="/grmg@foxmail.com" title="mail"><i class="icon-mail"></i></a>
			        
				</div>
			</nav>

			<nav class="header-menu js-header-menu">
				<ul style="width: 70%">
				
				
					<li style="width: 33.333333333333336%"><a href="/">主页</a></li>
		        
					<li style="width: 33.333333333333336%"><a href="https://space.bilibili.com/13894927/#/">B站</a></li>
		        
					<li style="width: 33.333333333333336%"><a href="/categories">分类</a></li>
		        
				</ul>
			</nav>
		</header>				
	</div>
	<div class="mobile-mask" style="display:none" q-show="isShow"></div>
</nav>

      <div id="wrapper" class="body-wrap">
        <div class="menu-l">
          <div class="canvas-wrap">
            <canvas data-colors="#eaeaea" data-sectionHeight="100" data-contentId="js-content" id="myCanvas1" class="anm-canvas"></canvas>
          </div>
          <div id="js-content" class="content-ll">
            
  
    <article id="post-aiohttp简易使用教程" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/08/22/aiohttp简易使用教程/">aiohttp简易使用教程</a>
    </h1>
  

        
        <a href="/2018/08/22/aiohttp简易使用教程/" class="archive-article-date">
  	<time datetime="2018-08-21T16:00:03.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2018-08-22</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="0-前言"><a href="#0-前言" class="headerlink" title="0. 前言"></a>0. 前言</h2><p>本文翻译自aiohttp的官方文档，如有纰漏，欢迎指出。</p>
<p>aiohttp分为服务器端和客户端，本文只介绍客户端。</p>
<p>另外我已经对 aiohttp 和 asyncio进行了封装，可以参考我的 github 地址：</p>
<p><a href="https://github.com/web-trump/ahttp" target="_blank" rel="noopener">https://github.com/web-trump/ahttp</a></p>
<p>由于上下文的缘故，请求代码必须在一个异步的函数中进行：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">fn</span><span class="params">()</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<ol>
<li>aiohttp安装</li>
</ol>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 <span class="keyword">install</span> aiohttp</span><br></pre></td></tr></table></figure>
<p>1.1. 基本请求用法</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">with</span> aiohttp.<span class="keyword">get</span>(<span class="string">'https://github.com'</span>) <span class="keyword">as</span> r:</span><br><span class="line">        <span class="keyword">await</span> r.text()</span><br></pre></td></tr></table></figure>
<p>其中r.text(), 可以在括号中指定解码方式，编码方式，例如</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">await resp.text(<span class="attribute">encoding</span>=<span class="string">'windows-1251'</span>)</span><br></pre></td></tr></table></figure>
<p>或者也可以选择不编码，适合读取图像等，是无法编码的</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">await resp.<span class="built_in">read</span>()</span><br></pre></td></tr></table></figure>
<h3 id="2-发起一个session请求"><a href="#2-发起一个session请求" class="headerlink" title="2.发起一个session请求"></a>2.发起一个session请求</h3><p>首先是导入aiohttp模块：</p>
<figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> aiohttp</span><br></pre></td></tr></table></figure>
<p>然后我们试着获取一个web源码，这里以GitHub的公共Time-line页面为例:</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">with</span> aiohttp.ClientSession() <span class="keyword">as</span> session:</span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">with</span> session.<span class="keyword">get</span>(<span class="string">'https://api.github.com/events'</span>) <span class="keyword">as</span> resp:</span><br><span class="line">        <span class="built_in">print</span>(resp.status)</span><br><span class="line">        <span class="built_in">print</span>(<span class="keyword">await</span> resp.text())</span><br></pre></td></tr></table></figure>
<p>上面的代码中，我们创建了一个 ClientSession 对象命名为session，然后通过session的get方法得到一个 ClientResponse 对象，命名为resp，get方法中传入了一个必须的参数url，就是要获得源码的http url。至此便通过协程完成了一个异步IO的get请求。</p>
<p>有get请求当然有post请求，并且post请求也是一个协程：</p>
<figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">session</span>.post('http://httpbin.org/post', <span class="class"><span class="keyword">data</span>=b'<span class="keyword">data</span>')</span></span><br></pre></td></tr></table></figure>
<p>用法和get是一样的，区别是post需要一个额外的参数data，即是需要post的数据。</p>
<p>除了get和post请求外，其他http的操作方法也是一样的：</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">session</span><span class="selector-class">.put</span>(<span class="string">'http://httpbin.org/put'</span>, data=b<span class="string">'data'</span>)</span><br><span class="line"><span class="selector-tag">session</span><span class="selector-class">.delete</span>(<span class="string">'http://httpbin.org/delete'</span>)</span><br><span class="line"><span class="selector-tag">session</span><span class="selector-class">.head</span>(<span class="string">'http://httpbin.org/get'</span>)</span><br><span class="line"><span class="selector-tag">session</span><span class="selector-class">.options</span>(<span class="string">'http://httpbin.org/get'</span>)</span><br><span class="line"><span class="selector-tag">session</span><span class="selector-class">.patch</span>(<span class="string">'http://httpbin.org/patch'</span>, data=b<span class="string">'data'</span>)</span><br></pre></td></tr></table></figure>
<p>小记：<br>不要为每次的连接都创建一次session,一般情况下只需要创建一个session，然后使用这个session执行所有的请求。</p>
<p>每个session对象，内部包含了一个连接池，并且将会保持连接和连接复用（默认开启）可以加快整体的性能。</p>
<h3 id="3-在URL中传递参数"><a href="#3-在URL中传递参数" class="headerlink" title="3.在URL中传递参数"></a>3.在URL中传递参数</h3><p>我们经常需要通过 get 在url中传递一些参数，参数将会作为url问号后面的一部分发给服务器。在aiohttp的请求中，允许以dict的形式来表示问号后的参数。举个例子，如果你想传递 key1=value1   key2=value2 到 httpbin.org/get 你可以使用下面的代码：</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">params</span> = &#123;<span class="string">'key1'</span>: <span class="string">'value1'</span>, <span class="string">'key2'</span>: <span class="string">'value2'</span>&#125;</span><br><span class="line"><span class="keyword">async</span> with session.<span class="keyword">get</span>(<span class="string">'http://httpbin.org/get'</span>,</span><br><span class="line">                       <span class="keyword">params</span>=<span class="keyword">params</span>) <span class="keyword">as</span> resp:</span><br><span class="line">                       assert resp.url == <span class="string">'http://httpbin.org/get?key2=value2&amp;key1=value1'</span></span><br></pre></td></tr></table></figure>
<p>可以看到，代码正确的执行了，说明参数被正确的传递了进去。不管是一个参数两个参数，还是更多的参数，都可以通过这种方式来传递。除了这种方式之外，还有另外一个，使用一个 list 来传递（这种方式可以传递一些特殊的参数，例如下面两个key是相等的也可以正确传递）：</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">params</span> = [(<span class="string">'key'</span>, <span class="string">'value1'</span>), (<span class="string">'key'</span>, <span class="string">'value2'</span>)]</span><br><span class="line"><span class="keyword">async</span> with session.<span class="keyword">get</span>(<span class="string">'http://httpbin.org/get'</span>,</span><br><span class="line">                       <span class="keyword">params</span>=<span class="keyword">params</span>) <span class="keyword">as</span> r:</span><br><span class="line">    assert r.url == <span class="string">'http://httpbin.org/get?key=value2&amp;key=value1'</span></span><br></pre></td></tr></table></figure>
<p>除了上面两种，我们也可以直接通过传递字符串作为参数来传递，但是需要注意，通过字符串传递的特殊字符不会被编码：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">with</span> session.<span class="keyword">get</span>(<span class="string">'http://httpbin.org/get'</span>,</span><br><span class="line">                       params=<span class="string">'key=value+1'</span>) <span class="keyword">as</span> r:</span><br><span class="line">        <span class="keyword">assert</span> r.url == <span class="string">'http://httpbin.org/get?key=value+1'</span></span><br></pre></td></tr></table></figure>
<h3 id="4-响应的内容"><a href="#4-响应的内容" class="headerlink" title="4.响应的内容"></a>4.响应的内容</h3><p>还是以GitHub的公共Time-line页面为例，我们可以获得页面响应的内容：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">with</span> session.<span class="keyword">get</span>(<span class="string">'https://api.github.com/events'</span>) <span class="keyword">as</span> resp:</span><br><span class="line">    <span class="built_in">print</span>(<span class="keyword">await</span> resp.text())</span><br></pre></td></tr></table></figure>
<p>运行之后，会打印出类似于如下的内容：</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">'[&#123;<span class="string">"created_at"</span>:<span class="string">"2015-06-12T14:06:22Z"</span>,<span class="string">"public"</span>:<span class="literal">true</span>,<span class="string">"actor"</span>:&#123;...</span><br></pre></td></tr></table></figure>
<p>resp的text方法，会自动将服务器端返回的内容进行解码–decode，当然我们也可以自定义编码方式：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">await resp.text(<span class="attribute">encoding</span>=<span class="string">'gb2312'</span>)</span><br></pre></td></tr></table></figure>
<p>除了text方法可以返回解码后的内容外，我们也可以得到类型是字节的内容：</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="name">await</span> resp.read())</span><br></pre></td></tr></table></figure>
<p>运行的结果是：</p>
<figure class="highlight sml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b'[&#123;<span class="string">"created_at"</span>:<span class="string">"2015-06-12T14:06:22Z"</span>,<span class="string">"public"</span>:<span class="literal">true</span>,<span class="string">"actor"</span>:&#123;...</span><br></pre></td></tr></table></figure>
<p>gzip和deflate转换编码已经为你自动解码。</p>
<p>小记：</p>
<p>text(),read()方法是把整个响应体读入内存，如果你是获取大量的数据，请考虑使用”字节流“（streaming response）</p>
<h3 id="5-特殊响应内容：json"><a href="#5-特殊响应内容：json" class="headerlink" title="5.特殊响应内容：json"></a>5.特殊响应内容：json</h3><p>如果我们获取的页面的响应内容是json，aiohttp内置了更好的方法来处理json:</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">with</span> session.<span class="keyword">get</span>(<span class="string">'https://api.github.com/events'</span>) <span class="keyword">as</span> resp:</span><br><span class="line">    <span class="built_in">print</span>(<span class="keyword">await</span> resp.json())</span><br></pre></td></tr></table></figure>
<p>如果因为某种原因而导致resp.json()解析json失败，例如返回不是json字符串等等，那么resp.json()将抛出一个错误，也可以给json()方法指定一个解码方式：</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="name">await</span> resp.json(</span><br><span class="line">encoding='gb2312'))</span><br></pre></td></tr></table></figure>
<p> 或者传递一个函数进去：</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="name">await</span> resp.json( <span class="name">lambda</span>(<span class="name">x</span><span class="symbol">:x</span>.replace('a','b')) ))</span><br></pre></td></tr></table></figure>
<h3 id="6-以字节流的方式读取响应内容"><a href="#6-以字节流的方式读取响应内容" class="headerlink" title="6.以字节流的方式读取响应内容"></a>6.以字节流的方式读取响应内容</h3><p>虽然json(),text(),read()很方便的能把响应的数据读入到内存，但是我们仍然应该谨慎的使用它们，因为它们是把整个的响应体全部读入了内存。即使你只是想下载几个字节大小的文件，但这些方法却将在内存中加载所有的数据。所以我们可以通过控制字节数来控制读入内存的响应内容：</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> with session.<span class="keyword">get</span>(<span class="string">'https://api.github.com/events'</span>) <span class="keyword">as</span> resp:</span><br><span class="line">    <span class="keyword">await</span> resp.content.read(<span class="number">10</span>) <span class="meta">#读取前10个字节</span></span><br></pre></td></tr></table></figure>
<p>一般地，我们应该使用以下的模式来把读取的字节流保存到文件中：</p>
<figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> open(filename, <span class="string">'wb'</span>) <span class="keyword">as</span> fd:</span><br><span class="line">    <span class="keyword">while</span> True:</span><br><span class="line">        chunk = await resp.content.<span class="keyword">read</span>(chunk_size)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> chunk:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        fd.<span class="keyword">write</span>(chunk)</span><br></pre></td></tr></table></figure>
<p>7.自定义请求头</p>
<p>如果你想添加请求头，可以像get添加参数那样以dict的形式，作为get或者post的参数进行请求：</p>
<figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="title">url</span> = 'https://api.github.com/some/endpoint'</span><br><span class="line"><span class="title">payload</span> = &#123;'some': '<span class="class"><span class="keyword">data</span>'&#125;</span></span><br><span class="line"><span class="title">headers</span> = &#123;'content-<span class="class"><span class="keyword">type</span>': 'application/json'&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="title">await</span> session.post(url,</span><br><span class="line">                   <span class="class"><span class="keyword">data</span>=json.dumps(<span class="title">payload</span>),</span></span><br><span class="line">                   headers=headers)</span><br></pre></td></tr></table></figure>
<p>8.自定义Cookie</p>
<p>给服务器发送cookie，可以通过给 ClientSession 传递一个cookie参数：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">url = <span class="string">'http://httpbin.org/cookies'</span></span><br><span class="line">cookies = &#123;<span class="string">'cookies_are'</span>: <span class="string">'working'</span>&#125;</span><br><span class="line"><span class="keyword">async</span> <span class="keyword">with</span> ClientSession(cookies=cookies) <span class="keyword">as</span> session:</span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">with</span> session.<span class="keyword">get</span>(url) <span class="keyword">as</span> resp:</span><br><span class="line">        <span class="keyword">assert</span> <span class="keyword">await</span> resp.json() == &#123;</span><br><span class="line">           <span class="string">"cookies"</span>: &#123;<span class="string">"cookies_are"</span>: <span class="string">"working"</span>&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>可直接访问链接 “httpbin.org/cookies”查看当前cookie，访问session中的cookie请见第10节。</p>
<h3 id="9-post数据的几种方式"><a href="#9-post数据的几种方式" class="headerlink" title="9.post数据的几种方式"></a>9.post数据的几种方式</h3><ul>
<li>（1）模拟表单post数据</li>
</ul>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">payload = &#123;<span class="string">'key1'</span>: <span class="string">'value1'</span>, <span class="string">'key2'</span>: <span class="string">'value2'</span>&#125;</span><br><span class="line"><span class="keyword">async</span> <span class="keyword">with</span> session.post(<span class="string">'http://httpbin.org/post'</span>,</span><br><span class="line">                        data=payload) <span class="keyword">as</span> resp:</span><br><span class="line">    <span class="built_in">print</span>(<span class="keyword">await</span> resp.text())</span><br></pre></td></tr></table></figure>
<p>注意：data=dict的方式post的数据将被转码，和form提交数据是一样的作用，如果你不想被转码，可以直接以字符串的形式 data=str 提交，这样就不会被转码。</p>
<ul>
<li>（2）post json</li>
</ul>
<figure class="highlight qml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="built_in">url</span> = <span class="string">'https://api.github.com/some/endpoint'</span></span><br><span class="line">payload = &#123;<span class="string">'some'</span>: <span class="string">'data'</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">with</span> session.post(<span class="built_in">url</span>, data=json.dumps(payload)) <span class="keyword">as</span> <span class="attribute">resp</span>:</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>
<p>其实json.dumps(payload)返回的也是一个字符串，只不过这个字符串可以被识别为json格式</p>
<ul>
<li>（3）post 小文件</li>
</ul>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">url = <span class="string">'http://httpbin.org/post'</span></span><br><span class="line">files = &#123;<span class="string">'file'</span>: <span class="keyword">open</span>(<span class="string">'report.xls'</span>, <span class="string">'rb'</span>)&#125;</span><br><span class="line"></span><br><span class="line">await session.post(url, <span class="keyword">data</span>=files)</span><br><span class="line">可以设置好文件名和content-type:</span><br><span class="line">url = <span class="string">'http://httpbin.org/post'</span></span><br><span class="line"><span class="keyword">data</span> = FormData()</span><br><span class="line"><span class="keyword">data</span>.add_field(<span class="string">'file'</span>,</span><br><span class="line">               <span class="keyword">open</span>(<span class="string">'report.xls'</span>, <span class="string">'rb'</span>),</span><br><span class="line">               filename=<span class="string">'report.xls'</span>,</span><br><span class="line">               content_type=<span class="string">'application/vnd.ms-excel'</span>)</span><br><span class="line"></span><br><span class="line">await session.post(url, <span class="keyword">data</span>=<span class="keyword">data</span>)</span><br></pre></td></tr></table></figure>
<p>如果将文件对象设置为数据参数，aiohttp将自动以字节流的形式发送给服务器。</p>
<ul>
<li>（4）post 大文件</li>
</ul>
<p>aiohttp支持多种类型的文件以流媒体的形式上传，所以我们可以在文件未读入内存的情况下发送大文件。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@aiohttp.streamer</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">file_sender</span><span class="params">(writer, file_name=None)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(file_name, <span class="string">'rb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        chunk = f.read(<span class="number">2</span>**<span class="number">16</span>)</span><br><span class="line">        <span class="keyword">while</span> chunk:</span><br><span class="line">            <span class="keyword">yield</span> <span class="keyword">from</span> writer.write(chunk)</span><br><span class="line">            chunk = f.read(<span class="number">2</span>**<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Then you can use `file_sender` as a data provider:</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">with</span> session.post(<span class="string">'http://httpbin.org/post'</span>,</span><br><span class="line">                        data=file_sender(file_name=<span class="string">'huge_file'</span>)) <span class="keyword">as</span> resp:</span><br><span class="line">    print(<span class="keyword">await</span> resp.text())</span><br></pre></td></tr></table></figure>
<p>同时我们可以从一个url获取文件后，直接post给另一个url，并计算hash值:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">feed_stream</span><span class="params">(resp, stream)</span>:</span></span><br><span class="line">    h = hashlib.sha256()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">        chunk = <span class="keyword">await</span> resp.content.readany()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> chunk:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        h.update(chunk)</span><br><span class="line">        stream.feed_data(chunk)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> h.hexdigest()</span><br><span class="line"></span><br><span class="line">resp = session.get(<span class="string">'http://httpbin.org/post'</span>)</span><br><span class="line">stream = StreamReader()</span><br><span class="line">loop.create_task(session.post(<span class="string">'http://httpbin.org/post'</span>, data=stream))</span><br></pre></td></tr></table></figure>
<p>file_hash = await feed_stream(resp, stream)<br>因为响应内容类型是StreamReader，所以可以把get和post连接起来，同时进行post和get：</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">r = <span class="keyword">await</span> session.<span class="keyword">get</span>(<span class="string">'http://python.org'</span>)</span><br><span class="line"><span class="keyword">await</span> session.post(<span class="string">'http://httpbin.org/post'</span>,</span><br><span class="line">                   data=r.content)</span><br></pre></td></tr></table></figure>
<ul>
<li>（5）post预压缩数据<br>在通过aiohttp发送前就已经压缩的数据, 调用压缩函数的函数名（通常是deflate 或 zlib）作为content-encoding的值：</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">my_coroutine</span><span class="params">(session, headers, my_data)</span>:</span></span><br><span class="line">    data = zlib.compress(my_data)</span><br><span class="line">    headers = &#123;<span class="string">'Content-Encoding'</span>: <span class="string">'deflate'</span>&#125;</span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">with</span> session.post(<span class="string">'http://httpbin.org/post'</span>,</span><br><span class="line">                            data=data,</span><br><span class="line">                            headers=headers)</span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<h3 id="10-keep-alive-连接池，共享cookie"><a href="#10-keep-alive-连接池，共享cookie" class="headerlink" title="10.keep-alive, 连接池，共享cookie"></a>10.keep-alive, 连接池，共享cookie</h3><p>ClientSession 用于在多个连接之间共享cookie：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">with</span> aiohttp.ClientSession() <span class="keyword">as</span> session:</span><br><span class="line">    <span class="keyword">await</span> session.<span class="keyword">get</span>(</span><br><span class="line">        <span class="string">'http://httpbin.org/cookies/set?my_cookie=my_value'</span>)</span><br><span class="line">    filtered = session.cookie_jar.filter_cookies(<span class="string">'http://httpbin.org'</span>)</span><br><span class="line">    <span class="keyword">assert</span> filtered[<span class="string">'my_cookie'</span>].value == <span class="string">'my_value'</span></span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">with</span> session.<span class="keyword">get</span>(<span class="string">'http://httpbin.org/cookies'</span>) <span class="keyword">as</span> r:</span><br><span class="line">        json_body = <span class="keyword">await</span> r.json()</span><br><span class="line">        <span class="keyword">assert</span> json_body[<span class="string">'cookies'</span>][<span class="string">'my_cookie'</span>] == <span class="string">'my_value'</span></span><br></pre></td></tr></table></figure>
<p>也可以为所有的连接设置共同的请求头：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">with</span> aiohttp.ClientSession(</span><br><span class="line">    headers=&#123;<span class="string">"Authorization"</span>: <span class="string">"Basic bG9naW46cGFzcw=="</span>&#125;) <span class="keyword">as</span> session:</span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">with</span> session.<span class="keyword">get</span>(<span class="string">"http://httpbin.org/headers"</span>) <span class="keyword">as</span> r:</span><br><span class="line">        json_body = <span class="keyword">await</span> r.json()</span><br><span class="line">        <span class="keyword">assert</span> json_body[<span class="string">'headers'</span>][<span class="string">'Authorization'</span>] == \</span><br><span class="line">            <span class="string">'Basic bG9naW46cGFzcw=='</span></span><br></pre></td></tr></table></figure>
<p>ClientSession 还支持 keep-alive连接和连接池(connection pooling)</p>
<h3 id="11-cookie安全性"><a href="#11-cookie安全性" class="headerlink" title="11.cookie安全性"></a>11.cookie安全性</h3><p>默认ClientSession使用的是严格模式的 aiohttp.CookieJar. RFC 2109，明确的禁止接受url和ip地址产生的cookie，只能接受 DNS 解析IP产生的cookie。可以通过设置aiohttp.CookieJar 的 unsafe=True 来配置：</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">jar</span> = aiohttp.CookieJar(unsafe=<span class="literal">True</span>)</span><br><span class="line"><span class="attr">session</span> = aiohttp.ClientSession(cookie_jar=jar)</span><br></pre></td></tr></table></figure>
<h3 id="12-控制同时连接的数量（连接池）"><a href="#12-控制同时连接的数量（连接池）" class="headerlink" title="12.控制同时连接的数量（连接池）"></a>12.控制同时连接的数量（连接池）</h3><p>也可以理解为同时请求的数量，为了限制同时打开的连接数量，我们可以将限制参数传递给连接器：</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conn = aiohttp.TCPConnector(limit=<span class="number">30</span>)#同时最大进行连接的连接数为<span class="number">30</span>，默认是<span class="number">100</span>，limit=<span class="number">0</span>的时候是无限制</span><br></pre></td></tr></table></figure>
<p>限制同时打开限制同时打开连接到同一端点的数量（(host, port, is_ssl) 三的倍数），可以通过设置 limit_per_host 参数：</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conn = aiohttp.TCPConnector(limit_per_host=30)<span class="comment">#默认是0</span></span><br></pre></td></tr></table></figure>
<h3 id="13-自定义域名解析"><a href="#13-自定义域名解析" class="headerlink" title="13.自定义域名解析"></a>13.自定义域名解析</h3><p>我们可以指定域名服务器的 IP 对我们提供的get或post的url进行解析：</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">from aiohttp.resolver import AsyncResolver</span><br><span class="line"></span><br><span class="line">resolver = AsyncResolver(nameservers=[<span class="string">"8.8.8.8"</span>, <span class="string">"8.8.4.4"</span>])</span><br><span class="line">conn = aiohttp.TCPConnector(resolver=resolver)</span><br></pre></td></tr></table></figure>
<h3 id="14-设置代理"><a href="#14-设置代理" class="headerlink" title="14.设置代理"></a>14.设置代理</h3><p>aiohttp支持使用代理来访问网页：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">with</span> aiohttp.ClientSession() <span class="keyword">as</span> session:</span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">with</span> session.<span class="keyword">get</span>(<span class="string">"http://python.org"</span>,</span><br><span class="line">                           proxy=<span class="string">"http://some.proxy.com"</span>) <span class="keyword">as</span> resp:</span><br><span class="line">        <span class="built_in">print</span>(resp.status)</span><br></pre></td></tr></table></figure>
<p>当然也支持需要授权的页面：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">with</span> aiohttp.ClientSession() <span class="keyword">as</span> session:</span><br><span class="line">    proxy_auth = aiohttp.BasicAuth(<span class="string">'user'</span>, <span class="string">'pass'</span>)</span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">with</span> session.<span class="keyword">get</span>(<span class="string">"http://python.org"</span>,</span><br><span class="line">                           proxy=<span class="string">"http://some.proxy.com"</span>,</span><br><span class="line">                           proxy_auth=proxy_auth) <span class="keyword">as</span> resp:</span><br><span class="line">        <span class="built_in">print</span>(resp.status)</span><br></pre></td></tr></table></figure>
<p>或者通过这种方式来验证授权：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">session.<span class="builtin-name">get</span>(<span class="string">"http://python.org"</span>,</span><br><span class="line">            <span class="attribute">proxy</span>=<span class="string">"http://user:pass@some.proxy.com"</span>)</span><br></pre></td></tr></table></figure>
<h3 id="15-响应状态码-response-status-code"><a href="#15-响应状态码-response-status-code" class="headerlink" title="15.响应状态码 response status code"></a>15.响应状态码 response status code</h3><p>可以通过 resp.status来检查状态码是不是200：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">with</span> session.<span class="keyword">get</span>(<span class="string">'http://httpbin.org/get'</span>) <span class="keyword">as</span> resp:</span><br><span class="line">    <span class="keyword">assert</span> resp.status == <span class="number">200</span></span><br></pre></td></tr></table></figure>
<h3 id="16-响应头"><a href="#16-响应头" class="headerlink" title="16.响应头"></a>16.响应头</h3><p>我们可以直接使用　resp.headers 来查看响应头，得到的值类型是一个dict：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;</span>&gt; resp.headers</span><br><span class="line">&#123;<span class="string">'ACCESS-CONTROL-ALLOW-ORIGIN'</span>: <span class="string">'*'</span>,</span><br><span class="line"> <span class="string">'CONTENT-TYPE'</span>: <span class="string">'application/json'</span>,</span><br><span class="line"> <span class="string">'DATE'</span>: <span class="string">'Tue, 15 Jul 2014 16:49:51 GMT'</span>,</span><br><span class="line"> <span class="string">'SERVER'</span>: <span class="string">'gunicorn/18.0'</span>,</span><br><span class="line"> <span class="string">'CONTENT-LENGTH'</span>: <span class="string">'331'</span>,</span><br><span class="line"> <span class="string">'CONNECTION'</span>: <span class="string">'keep-alive'</span>&#125;</span><br></pre></td></tr></table></figure>
<p>或者我们可以查看原生的响应头：</p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; resp.raw_headers</span><br><span class="line">((b'SERVER', b'nginx'),</span><br><span class="line"> (b'DATE', b'Sat, <span class="number">09</span> Jan <span class="number">2016</span> <span class="number">20</span>:<span class="number">28</span>:<span class="number">40</span> GMT'),</span><br><span class="line"> (b'CONTENT-TYPE', b'text/html; charset=utf<span class="number">-8</span><span class="string">'),</span></span><br><span class="line"><span class="string"> (b'</span>CONTENT-LENGTH', b'<span class="number">12150</span><span class="string">'),</span></span><br><span class="line"><span class="string"> (b'</span>CONNECTION', b'keep-alive'))</span><br></pre></td></tr></table></figure>
<h3 id="17-查看cookie"><a href="#17-查看cookie" class="headerlink" title="17.查看cookie"></a>17.查看cookie</h3><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">url = <span class="string">'http://example.com/some/cookie/setting/url'</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">with</span> session.<span class="keyword">get</span>(url) <span class="keyword">as</span> resp:</span><br><span class="line">    <span class="built_in">print</span>(resp.cookies)</span><br></pre></td></tr></table></figure>
<h3 id="18-重定向的响应头"><a href="#18-重定向的响应头" class="headerlink" title="18.重定向的响应头"></a>18.重定向的响应头</h3><p>如果一个请求被重定向了，我们依然可以查看被重定向之前的响应头信息：</p>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; resp = await session.<span class="built_in">get</span>('http://<span class="built_in">example</span>.com/<span class="built_in">some</span>/redirect/')</span><br><span class="line">&gt;&gt;&gt; resp</span><br><span class="line">&lt;ClientResponse(http://<span class="built_in">example</span>.com/<span class="built_in">some</span>/other/url/) [<span class="number">200</span>]&gt;</span><br><span class="line">&gt;&gt;&gt; resp.history</span><br><span class="line">(&lt;ClientResponse(http://<span class="built_in">example</span>.com/<span class="built_in">some</span>/redirect/) [<span class="number">301</span>]&gt;,)</span><br></pre></td></tr></table></figure>
<h3 id="19-超时处理"><a href="#19-超时处理" class="headerlink" title="19.超时处理"></a>19.超时处理</h3><p>默认的IO操作都有5分钟的响应时间 我们可以通过 timeout 进行重写：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">with</span> session.<span class="keyword">get</span>(<span class="string">'https://github.com'</span>, timeout=<span class="number">60</span>) <span class="keyword">as</span> r:</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>
<p>如果 timeout=None 或者 timeout=0 将不进行超时检查，也就是不限时长。</p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color2">python</a>
        		</li>
      		 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color3">协程</a>
        		</li>
      		 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color3">aiohttp</a>
        		</li>
      		
		</ul>
	</div>

      
	<div class="article-category tagcloud">
		<i class="icon-book icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="/categories/爬虫//" class="article-tag-list-link color3">爬虫</a>
        		</li>
      		
		</ul>
	</div>


      
        <p class="article-more-link">
          <a class="article-more-a" href="/2018/08/22/aiohttp简易使用教程/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>





<!-- 目录内容 -->
             
        <!-- 目录内容结束 -->
  
    <article id="post-多线程，详细教程，线程同步，线程加锁，ThreadPoolExecutor" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/08/21/多线程，详细教程，线程同步，线程加锁，ThreadPoolExecutor/">python多线程，详细教程，线程同步，线程加锁，ThreadPoolExecutor</a>
    </h1>
  

        
        <a href="/2018/08/21/多线程，详细教程，线程同步，线程加锁，ThreadPoolExecutor/" class="archive-article-date">
  	<time datetime="2018-08-21T15:08:29.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2018-08-21</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="python-多线程的使用"><a href="#python-多线程的使用" class="headerlink" title="python 多线程的使用"></a>python 多线程的使用</h2><p>多线程主要用于大量的IO操作时的并发执行，以此来提高效率！多进程主要用于大量的计算，进而充分发挥CPU的性能！</p>
<p>这里主要讲述两种多线程的使用：</p>
<ol>
<li>threading.Thread</li>
<li>concurrent.futures.ThreadPoolExecutor</li>
</ol>
<p>使用第二种方式需要先安装（对于python2.x）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install futures</span><br></pre></td></tr></table></figure>
<h2 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h2><p>第一种方式的简单使用：(注意：空白行有删减)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding=utf8</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> concurrent</span><br><span class="line"><span class="keyword">from</span> concurrent.futures <span class="keyword">import</span> ThreadPoolExecutor</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">task</span><span class="params">()</span>:</span></span><br><span class="line">    url = <span class="string">"https://www.baidu.com"</span></span><br><span class="line">    res = requests.get(url)</span><br><span class="line">    <span class="keyword">if</span> res.status_code == <span class="number">200</span>:</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"yes!"</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"no!"</span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    t1 = threading.Thread(target=task)  <span class="comment"># 用法和Process类很相似</span></span><br><span class="line">    t2 = threading.Thread(target=task)</span><br><span class="line"> </span><br><span class="line">    t1.start()</span><br><span class="line">    t2.start()</span><br><span class="line">    t1.join()</span><br><span class="line">    t2.join()</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<h2 id="多线程的同步"><a href="#多线程的同步" class="headerlink" title="多线程的同步"></a>多线程的同步</h2><p>多线程的可以共享主线程的数据，在操作的时候可能会存在数据不同的问题解决办法是，对于一些代码加锁规定某段时间内只能一个线程访问，直到所被释放！</p>
<p>例子：这个会造成数据不同步</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">balance </span>= <span class="number">0</span></span><br><span class="line"> </span><br><span class="line">def data_operator(n):</span><br><span class="line">    global <span class="keyword">balance </span> <span class="comment"># 表明在这个函数中，balance 是使用的全局的</span></span><br><span class="line">    <span class="keyword">balance </span>+= n</span><br><span class="line">    <span class="keyword">balance </span>-= n</span><br><span class="line"> </span><br><span class="line">def change_it(n):</span><br><span class="line">    for item in xrange(<span class="number">0</span>, <span class="number">10</span> ** <span class="number">6</span>):</span><br><span class="line">        data_operator(n)</span><br><span class="line"> </span><br><span class="line">def thread_synchronization():</span><br><span class="line">    <span class="built_in">t1</span> = threading.Thread(target=change_it, args=(<span class="number">5</span>,))</span><br><span class="line">    <span class="built_in">t2</span> = threading.Thread(target=change_it, args=(<span class="number">8</span>,))</span><br><span class="line"> </span><br><span class="line">    <span class="built_in">t1</span>.start()</span><br><span class="line">    <span class="built_in">t2</span>.start()</span><br><span class="line">    <span class="built_in">t1</span>.<span class="keyword">join()</span></span><br><span class="line"><span class="keyword"> </span>   <span class="built_in">t2</span>.<span class="keyword">join()</span></span><br><span class="line"><span class="keyword"> </span>   global <span class="keyword">balance</span></span><br><span class="line"><span class="keyword"> </span>   print <span class="keyword">balance</span></span><br><span class="line"><span class="keyword"> </span>   <span class="comment"># 因为存在变量操作时存在临时变量的使用，在多次执行的时候，操作的数据内容可能存在不同步的情况</span></span><br><span class="line">    <span class="comment"># 所以此处打印出的值，不一定是0</span></span><br></pre></td></tr></table></figure>
<h3 id="加锁实现数据同步，确保操作关键数据时只有一个线程"><a href="#加锁实现数据同步，确保操作关键数据时只有一个线程" class="headerlink" title="加锁实现数据同步，确保操作关键数据时只有一个线程"></a>加锁实现数据同步，确保操作关键数据时只有一个线程</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">balance = <span class="number">0</span></span><br><span class="line">main_thread_lock = threading.Lock()  <span class="comment"># 这里是在主线程中设置的一把线程锁</span></span><br><span class="line"><span class="comment"># 获得锁 main_thread_lock.acquire() 这个方法或阻塞当前线程，直到获得一把锁。但是不会阻塞主线程</span></span><br><span class="line"><span class="comment"># 释放锁 main_thread_lock.release() 此时其他的方法可以去申请锁的使用</span></span><br><span class="line"><span class="comment"># 一般使用try_catch_finally 来确保锁被释放</span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">data_operator</span><span class="params">(n)</span>:</span></span><br><span class="line">    <span class="keyword">global</span> balance  <span class="comment"># 表明在这个函数中，balance 是使用的全局的</span></span><br><span class="line">    balance += n</span><br><span class="line">    balance -= n</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">change_it</span><span class="params">(n)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> xrange(<span class="number">0</span>, <span class="number">10</span> ** <span class="number">6</span>):</span><br><span class="line">        <span class="keyword">with</span> main_thread_lock:  <span class="comment"># 这里是在操作主要数据的时候，获得锁，在执行完操作之后将锁释放，这里使用with 语句更加简洁的实现，一定要注意锁的释放</span></span><br><span class="line">            data_operator(n)</span><br></pre></td></tr></table></figure>
<h2 id="使用ThreadPoolExecutor"><a href="#使用ThreadPoolExecutor" class="headerlink" title="使用ThreadPoolExecutor"></a>使用ThreadPoolExecutor</h2><p>使用ThreadPoolExecutor的时候，对于python2.x 需要先安装 pip install futures ，这是在python3中自带的包</p>
<p>基本使用：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> concurrent</span><br><span class="line"><span class="keyword">from</span> concurrent.futures <span class="keyword">import</span> ThreadPoolExecutor</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">task2</span><span class="params">(n)</span>:</span></span><br><span class="line">    url = <span class="string">"https://www.baidu.com"</span></span><br><span class="line">    res = requests.get(url)</span><br><span class="line">    <span class="keyword">print</span> n</span><br><span class="line">    <span class="keyword">if</span> res.status_code == <span class="number">200</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"yes!"</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"no!"</span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">multi_thread_by_thread_pool_executor</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># max_workers 最多使用的线程数量</span></span><br><span class="line">    <span class="keyword">with</span> ThreadPoolExecutor(max_workers=<span class="number">5</span>) <span class="keyword">as</span> executor:</span><br><span class="line">        task_list = [executor.submit(task2, x) <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">0</span>, <span class="number">10</span>)]</span><br><span class="line"> </span><br><span class="line">        <span class="comment"># 对结果的处理，as_completed 返回一个生成器，等待每一个任务完成的时候就会返回一个任务，参数是futures序列</span></span><br><span class="line">        <span class="comment"># item 表示的是Future对象</span></span><br><span class="line">        <span class="comment"># 使用 future.result 获取函数结果</span></span><br><span class="line">        <span class="keyword">for</span> item <span class="keyword">in</span> concurrent.futures.as_completed(task_list):</span><br><span class="line">            <span class="keyword">print</span> item.result()</span><br></pre></td></tr></table></figure>
<font color="#DC143C">不仅仅是对于线程有ThreadPoolExecutor, 对于进程而言，也就ProcessPoolExecutor,使用方式类似，只不过是名字改改</font>

<p>同时由于全局解释器锁的原因，即使很多的线程，CPU 也不能跑满，处分重构解释器，去掉GIL</p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color2">python</a>
        		</li>
      		 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color4">扩展包</a>
        		</li>
      		 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color4">多线程</a>
        		</li>
      		
		</ul>
	</div>

      
	<div class="article-category tagcloud">
		<i class="icon-book icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="/categories/python语言基础//" class="article-tag-list-link color1">python语言基础</a>
        		</li>
      		
		</ul>
	</div>


      
        <p class="article-more-link">
          <a class="article-more-a" href="/2018/08/21/多线程，详细教程，线程同步，线程加锁，ThreadPoolExecutor/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>





<!-- 目录内容 -->
             
        <!-- 目录内容结束 -->
  
    <article id="post-python-stdnum" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/08/21/python-stdnum/">python-stdnum</a>
    </h1>
  

        
        <a href="/2018/08/21/python-stdnum/" class="archive-article-date">
  	<time datetime="2018-08-21T14:55:52.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2018-08-21</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="python-stdnum"><a href="#python-stdnum" class="headerlink" title="python-stdnum"></a>python-stdnum</h2><p>这是一个Python库 ，旨在提供处理，解析和验证标准数字的函数。</p>
<p>该模块支持100多种不同的数字格式 ，其中包括大量增值税和其他税号，个人身份和公司识别码，国际标准号（ISBN，IBAN，EAN等）和各种其他格式。 </p>
<p>该模块还包括Verhoeff，Luhn和ISO / IEC 7064校验位算法系列的实现。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> stdnum <span class="keyword">import</span> isbn</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>isbn.validate(<span class="string">'978-9024538270'</span>)</span><br><span class="line"><span class="string">'9789024538270'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>isbn.validate(<span class="string">'978-9024538271'</span>)</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">    ...</span><br><span class="line">InvalidChecksum: ...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>isbn.format(<span class="string">'9780471117094'</span>)</span><br><span class="line"><span class="string">'978-0-471-11709-4'</span></span><br></pre></td></tr></table></figure>
<p>简单的代码例子：</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> stdnum <span class="keyword">import</span> luhn</span><br><span class="line"><span class="keyword">from</span> stdnum.cn <span class="keyword">import</span> ric</span><br><span class="line"><span class="comment"># 验证银行卡号，号来源百度</span></span><br><span class="line"><span class="built_in">print</span>(luhn.is_valid(<span class="string">"6217995200015424051"</span>))</span><br><span class="line"><span class="comment"># 验证身份证号，号来源百度</span></span><br><span class="line"><span class="built_in">print</span>(ric.is_valid(<span class="string">"360822198112069337"</span>))</span><br></pre></td></tr></table></figure>
<h3 id="支持的格式"><a href="#支持的格式" class="headerlink" title="支持的格式"></a>支持的格式</h3><p>目前python-stdnum模块支持以下格式：</p>
<ul>
<li>NIPT（增值税识别号码，阿尔巴尼亚增值税号码）</li>
<li>CBU（统一银行代码，阿根廷银行帐号）</li>
<li>CUIT（独特税务识别代码，阿根廷税号）</li>
<li>奥地利公司注册号码</li>
<li>邮政编码（奥地利邮政编码）</li>
<li>税号（奥地利税号）</li>
<li>UID（增值税识别号，奥地利增值税号）</li>
<li>ABN（澳大利亚商业号码）</li>
<li>ACN（澳大利亚公司编号）</li>
<li>TFN（澳大利亚税务档案号码）</li>
<li>比利时IBAN（国际银行账号）</li>
<li>VAT，TVA，NWSt，企业编号（比利时企业编号）</li>
<li>EGN（个人识别号码，保加利亚个人识别码）</li>
<li>PNF（PNH，外国人的个人号码，外国人的保加利亚号码）</li>
<li>增值税（保加利亚增值税号）</li>
<li>BIC（ISO 9362商业识别码）</li>
<li>CNPJ（国家商业注册，巴西公司标识符）</li>
<li>个人纳税人的身份证（CPF）（巴西国家标识符）</li>
<li>BN（加拿大商业号码）</li>
<li>SIN（加拿大社会保险号码）</li>
<li>CAS RN（化学文摘服务注册号）</li>
<li>瑞士社会安全号码（“Sozialversicherungsnummer”）</li>
<li>UID（公司标识号，瑞士商业标识符）</li>
<li>增值税，增值税，TVA，IVA，TPV（增值税号，瑞士增值税号）</li>
<li>RUT（RolÚnicoTributario，智利国家税号）</li>
<li>RIC号（中国居民身份证号码）</li>
<li>NIT（税号，哥伦比亚身份证）</li>
<li>CUSIP号码（财务安全识别号码）</li>
<li>增值税登记号码 （塞浦路斯增值税号）</li>
<li>税号（捷克增值税号）</li>
<li>RČ（出生人数，捷克出生人数）</li>
<li>Handelsregisternummer（德国公司注册号）</li>
<li>IdNr（税号，德国个人税号）</li>
<li>St.-Nr. （税号，德国税号）</li>
<li>增值税号码（销售税识别号码，德国增值税号码）</li>
<li>Wertpapierkennnummer（德国证券识别码）</li>
<li>CPR（personnummer，丹麦公民号码）</li>
<li>CVR（增值税登记号码）</li>
<li>Cedula（多米尼加共和国国民身份证号码）</li>
<li>NCF（财政证明号码，多米尼加共和国收据号码）</li>
<li>RNC（National Taxpayer Registry，多米尼加共和国税号）</li>
<li>EAN（国际商品编号）</li>
<li>CI（身份证，厄瓜多尔个人身份代码）</li>
<li>RUC（独特纳税人登记处，厄瓜多尔公司税号）</li>
<li>个人识别码（爱沙尼亚个人识别号码）</li>
<li>KMKR（增值税号，爱沙尼亚增值税号）</li>
<li>爱沙尼亚组织注册码</li>
<li>CCC（经常账户代码，西班牙银行账户代码）</li>
<li>CIF（税务证明书，西班牙公司税号）</li>
<li>CUPS（统一供应点代码，供应点统一代码）</li>
<li>DNI（国家身份证件，西班牙个人身份证）</li>
<li>西班牙IBAN（国际银行账号）</li>
<li>NIE（外国人身份证号码，西班牙外国人号码）</li>
<li>NIF（税号，西班牙增值税号）</li>
<li>Referencia Catastral（西班牙房地产物业ID）</li>
<li>SEPA的债权人标识符（AT-02）</li>
<li>欧元钞票序列号</li>
<li>EIC（欧洲能源识别代码）</li>
<li>NACE（欧盟企业分类）</li>
<li>增值税（欧盟增值税号）</li>
<li>增值税号（芬兰增值税号）</li>
<li>芬兰协会标识符</li>
<li>HETU（个人身份号码）</li>
<li>Veronumero（芬兰个人税号）</li>
<li>业务ID（芬兰业务标识符）</li>
<li>FIGI（金融工具全球标识符）</li>
<li>NIF（法国税务识别号码）</li>
<li>NIR（法国个人识别号码）</li>
<li>SIREN（法国公司识别号码）</li>
<li>SIRET（法国公司设立识别号码）</li>
<li>增值税号（增值税，法国增值税号）</li>
<li>NHS（英国国民健康服务患者标识符）</li>
<li>SEDOL号码（证券交易所每日官方列表编号）</li>
<li>UPN（英文独特的学生编号）</li>
<li>增值税（英国（和马恩岛）增值税登记号码）</li>
<li>FPA，增值税，增值税（希腊增值税号）</li>
<li>GRid（全球发布标识符）</li>
<li>OIB（个人识别号码，克罗地亚身份证号码）</li>
<li>ANUM（匈牙利增值税号）</li>
<li>IBAN（国际银行账号）</li>
<li>PPS否（个人公共服务号码，爱尔兰个人号码）</li>
<li>增值税（爱尔兰税号）</li>
<li>IMEI（国际移动设备识别码）</li>
<li>IMO号码（国际海事组织编号）</li>
<li>IMSI（国际移动用户识别码）</li>
<li>Aadhaar（印度数字居民个人身份号码）</li>
<li>PAN（永久帐号，印度所得税标识符）</li>
<li>Kennitala（冰岛个人和组织身份代码）</li>
<li>增值税号（增值税税）</li>
<li>ISAN（国际标准视听号码）</li>
<li>ISBN（国际标准书号）</li>
<li>伊黎伊斯兰国（图书馆的国际标准标识符）</li>
<li>ISIN（国际证券识别号码）</li>
<li>ISMN（国际标准音乐编号）</li>
<li>ISO 6346（容器识别的国际标准）</li>
<li>ISSN（国际标准序列号）</li>
<li>财政法典（个人意大利税法）</li>
<li>增值税号（意大利增值税号）</li>
<li>LEI（法律实体标识符）</li>
<li>增值税（增值税纳税人代码，立陶宛增值税号）</li>
<li>增值税（增值税，卢森堡增值税号）</li>
<li>增值税（增值税，拉脱维亚增值税号）</li>
<li>增值税号（增值税，Monacan增值税号）</li>
<li>黑山IBAN（国际银行帐号）</li>
<li>MEID（移动设备标识符）</li>
<li>增值税（马耳他增值税号）</li>
<li>RFC（联邦纳税人登记处，墨西哥税号）</li>
<li>身份证号码（马来西亚国家登记身份证号码）</li>
<li>布林号码（学校荷兰语号码）</li>
<li>BSN（国家公共服务号码，荷兰国家识别号码）</li>
<li>增值税号（销售税号，荷兰增值税号）</li>
<li>教育号码（荷兰学生学号）</li>
<li>邮政编码（荷兰邮政编码）</li>
<li>增值税（增值税，挪威增值税号）</li>
<li>Orgnr（组织编号，挪威组织编号）</li>
<li>NIP（税号，波兰增值税号）</li>
<li>PESEL（波兰国家身份证号码）</li>
<li>REGON（国民经济登记册，波兰经济单位登记册）</li>
<li>NIF（税号，葡萄牙增值税号）</li>
<li>CF（增值税登记号，罗马尼亚增值税号）</li>
<li>CNP（Cod Numeric Personal，罗马尼亚数字个人密码）</li>
<li>PIB（税号，塞尔维亚税号）</li>
<li>纳税人识别号码，俄罗斯税收识别码</li>
<li>Orgnr（组织编号，瑞典公司编号）</li>
<li>增值税（增值税，增值税，瑞典增值税号）</li>
<li>增值税号（增值税号，斯洛文尼亚增值税号）</li>
<li>增值税号（增值税增值税，斯洛伐克增值税号）</li>
<li>RČ（出生人数，斯洛伐克出生人数）</li>
<li>COE（经济运营商代码，圣马力诺国家税号）</li>
<li>TC Kimlik No.（土耳其个人识别号码）</li>
<li>ATIN（美国收养纳税人识别号码）</li>
<li>EIN（美国雇主识别号码）</li>
<li>ITIN（美国个人纳税人识别号码）</li>
<li>PTIN（美国编制者税务识别号码）</li>
<li>RTN（路由传输号码）</li>
<li>SSN（美国社会安全号码）</li>
<li>TIN（美国纳税人识别号码）</li>
</ul>
<p>此外，还提供了许多通用校验位算法：</p>
<ul>
<li>Verhoeff算法</li>
<li>达姆算法</li>
<li>Luhn和Luhn mod N算法</li>
<li>ISO / IEC 7064中描述的一些算法：Mod 11,2，Mod 37,2，Mod 97,10，Mod 11,10和Mod 37,36</li>
</ul>
<p><a href="https://arthurdejong.org/python-stdnum/doc/1.9/index.html" target="_blank" rel="noopener">详细文档</a></p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color2">python</a>
        		</li>
      		 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color4">扩展包</a>
        		</li>
      		
		</ul>
	</div>

      
	<div class="article-category tagcloud">
		<i class="icon-book icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="/categories/python语言基础//" class="article-tag-list-link color1">python语言基础</a>
        		</li>
      		
		</ul>
	</div>


      
        <p class="article-more-link">
          <a class="article-more-a" href="/2018/08/21/python-stdnum/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>





<!-- 目录内容 -->
             
        <!-- 目录内容结束 -->
  
    <article id="post-MySql优化" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/07/18/MySql优化/">MySql优化</a>
    </h1>
  

        
        <a href="/2018/07/18/MySql优化/" class="archive-article-date">
  	<time datetime="2018-07-18T15:18:22.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2018-07-18</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="MySQL优化三大方向"><a href="#MySQL优化三大方向" class="headerlink" title="MySQL优化三大方向"></a>MySQL优化三大方向</h4><ul>
<li>① 优化MySQL所在服务器内核(此优化一般由运维人员完成)。</li>
<li>② 对MySQL配置参数进行优化（my.cnf）此优化需要进行压力测试来进行参数调整。</li>
<li>③ 对SQL语句以及表优化。<h4 id="MySQL参数优化"><a href="#MySQL参数优化" class="headerlink" title="MySQL参数优化"></a>MySQL参数优化</h4></li>
<li>1:MySQL 默认的最大连接数为 100，可以在 mysql 客户端使用以下命令查看<br>mysql&gt; show variables like ‘max_connections’;</li>
<li>2:查看当前访问Mysql的线程<br>mysql&gt; show processlist;</li>
<li>3:设置最大连接数<br>mysql&gt;set globle max_connections = 5000;<br>最大可设置16384,超过没用</li>
<li>4:查看当前被使用的connections<br>mysql&gt;show globle status like ‘max_user_connections’<h4 id="对MySQL语句性能优化的16条经验"><a href="#对MySQL语句性能优化的16条经验" class="headerlink" title="对MySQL语句性能优化的16条经验"></a>对MySQL语句性能优化的16条经验</h4></li>
<li>① 为查询缓存优化查询</li>
<li>② EXPLAIN 我们的SELECT查询(可以查看执行的行数)</li>
<li>③ 当只要一行数据时使用LIMIT 1</li>
<li>④ 为搜索字段建立索引</li>
<li>⑤ 在Join表的时候使用相当类型的列，并将其索引</li>
<li>⑥ 千万不要 ORDER BY RAND  ()</li>
<li>⑦ 避免SELECT *</li>
<li>⑧ 永远为每张表设置一个ID</li>
<li>⑨ 可以使用ENUM 而不要VARCHAR</li>
<li>⑩ 尽可能的使用NOT NULL</li>
<li>⑪ 固定长度的表会更快</li>
<li>⑫ 垂直分割</li>
<li>⑬ 拆分打的DELETE或INSERT语句</li>
<li>⑭ 越小的列会越快</li>
<li>⑮ 选择正确的存储引擎</li>
<li>⑯ 小心 “永久链接”</li>
</ul>
<p>具体描述如下：</p>
<h3 id="一-使用查询缓存优化查询"><a href="#一-使用查询缓存优化查询" class="headerlink" title="(一) 使用查询缓存优化查询"></a>(一) 使用查询缓存优化查询</h3><p>大多数的MySQL服务器都开启了查询缓存。这是提高性能最有效的方法之一，而且这是被MySQL引擎处理的。当有很多相同的查询被执行了多次的时候，这些查询结果会被放入一个缓存中，这样后续的相同查询就不用操作而直接访问缓存结果了。<br>这里最主要的问题是，对于我们程序员来说，这个事情是很容易被忽略的。因为我们某些查询语句会让MySQL不使用缓存，示例如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1：<span class="keyword">SELECT</span> username <span class="keyword">FROM</span> <span class="keyword">user</span> <span class="keyword">WHERE</span>    signup_date &gt;= <span class="keyword">CURDATE</span>()</span><br><span class="line"><span class="number">2</span>：<span class="keyword">SELECT</span> username <span class="keyword">FROM</span> <span class="keyword">user</span> <span class="keyword">WHERE</span>    signup_date &gt;= <span class="string">'2014-06-24‘</span></span><br></pre></td></tr></table></figure>
<p>上面两条SQL语句的差别就是 CURDATE() ，MySQL的查询缓存对这个函数不起作用。所以，像 NOW() 和 RAND() 或是其它的诸如此类的SQL函数都不会开启查询缓存，因为这些函数的返回是会不定的易变的。所以，你所需要的就是用一个变量来代替MySQL的函数，从而开启缓存。</p>
<h3 id="二-使用EXPLAIN关键字检测查询"><a href="#二-使用EXPLAIN关键字检测查询" class="headerlink" title="(二) 使用EXPLAIN关键字检测查询"></a>(二) 使用EXPLAIN关键字检测查询</h3><p>使用EXPLAIN关键字可以使我们知道MySQL是如何处理SQL语句的，这样可以帮助我们分析我们的查询语句或是表结构的性能瓶颈；EXPLAIN的查询结果还会告诉我们索引主键是如何被利用的，数据表是如何被被搜索或排序的….等等。语法格式是：EXPLAIN +SELECT语句;<br><img src="https://img-blog.csdn.net/20170909001604837?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvdTAxMzA4NzUxMw==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="image"><br>我们可以看到，前一个结果显示搜索了 7883 行，而后一个只是搜索了两个表的 9 和 16 行。查看rows列可以让我们找到潜在的性能问题。 </p>
<h3 id="三-当只要一行数据时使用LIMIT-1"><a href="#三-当只要一行数据时使用LIMIT-1" class="headerlink" title="(三)当只要一行数据时使用LIMIT 1"></a>(三)当只要一行数据时使用LIMIT 1</h3><p>加上LIMIT 1可以增加性能。MySQL数据库引擎会在查找到一条数据后停止搜索，而不是继续往后查询下一条符合条件的数据记录。</p>
<h3 id="四-为搜索字段建立索引"><a href="#四-为搜索字段建立索引" class="headerlink" title="(四)为搜索字段建立索引"></a>(四)为搜索字段建立索引</h3><p>索引不一定就是给主键或者是唯一的字段，如果在表中，有某个字段经常用来做搜索，需要将其建立索引。<br>索引的有关操作如下：</p>
<ul>
<li>1.创建索引<br>在执行CREATE TABLE语句时可以创建索引，也可以单独用CREATE INDEX或ALTER TABLE来为表增加索引。<ul>
<li>1.1&gt; ALTER TABLE<br>ALTER TABLE 用来创建普通索引、唯一索引、主键索引和全文索引</li>
</ul>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name <span class="keyword">ADD</span> <span class="keyword">INDEX</span> index_name (column_list);</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name <span class="keyword">ADD</span> <span class="keyword">UNIQUE</span> (column_list);</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name <span class="keyword">ADD</span> PRIMARY <span class="keyword">KEY</span> (column_list);</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name <span class="keyword">ADD</span> FULLTEXT (column_list);</span><br></pre></td></tr></table></figure>
<p>其中table_name是要增加索引名的表名，column_list指出对哪些列列进行索引，多列时各列之间使用半角逗号隔开。索引名index_name是可选的，如果不指定索引名称，MySQL将根据第一个索引列自动指定索引名称，另外，ALTER TABLE允许在单个语句中更改多个表，因此可以在同时创建多个索引。</p>
<pre><code>- 1.2&gt; CREATE INDEX
</code></pre><p>CREATE INDEX可对表增加普通索引或UNIQUE索引以及全文索引，但是不可以对表增加主键索引</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">INDEX</span> index_name <span class="keyword">ON</span> table_name (column_list);</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">UNIQUE</span> index_name <span class="keyword">ON</span> table_name (column_list);</span><br><span class="line"><span class="keyword">CREATE</span> FULLTEXT index_name <span class="keyword">ON</span> table_name (column_list);</span><br></pre></td></tr></table></figure>
<p>table_name、index_name和column_list具有与ALTER TABLE语句中相同的含义，索引名必须指定。另外，不能用CREATE INDEX语句创建PRIMARY KEY索引。</p>
<ul>
<li>2.索引类型<ul>
<li>普通索引INDEX：适用于name、email等一般属性</li>
<li>唯一索引UNIQUE：与普通索引类似，不同的是唯一索引要求索引字段值在表中是唯一的，这一点和主键索引类似，但是不同的是，唯一索引允许有空值。唯一索引一般适用于身份证号码、用户账号等不允许有重复的属性字段上。</li>
<li>主键索引：其实就是主键，一般在建表时就指定了，不需要额外添加。</li>
<li>全文检索：只适用于VARCHAR和Text类型的字段。</li>
</ul>
</li>
</ul>
<p>注意：全文索引和普通索引是有很大区别的，如果建立的是普通索引，一般会使用like进行模糊查询，只会对查询内容前一部分有效，即只对前面不使用通配符的查询有效，如果前后都有通配符，普通索引将不会起作用。对于全文索引而言在查询时有自己独特的匹配方式，例如我们在对一篇文章的标题和内容进行全文索引时：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> article <span class="keyword">ADD</span> FULLTEXT (<span class="string">'title'</span>, <span class="string">'content'</span>);</span><br></pre></td></tr></table></figure>
<p> 在进行检索时就需要使用如下的语法进行检索：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> article <span class="keyword">WHERE</span> <span class="keyword">MATCH</span>(<span class="string">'title'</span>, <span class="string">'content'</span>) AGAINST (<span class="string">'查询字符串'</span>);</span><br></pre></td></tr></table></figure>
<p>在使用全文检索时的注意事项：<br>MySql自带的<font color="#FF0000">   全文索引只能用于数据库引擎为MYISAM的数据表，如果是其他数据引擎</font>，则全文索引不会生效。此外，<font color="#FF0000">MySql自带的全文索引只能对英文进行全文检索，目前无法对中文进行全文检索。如果需要对包含中文在内的文本数据进行全文检索，我们需要采用Sphinx（斯芬克斯）/Coreseek技术来处理中文</font>。另外使用MySql自带的全文索引时，<font color="#FF0000">  如果查询字符串的长度过短将无法得到期望的搜索结果。MySql全文索引所能找到的词默认最小长度为4个字符</font>。另外，如果查询的字符串包含停止词，那么该停止词将会被忽略。</p>
<ul>
<li>3.组合索引</li>
</ul>
<p>组合索引又称多列索引，就是建立索引时指定多个字段属性。有点类似于字典目录，比如查询 ‘guo’ 这个拼音的字时，首先查找g字母，然后在g的检索范围内查询第二个字母为u的列表，最后在u的范围内查找最后一个字母为o的字。比如组合索引(a,b,c)，abc都是排好序的，在任意一段a的下面b都是排好序的，任何一段b下面c都是排好序的</p>
<p>组合索引的生效原则是  从前往后依次使用生效，如果中间某个索引没有使用，那么断点前面的索引部分起作用，断点后面的索引没有起作用；</p>
<p>造成断点的原因：</p>
<p>前边的任意一个索引没有参与查询，后边的全部不生效。</p>
<p>前边的任意一个索引字段参与的是范围查询，后面的不会生效。</p>
<p>断点跟索引字字段在SQL语句中的位置前后无关，只与是否存在有关。在网上找到了很好的示例：<br>比如：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">where <span class="attribute">a</span>=3 <span class="keyword">and</span> <span class="attribute">b</span>=45 <span class="keyword">and</span> <span class="attribute">c</span>=5 <span class="built_in">..</span><span class="built_in">..</span> #这种三个索引顺序使用中间没有断点，全部发挥作用；</span><br><span class="line">where <span class="attribute">a</span>=3 <span class="keyword">and</span> <span class="attribute">c</span>=5... #这种情况下b就是断点，a发挥了效果，c没有效果</span><br><span class="line">where <span class="attribute">b</span>=3 <span class="keyword">and</span> <span class="attribute">c</span>=4... #这种情况下a就是断点，在a后面的索引都没有发挥作用，这种写法联合索引没有发挥任何效果；</span><br><span class="line">where <span class="attribute">b</span>=45 <span class="keyword">and</span> <span class="attribute">a</span>=3 <span class="keyword">and</span> <span class="attribute">c</span>=5 <span class="built_in">..</span><span class="built_in">..</span> #这个跟第一个一样，全部发挥作用，abc只要用上了就行，跟写的顺序无关</span><br></pre></td></tr></table></figure>
<p>（a,b,c） 三个列上加了联合索引（是联合索引 不是在每个列上单独加索引）而是建立了a,(a,b),(a,b,c)三个索引，另外(a,b,c)多列索引和 (a,c,b)是不一样的。</p>
<p>具体实例可以说明：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">(0) select * <span class="keyword">from</span> mytable where <span class="attribute">a</span>=3 <span class="keyword">and</span> <span class="attribute">b</span>=5 <span class="keyword">and</span> <span class="attribute">c</span>=4;</span><br><span class="line"><span class="comment">#abc三个索引都在where条件里面用到了，而且都发挥了作用</span></span><br><span class="line">(1) select * <span class="keyword">from</span> mytable where  <span class="attribute">c</span>=4 <span class="keyword">and</span> <span class="attribute">b</span>=6 <span class="keyword">and</span> <span class="attribute">a</span>=3;</span><br><span class="line"><span class="comment">#这条语句为了说明 组合索引与在SQL中的位置先后无关，where里面的条件顺序在查询之前会被mysql自动优化，效果跟上一句一样</span></span><br><span class="line">(2) select * <span class="keyword">from</span> mytable where <span class="attribute">a</span>=3 <span class="keyword">and</span> <span class="attribute">c</span>=7;</span><br><span class="line"><span class="comment">#a用到索引，b没有用，所以c是没有用到索引效果的</span></span><br><span class="line">(3) select * <span class="keyword">from</span> mytable where <span class="attribute">a</span>=3 <span class="keyword">and</span> b&gt;7 <span class="keyword">and</span> <span class="attribute">c</span>=3;</span><br><span class="line"><span class="comment">#a用到了，b也用到了，c没有用到，这个地方b是范围值，也算断点，只不过自身用到了索引</span></span><br><span class="line">(4) select * <span class="keyword">from</span> mytable where <span class="attribute">b</span>=3 <span class="keyword">and</span> <span class="attribute">c</span>=4;</span><br><span class="line"><span class="comment">#因为a索引没有使用，所以这里 bc都没有用上索引效果</span></span><br><span class="line">(5) select * <span class="keyword">from</span> mytable where a&gt;4 <span class="keyword">and</span> <span class="attribute">b</span>=7 <span class="keyword">and</span> <span class="attribute">c</span>=9;</span><br><span class="line"><span class="comment">#a用到了  b没有使用，c没有使用</span></span><br><span class="line">(6) select * <span class="keyword">from</span> mytable where <span class="attribute">a</span>=3 order by b;</span><br><span class="line"><span class="comment">#a用到了索引，b在结果排序中也用到了索引的效果，前面说了，a下面任意一段的b是排好序的</span></span><br><span class="line">(7) select * <span class="keyword">from</span> mytable where <span class="attribute">a</span>=3 order by c;</span><br><span class="line"><span class="comment">#a用到了索引，但是这个地方c没有发挥排序效果，因为中间断点了，使用 explain 可以看到 filesort</span></span><br><span class="line">(8) select * <span class="keyword">from</span> mytable where <span class="attribute">b</span>=3 order by a;</span><br><span class="line"><span class="comment">#b没有用到索引，排序中a也没有发挥索引效果</span></span><br></pre></td></tr></table></figure>
<p>注意：在查询时，MYSQL只能使用一个索引，如果建立的是多个单列的普通索引，在查询时会根据查询的索引字段，从中选择一个限制最严格的单例索引进行查询。别的索引都不会生效。</p>
<ul>
<li>4.查看索引</li>
</ul>
<figure class="highlight q"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; <span class="built_in">show</span> index <span class="keyword">from</span> tblname;</span><br><span class="line">mysql&gt; <span class="built_in">show</span> <span class="built_in">keys</span> <span class="keyword">from</span> tblname;</span><br></pre></td></tr></table></figure>
<p>5.删除索引</p>
<p>删除索引的mysql格式 :<br><figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DORP <span class="keyword">INDEX</span> IndexName <span class="keyword">ON</span> tab_name；</span><br></pre></td></tr></table></figure></p>
<font color="#FF0000"> 注意：不能使用索引的情况 </font> 

<p>对于普通索引而言 在使用like进行通配符模糊查询时,如果首尾之间都使用了通配符，索引时无效的。</p>
<p>假设查询内容的关键词为’abc’</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> tab_name <span class="keyword">WHERE</span> index_column <span class="keyword">LIKE</span>  <span class="string">'abc%'</span>;  #索引是有效的</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> tab_name <span class="keyword">WHERE</span> index_column <span class="keyword">LIKE</span>  <span class="string">'%abc'</span>;  #索引是无效的</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> tab_name <span class="keyword">WHERE</span> index_column <span class="keyword">LIKE</span>  <span class="string">'%cba'</span>;  #索引是有效的</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> tab_name <span class="keyword">WHERE</span> index_column <span class="keyword">LIKE</span>  <span class="string">'%abc%'</span>;  #索引是无效的</span><br></pre></td></tr></table></figure>
<p>当检索的字段内容比较大而且检索内容前后部分都不确定的情况下，可以改为全文索引，并使用特定的检索方式。</p>
<h3 id="五-在join表的时候使用相当类型的列，并将其索引"><a href="#五-在join表的时候使用相当类型的列，并将其索引" class="headerlink" title="(五)在join表的时候使用相当类型的列，并将其索引"></a>(五)在join表的时候使用相当类型的列，并将其索引</h3><p>如果在程序中有很多JOIN查询，应该保证两个表中join的字段时被建立过索引的。这样MySQL颞部会启动优化JOIN的SQL语句的机制。注意：这些被用来JOIN的字段，应该是相同类型的。例如：如果要把 DECIMAL 字段和一个 INT 字段Join在一起，MySQL就无法使用它们的索引。对于那些STRING类型，还需要有相同的字符集才行。（两个表的字符集有可能不一样）<br>例如：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT company_name <span class="keyword">FROM</span><span class="built_in"> users </span>LEFT JOIN companies ON (users.state = companies.state) WHERE users.id = “user_id”</span><br></pre></td></tr></table></figure>
<p>两个 state 字段应该是被建过索引的，而且应该是相当的类型，相同的字符集。</p>
<h3 id="六-切记不要使用ORDER-BY-RAND"><a href="#六-切记不要使用ORDER-BY-RAND" class="headerlink" title="(六)切记不要使用ORDER BY RAND()"></a>(六)切记不要使用ORDER BY RAND()</h3><p>如果你真的想把返回的数据行打乱了，你有N种方法可以达到这个目的。这样使用只让你的数据库的性能呈指数级的下降。这里的问题是：MySQL会不得不去执行RAND()函数（很耗CPU时间），而且这是为了每一行记录去记行，然后再对其排序。就算是你用了Limit 1也无济于事（因为要排序） </p>
<h3 id="七-避免使用SELECT"><a href="#七-避免使用SELECT" class="headerlink" title="(七)避免使用SELECT *"></a>(七)避免使用SELECT *</h3><p>从数据库里读出越多的数据，那么查询就会变得越慢。并且，如果我们的数据库服务器和WEB服务器是两台独立的服务器的话，这还会增加网络传输的负载。 所以，我们应该养成一个需要什么就取什么的好的习惯。<br>Hibernate性能方面就会差，它不用*，但它将整个表的所有字段全查出来<br>优点：开发速度快</p>
<h3 id="八-永远为每张表设置一个ID主键"><a href="#八-永远为每张表设置一个ID主键" class="headerlink" title="(八)永远为每张表设置一个ID主键"></a>(八)永远为每张表设置一个ID主键</h3><p>我们应该为数据库里的每张表都设置一个ID做为其主键，而且最好的是一个INT型的（推荐使用UNSIGNED），并设置上自动增加的 AUTO_INCREMENT标志。 就算是我们 users 表有一个主键叫 “email”的字段，我们也别让它成为主键。使用 VARCHAR 类型来当主键会使用得性能下降。另外，在我们的程序中，我们应该使用表的ID来构造我们的数据结构。 而且，在MySQL数据引擎下，还有一些操作需要使用主键，在这些情况下，主键的性能和设置变得非常重要，比如，集群，分区…… 在这里，只有一个情况是例外，那就是“关联表”的“外键”，也就是说，这个表的主键，通过若干个别的表的主键构成。我们把这个情况叫做“外键”。比如：有一个“学生表”有学生的ID，有一个“课程表”有课程ID，那么，“成绩表”就是“关联表”了，其关联了学生表和课程表，在成绩表中，学生ID和课程ID叫“外键”其共同组成主键。 </p>
<h3 id="九-使用ENUM而不是VARCHAR"><a href="#九-使用ENUM而不是VARCHAR" class="headerlink" title="(九)使用ENUM而不是VARCHAR"></a>(九)使用ENUM而不是VARCHAR</h3><p>ENUM 类型是非常快和紧凑的。在实际上，其保存的是 TINYINT，但其外表上显示为字符串。这样一来，用这个字段来做一些选项列表变得相当的完美。 如果我们有一个字段，比如“性别”，“国家”，“民族”，“状态”或“部门”，我们知道这些字段的取值是有限而且固定的，那么，我们应该使用 ENUM 而不是 VARCHAR。</p>
<h3 id="十-尽可能的不要赋值为NULL"><a href="#十-尽可能的不要赋值为NULL" class="headerlink" title="(十)尽可能的不要赋值为NULL"></a>(十)尽可能的不要赋值为NULL</h3><p>如果不是特殊情况，尽可能的不要使用NULL。在MYSQL中对于INT类型而言，EMPTY是0，而NULL是空值。而在Oracle中 NULL和EMPTY的字符串是一样的。NULL也需要占用存储空间，并且会使我们的程序判断时更加复杂。现实情况是很复杂的，依然会有些情况下，我们需要使用NULL值。 下面摘自MySQL自己的文档： “NULL columns require additional space in the row to record whether their values are NULL. For MyISAM tables, each NULL column takes one bit extra, rounded up to the nearest byte.” </p>
<h3 id="十一-固定长度的表会更快"><a href="#十一-固定长度的表会更快" class="headerlink" title="(十一) 固定长度的表会更快"></a>(十一) 固定长度的表会更快</h3><p>如果表中的所有字段都是“固定长度”的，整个表会被认为是 “static” 或 “fixed-length”。 例如，表中没有如下类型的字段： VARCHAR，TEXT，BLOB。只要我们包括了其中一个这些字段，那么这个表就不是“固定长度静态表”了，这样，MySQL 引擎会用另一种方法来处理。 固定长度的表会提高性能，因为MySQL搜寻得会更快一些，因为这些固定的长度是很容易计算下一个数据的偏移量的，所以读取的自然也会很快。而如果字段不是定长的，那么，每一次要找下一条的话，需要程序找到主键。 并且，固定长度的表也更容易被缓存和重建。不过，唯一的副作用是，固定长度的字段会浪费一些空间，因为定长的字段无论我们用不用，他都是要分配那么多的空间。另外在取出值的时候要使用trim去除空格 </p>
<h3 id="十二-垂直分割"><a href="#十二-垂直分割" class="headerlink" title="(十二)垂直分割"></a>(十二)垂直分割</h3><p>“垂直分割”是一种把数据库中的表按列变成几张表的方法，这样可以降低表的复杂度和字段的数目，从而达到优化的目的。</p>
<h3 id="十三-拆分大的DELETE或INSERT"><a href="#十三-拆分大的DELETE或INSERT" class="headerlink" title="(十三)拆分大的DELETE或INSERT"></a>(十三)拆分大的DELETE或INSERT</h3><p>如果我们需要在一个在线的网站上去执行一个大的 DELETE 或 INSERT 查询，我们需要非常小心，要避免我们的操作让我们的整个网站停止相应。因为这两个操作是会锁表的，表一锁住了，别的操作都进不来了。Apache 会有很多的子进程或线程。所以，其工作起来相当有效率，而我们的服务器也不希望有太多的子进程，线程和数据库链接，这是极大的占服务器资源的事情，尤其是内存。如果我们把我们的表锁上一段时间，比如30秒钟，那么对于一个有很高访问量的站点来说，这30秒所积累的访问进程/线程，数据库链接，打开的文件数，可能不仅仅会让我们的WEB服务Crash，还可能会让我们的整台服务器马上掛了。所以在使用时使用LIMIT 控制数量操作记录的数量。</p>
<h3 id="十四-越小的列会越快"><a href="#十四-越小的列会越快" class="headerlink" title="(十四)越小的列会越快"></a>(十四)越小的列会越快</h3><p>对于大多数的数据库引擎来说，硬盘操作可能是最重大的瓶颈。所以，把我们的数据变得紧凑会对这种情况非常有帮助，因为这减少了对硬盘的访问。 参看 MySQL 的文档 Storage Requirements 查看所有的数据类型。 如果一个表只会有几列罢了（比如说字典表，配置表），那么，我们就没有理由使用 INT 来做主键，使用 MEDIUMINT, SMALLINT 或是更小的 TINYINT 会更经济一些。如果我们不需要记录时间，使用 DATE 要比 DATETIME 好得多。 </p>
<h3 id="十五-选择正确的存储引擎"><a href="#十五-选择正确的存储引擎" class="headerlink" title="(十五)选择正确的存储引擎"></a>(十五)选择正确的存储引擎</h3><p>在MYSQL中有两个存储引擎MyISAM和InnoDB,每个引擎都有利有弊。</p>
<p>MyISAM适合于一些需要大量查询的应用，但是对于大量写操作的支持不是很好。甚至一个update语句就会进行锁表操作，这时读取这张表的所有进程都无法进行操作直至写操作完成。另外MyISAM对于SELECT  COUNT(*)这类的计算是超快无比的。InnoDB 的趋势会是一个非常复杂的存储引擎，对于一些小的应用，它会比 MyISAM 还慢。它支持“行锁” ，于是在写操作比较多的时候，会更优秀。并且，他还支持更多的高级应用，比如：事务。</p>
<p>MyISAM是MYSQL5.5版本以前默认的存储引擎，基于传统的ISAM类型，支持B-Tree，全文检索，但是不是事务安全的，而且不支持外键。不具有原子性。支持锁表。</p>
<p>InnoDB是事务型引擎，支持ACID事务(实现4种事务隔离机制)、回滚、崩溃恢复能力、行锁。以及提供与Oracle一致的不加锁的读取方式。InnoDB存储它的表和索引在一个表空间中，表空间可以包含多个文件。</p>
<p>MyISAM和InnoDB比较，如下图所示：<br><img src="https://img-blog.csdn.net/20170910135801950?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvdTAxMzA4NzUxMw==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="image"><br>对于Linux版本的MYSQL  配置文件在 /etc/my.cnf中<br><img src="https://img-blog.csdn.net/20170910140247051?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvdTAxMzA4NzUxMw==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="image"><br>在5.5之后默认的存储引擎是INNODB</p>
<p>可以单独进行修改也可以在创建表时修改：</p>
<p>ALTER TABLE tab_name ENGINE INNODB；</p>
<h3 id="十六-小心永久链接"><a href="#十六-小心永久链接" class="headerlink" title="(十六)小心永久链接"></a>(十六)小心永久链接</h3><p>“永久链接”的目的是用来减少重新创建MySQL链接的次数。当一个链接被创建了，它会永远处在连接的状态，就算是数据库操作已经结束了。而且，自从我们的Apache开始重用它的子进程后——也就是说，下一次的HTTP请求会重用Apache的子进程，并重用相同的 MySQL 链接。 </p>
<p>而且，Apache 运行在极端并行的环境中，会创建很多很多的了进程。这就是为什么这种“永久链接”的机制工作地不好的原因。在我们决定要使用“永久链接”之前，我们需要好好地考虑一下我们的整个系统的架构。</p>
<p>摘自：    <a href="https://blog.csdn.net/u013087513/article/details/77899412" target="_blank" rel="noopener">https://blog.csdn.net/u013087513/article/details/77899412</a><br>看过好多吧，还是感觉这个最好</p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color4">数据库</a>
        		</li>
      		 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color1">MySql</a>
        		</li>
      		
		</ul>
	</div>

      
	<div class="article-category tagcloud">
		<i class="icon-book icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="/categories/数据库//" class="article-tag-list-link color4">数据库</a>
        		</li>
      		
		</ul>
	</div>


      
        <p class="article-more-link">
          <a class="article-more-a" href="/2018/07/18/MySql优化/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>





<!-- 目录内容 -->
             
        <!-- 目录内容结束 -->
  
    <article id="post-jieba分词" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/07/18/jieba分词/">jieba分词</a>
    </h1>
  

        
        <a href="/2018/07/18/jieba分词/" class="archive-article-date">
  	<time datetime="2018-07-18T07:36:41.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2018-07-18</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="jiaba分词"><a href="#jiaba分词" class="headerlink" title="jiaba分词"></a>jiaba分词</h1><p>jieba（结巴）是一个强大的分词库，完美支持中文分词</p>
<h3 id="安装jieba"><a href="#安装jieba" class="headerlink" title="安装jieba"></a>安装jieba</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install jieba</span><br></pre></td></tr></table></figure>
<h2 id="简单用法"><a href="#简单用法" class="headerlink" title="简单用法"></a>简单用法</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> jieba</span><br><span class="line">s = <span class="string">u'我想和女朋友一起去北京故宫博物院参观和闲逛。'</span></span><br><span class="line">cut = jieba.cut(s)</span><br><span class="line"></span><br><span class="line">print(cut)</span><br><span class="line">print(<span class="string">','</span>.join(cut))</span><br></pre></td></tr></table></figure>
<p>结果：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#对象在第二行，分词在最后一行</span></span><br><span class="line">Building<span class="built_in"> prefix </span>dict <span class="keyword">from</span> the<span class="built_in"> default </span>dictionary <span class="built_in">..</span>.</span><br><span class="line">&lt;generator object Tokenizer.cut at 0x000001FFD3E09468&gt;</span><br><span class="line">Loading model <span class="keyword">from</span> cache C:\Users\grmg\AppData\Local\Temp\jieba.cache</span><br><span class="line">Loading model cost 0.960 seconds.</span><br><span class="line">Prefix dict has been built succesfully.</span><br><span class="line">我,想,和,女朋友,一起,去,北京故宫博物院,参观,和,闲逛,。</span><br></pre></td></tr></table></figure>
<h2 id="全模式"><a href="#全模式" class="headerlink" title="全模式"></a>全模式</h2><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">print</span> <span class="string">','</span>.<span class="keyword">join</span>(jieba.cut(s,cut_all = <span class="keyword">True</span>))</span><br></pre></td></tr></table></figure>
<p>结果：<br><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">我,想,和,女朋友,朋友,一起,去,北京,北京故宫,北京故宫博物院,故宫,故宫博物院,博物,博物院,参观,和,闲逛,,</span><br></pre></td></tr></table></figure></p>
<h2 id="搜索引擎模式"><a href="#搜索引擎模式" class="headerlink" title="搜索引擎模式"></a>搜索引擎模式</h2><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">print</span> <span class="string">','</span>.<span class="keyword">join</span>(jieba.cut_for_search(s))</span><br></pre></td></tr></table></figure>
<p>结果：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">我,想,和,朋友,女朋友,一起,去,北京,故宫,博物,博物院,北京故宫博物院,参观,和,闲逛,。</span><br></pre></td></tr></table></figure></p>
<h2 id="获取词性"><a href="#获取词性" class="headerlink" title="获取词性"></a>获取词性</h2><p>每个词都有其词性，比如名词、动词、代词等，结巴分词的结果也可以带上每个词的词性，要用到jieba.posseg，举例如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import jieba.posseg as psg</span><br><span class="line"><span class="built_in">print</span> <span class="string">'【Output】'</span></span><br><span class="line"><span class="built_in">print</span> [(x.word,x.flag) <span class="keyword">for</span> x <span class="keyword">in</span> psg.cut(s)]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出：</span></span><br><span class="line"><span class="string">''</span><span class="string">'</span></span><br><span class="line"><span class="string">[(u'</span>我<span class="string">', u'</span>r<span class="string">'), (u'</span>想<span class="string">', u'</span>v<span class="string">'), (u'</span>和<span class="string">', u'</span>c<span class="string">'), (u'</span>女朋友<span class="string">', u'</span>n<span class="string">'), (u'</span>一起<span class="string">', u'</span>m<span class="string">'), </span></span><br><span class="line"><span class="string">(u'</span>去<span class="string">', u'</span>v<span class="string">'), (u'</span>北京故宫博物院<span class="string">', u'</span>ns<span class="string">'), (u'</span>参观<span class="string">', u'</span>n<span class="string">'), (u'</span>和<span class="string">', u'</span>c<span class="string">'), (u'</span>闲逛<span class="string">', u'</span>v<span class="string">'), (u'</span>。<span class="string">', u'</span>x<span class="string">')]</span></span><br><span class="line"><span class="string">'</span><span class="string">''</span></span><br></pre></td></tr></table></figure>
<p>可以看到成功获取到每个词的词性，这对于我们对分词结果做进一步处理很有帮助，比如只想获取分词结果列表中的名词，那么就可以这样过滤：</p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">print [(x.word,x.flag) for x in psg.cut(s) if x.flag.startswith(<span class="emphasis">'n'</span>)]</span><br><span class="line"></span><br><span class="line"># 输出：</span><br><span class="line">'''</span><br><span class="line"><span class="meta">[(u'女朋友', u'n'), (u'北京故宫博物院', u'ns'), (u'参观', u'n')]</span></span><br><span class="line">'''</span><br></pre></td></tr></table></figure>
<p>至于词性的每个字母分别表示什么词性，jieba分词的结果可能有哪些词性，就要去查阅词性对照表了，本文结尾附了一份从网上搜到的词性对照表，想了解更详细的词性分类信息，可以到网上搜索”结巴分词词性对照”。</p>
<p>并行分词<br>在文本数据量非常大的时候，为了提高分词效率，开启并行分词就很有必要了。jieba支持并行分词，基于python自带的multiprocessing模块，但要注意的是在Windows环境下不支持。</p>
<p>用法：</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 开启并行分词模式，参数为并发执行的进程数</span></span><br><span class="line">jieba.enable_parallel(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭并行分词模式</span></span><br><span class="line">jieba.disable_parallel()</span><br><span class="line">举例：开启并行分词模式对三体全集文本进行分词</span><br><span class="line"></span><br><span class="line">santi_text = <span class="built_in">open</span>(<span class="string">'./santi.txt'</span>).<span class="built_in">read</span>()</span><br><span class="line">print <span class="built_in">len</span>(santi_text)</span><br><span class="line"><span class="number">2681968</span></span><br></pre></td></tr></table></figure>
<p>可以看到三体全集的数据量还是非常大的，有260多万字节的长度。</p>
<figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">jieba.enable_parallel(<span class="number">100</span>)</span><br><span class="line">santi_words = [x <span class="keyword">for</span> x <span class="built_in">in</span> jieba.<span class="built_in">cut</span>(santi_text) <span class="keyword">if</span> len(x) &gt;= <span class="number">2</span>]</span><br><span class="line">jieba.disable_parallel()</span><br></pre></td></tr></table></figure>
<p>获取出现频率Top n的词<br>还是以上面的三体全集文本为例，假如想要获取分词结果中出现频率前20的词列表，可以这样获取：</p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">from collections import Counter</span><br><span class="line">c = Counter(santi_words).most_common(<span class="number">20</span>)</span><br><span class="line">print(c)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta"># 输出：</span></span><br><span class="line">'''</span><br><span class="line">[(u'\r\n', <span class="number">2180</span>5), (u'一个', <span class="number">3057</span>), (u'没有', <span class="number">2128</span>), (u'他们', <span class="number">1690</span>), (u'我们', <span class="number">1550</span>), </span><br><span class="line">(u'这个', <span class="number">1357</span>), (u'自己', <span class="number">1347</span>), (u'程心', <span class="number">1320</span>), (u'现在', <span class="number">1273</span>), (u'已经', <span class="number">1259</span>), </span><br><span class="line">(u'世界', <span class="number">1243</span>), (u'罗辑', <span class="number">1189</span>), (u'可能', <span class="number">1177</span>), (u'什么', <span class="number">1176</span>), (u'看到', <span class="number">1114</span>), </span><br><span class="line">(u'知道', <span class="number">1094</span>), (u'地球', 951), (u'人类', 935), (u'太空', 930), (u'三体', 883)]</span><br><span class="line">'''</span><br></pre></td></tr></table></figure>
<p>可以看到结果中’\r\n’居然是出现频率最高的词，还有’一个’、’没有’、’这个’等这种我们并不想要的无实际意义的词，那么就可以根据前面说的词性来进行过滤，这个以后细讲。</p>
<p>使用用户字典提高分词准确性<br>不使用用户字典的分词结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">txt = <span class="string">u'欧阳建国是创新办主任也是欢聚时代公司云计算方面的专家'</span></span><br><span class="line"><span class="keyword">print</span> <span class="string">','</span>.join(jieba.cut(txt))</span><br><span class="line">欧阳,建国,是,创新,办,主任,也,是,欢聚,时代,公司,云,计算,方面,的,专家</span><br><span class="line">使用用户字典的分词结果：</span><br><span class="line"></span><br><span class="line">jieba.load_userdict(<span class="string">'user_dict.txt'</span>)</span><br><span class="line"><span class="keyword">print</span> <span class="string">','</span>.join(jieba.cut(txt))</span><br><span class="line">欧阳建国,是,创新办,主任,也,是,欢聚时代,公司,云计算,方面,的,专家</span><br></pre></td></tr></table></figure>
<p>可以看出使用用户字典后分词准确性大大提高。</p>
<p>注：其中user_dict.txt的内容如下：</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">欧阳建国 <span class="number">5</span></span><br><span class="line"></span><br><span class="line">创新办 <span class="number">5</span> i</span><br><span class="line"></span><br><span class="line">欢聚时代 <span class="number">5</span></span><br><span class="line"></span><br><span class="line">云计算 <span class="number">5</span></span><br></pre></td></tr></table></figure>
<p>用户字典每行一个词，格式为：</p>
<p>词语 词频 词性</p>
<p>其中词频是一个数字，词性为自定义的词性，要注意的是词频数字和空格都要是半角的。</p>
<p>附：结巴分词词性对照表（按词性英文首字母排序）</p>
<h3 id="形容词-1个一类，4个二类"><a href="#形容词-1个一类，4个二类" class="headerlink" title="形容词(1个一类，4个二类)"></a>形容词(1个一类，4个二类)</h3><table>
<thead>
<tr>
<th>字母</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>a</td>
<td>形容词</td>
</tr>
<tr>
<td>ad</td>
<td>副形词</td>
</tr>
<tr>
<td>an</td>
<td>名形词</td>
</tr>
<tr>
<td>ag</td>
<td>形容词性语素</td>
</tr>
<tr>
<td>al</td>
<td>形容词性惯用语</td>
</tr>
</tbody>
</table>
<h3 id="区别词-1个一类，2个二类"><a href="#区别词-1个一类，2个二类" class="headerlink" title="区别词(1个一类，2个二类)"></a>区别词(1个一类，2个二类)</h3><table>
<thead>
<tr>
<th>字母</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>b</td>
<td>区别词</td>
</tr>
<tr>
<td>bl</td>
<td>区别词性惯用语</td>
</tr>
</tbody>
</table>
<h3 id="连词-1个一类，1个二类"><a href="#连词-1个一类，1个二类" class="headerlink" title="连词(1个一类，1个二类)"></a>连词(1个一类，1个二类)</h3><table>
<thead>
<tr>
<th>字母</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>c</td>
<td>连词</td>
</tr>
<tr>
<td>cc</td>
<td>并列连词</td>
</tr>
</tbody>
</table>
<h3 id="副词-1个一类"><a href="#副词-1个一类" class="headerlink" title="副词(1个一类)"></a>副词(1个一类)</h3><table>
<thead>
<tr>
<th>字母</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>d</td>
<td>副词</td>
</tr>
</tbody>
</table>
<h3 id="叹词-1个一类"><a href="#叹词-1个一类" class="headerlink" title="叹词(1个一类)"></a>叹词(1个一类)</h3><table>
<thead>
<tr>
<th>字母</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>e</td>
<td>叹词</td>
</tr>
</tbody>
</table>
<h3 id="方位词-1个一类"><a href="#方位词-1个一类" class="headerlink" title="方位词(1个一类)"></a>方位词(1个一类)</h3><table>
<thead>
<tr>
<th>字母</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>f</td>
<td>方位词</td>
</tr>
</tbody>
</table>
<h3 id="前缀-1个一类"><a href="#前缀-1个一类" class="headerlink" title="前缀(1个一类)"></a>前缀(1个一类)</h3><table>
<thead>
<tr>
<th>字母</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>h</td>
<td>前缀</td>
</tr>
</tbody>
</table>
<h3 id="后缀-1个一类"><a href="#后缀-1个一类" class="headerlink" title="后缀(1个一类)"></a>后缀(1个一类)</h3><table>
<thead>
<tr>
<th>字母</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>k</td>
<td>后缀</td>
</tr>
</tbody>
</table>
<h3 id="数词-1个一类，1个二类"><a href="#数词-1个一类，1个二类" class="headerlink" title="数词(1个一类，1个二类)"></a>数词(1个一类，1个二类)</h3><table>
<thead>
<tr>
<th>字母</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>m</td>
<td>数词</td>
</tr>
<tr>
<td>mq</td>
<td>数量词</td>
</tr>
</tbody>
</table>
<h3 id="名词-1个一类，7个二类，5个三类"><a href="#名词-1个一类，7个二类，5个三类" class="headerlink" title="名词 (1个一类，7个二类，5个三类)"></a>名词 (1个一类，7个二类，5个三类)</h3><p>名词分为以下子类：<br>字母 | 含义<br>—|—<br>n  |  名词<br>nr   | 人名<br>nr1   | 汉语姓氏<br>nr2   | 汉语名字<br>nrj   | 日语人名<br>nrf   | 音译人名<br>ns  |  地名<br>nsf   | 音译地名<br>nt   | 机构团体名<br>nz   | 其它专名<br>nl   | 名词性惯用语<br>ng   | 名词性语素</p>
<h3 id="拟声词-1个一类"><a href="#拟声词-1个一类" class="headerlink" title="拟声词(1个一类)"></a>拟声词(1个一类)</h3><table>
<thead>
<tr>
<th>字母</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>o</td>
<td>拟声词</td>
</tr>
</tbody>
</table>
<h3 id="介词-1个一类，2个二类"><a href="#介词-1个一类，2个二类" class="headerlink" title="介词(1个一类，2个二类)"></a>介词(1个一类，2个二类)</h3><table>
<thead>
<tr>
<th>字母</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>p</td>
<td>介词</td>
</tr>
<tr>
<td>pba</td>
<td>介词“把”</td>
</tr>
<tr>
<td>pbei</td>
<td>介词“被”</td>
</tr>
</tbody>
</table>
<h3 id="量词-1个一类，2个二类"><a href="#量词-1个一类，2个二类" class="headerlink" title="量词(1个一类，2个二类)"></a>量词(1个一类，2个二类)</h3><table>
<thead>
<tr>
<th>字母</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>q</td>
<td>量词</td>
</tr>
<tr>
<td>qv</td>
<td>动量词</td>
</tr>
<tr>
<td>qt</td>
<td>时量词</td>
</tr>
</tbody>
</table>
<h3 id="代词-1个一类，4个二类，6个三类"><a href="#代词-1个一类，4个二类，6个三类" class="headerlink" title="代词(1个一类，4个二类，6个三类)"></a>代词(1个一类，4个二类，6个三类)</h3><table>
<thead>
<tr>
<th>字母</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>r</td>
<td>代词</td>
</tr>
<tr>
<td>rr</td>
<td>人称代词</td>
</tr>
<tr>
<td>rz</td>
<td>指示代词</td>
</tr>
<tr>
<td>rzt</td>
<td>时间指示代词</td>
</tr>
<tr>
<td>rzs</td>
<td>处所指示代词</td>
</tr>
<tr>
<td>rzv</td>
<td>谓词性指示代词</td>
</tr>
<tr>
<td>ry</td>
<td>疑问代词</td>
</tr>
<tr>
<td>ryt</td>
<td>时间疑问代词</td>
</tr>
<tr>
<td>rys</td>
<td>处所疑问代词</td>
</tr>
<tr>
<td>ryv</td>
<td>谓词性疑问代词</td>
</tr>
<tr>
<td>rg</td>
<td>代词性语素</td>
</tr>
</tbody>
</table>
<h3 id="处所词-1个一类"><a href="#处所词-1个一类" class="headerlink" title="处所词(1个一类)"></a>处所词(1个一类)</h3><table>
<thead>
<tr>
<th>字母</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>s</td>
<td>处所词</td>
</tr>
</tbody>
</table>
<h3 id="时间词-1个一类，1个二类"><a href="#时间词-1个一类，1个二类" class="headerlink" title="时间词(1个一类，1个二类)"></a>时间词(1个一类，1个二类)</h3><table>
<thead>
<tr>
<th>字母</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>t</td>
<td>时间词</td>
</tr>
<tr>
<td>tg</td>
<td>时间词性语素</td>
</tr>
</tbody>
</table>
<h3 id="助词-1个一类，15个二类"><a href="#助词-1个一类，15个二类" class="headerlink" title="助词(1个一类，15个二类)"></a>助词(1个一类，15个二类)</h3><table>
<thead>
<tr>
<th>字母</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>u</td>
<td>助词</td>
</tr>
<tr>
<td>uzhe</td>
<td>着</td>
</tr>
<tr>
<td>ule</td>
<td>了 喽</td>
</tr>
<tr>
<td>uguo</td>
<td>过</td>
</tr>
<tr>
<td>ude1</td>
<td>的 底</td>
</tr>
<tr>
<td>ude2</td>
<td>地</td>
</tr>
<tr>
<td>ude3</td>
<td>得</td>
</tr>
<tr>
<td>usuo</td>
<td>所</td>
</tr>
<tr>
<td>udeng</td>
<td>等 等等 云云</td>
</tr>
<tr>
<td>uyy</td>
<td>一样 一般 似的 般</td>
</tr>
<tr>
<td>udh</td>
<td>的话</td>
</tr>
<tr>
<td>uls</td>
<td>来讲 来说 而言 说来</td>
</tr>
<tr>
<td>uzhi</td>
<td>之</td>
</tr>
<tr>
<td>ulian</td>
<td>连 （“连小学生都会”）</td>
</tr>
</tbody>
</table>
<h3 id="动词-1个一类，9个二类"><a href="#动词-1个一类，9个二类" class="headerlink" title="动词(1个一类，9个二类)"></a>动词(1个一类，9个二类)</h3><table>
<thead>
<tr>
<th>字母</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>v</td>
<td>动词</td>
</tr>
<tr>
<td>vd</td>
<td>副动词</td>
</tr>
<tr>
<td>vn</td>
<td>名动词</td>
</tr>
<tr>
<td>vshi</td>
<td>动词“是”</td>
</tr>
<tr>
<td>vyou</td>
<td>动词“有”</td>
</tr>
<tr>
<td>vf</td>
<td>趋向动词</td>
</tr>
<tr>
<td>vx</td>
<td>形式动词</td>
</tr>
<tr>
<td>vi</td>
<td>不及物动词（内动词）</td>
</tr>
<tr>
<td>vl</td>
<td>动词性惯用语</td>
</tr>
<tr>
<td>vg</td>
<td>动词性语素</td>
</tr>
</tbody>
</table>
<h3 id="标点符号-1个一类，16个二类"><a href="#标点符号-1个一类，16个二类" class="headerlink" title="标点符号(1个一类，16个二类)"></a>标点符号(1个一类，16个二类)</h3><table>
<thead>
<tr>
<th>字母</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>w</td>
<td>标点符号</td>
</tr>
<tr>
<td>wkz</td>
<td>左括号，全角：（ 〔 ［ ｛ 《 【 〖 〈 半角：( [ { &lt;</td>
</tr>
<tr>
<td>wky</td>
<td>右括号，全角：） 〕 ］ ｝ 》 】 〗 〉 半角： ) ] { &gt;</td>
</tr>
<tr>
<td>wyz</td>
<td>左引号，全角：“ ‘ 『</td>
</tr>
<tr>
<td>wyy</td>
<td>右引号，全角：” ’ 』</td>
</tr>
<tr>
<td>wj</td>
<td>句号，全角：。</td>
</tr>
<tr>
<td>ww</td>
<td>问号，全角：？ 半角：?</td>
</tr>
<tr>
<td>wt</td>
<td>叹号，全角：！ 半角：!</td>
</tr>
<tr>
<td>wd</td>
<td>逗号，全角：， 半角：,</td>
</tr>
<tr>
<td>wf</td>
<td>分号，全角：； 半角： ;</td>
</tr>
<tr>
<td>wn</td>
<td>顿号，全角：、</td>
</tr>
<tr>
<td>wm</td>
<td>冒号，全角：： 半角： :</td>
</tr>
<tr>
<td>ws</td>
<td>省略号，全角：…… …</td>
</tr>
<tr>
<td>wp</td>
<td>破折号，全角：—— －－ ——－ 半角：— —-</td>
</tr>
<tr>
<td>wb</td>
<td>百分号千分号，全角：％ ‰ 半角：%</td>
</tr>
<tr>
<td>wh</td>
<td>单位符号，全角：￥ ＄ ￡ ° ℃ 半角：$</td>
</tr>
</tbody>
</table>
<h3 id="字符串-1个一类，2个二类"><a href="#字符串-1个一类，2个二类" class="headerlink" title="字符串(1个一类，2个二类)"></a>字符串(1个一类，2个二类)</h3><table>
<thead>
<tr>
<th>字母</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>x</td>
<td>字符串</td>
</tr>
<tr>
<td>xx</td>
<td>非语素字</td>
</tr>
<tr>
<td>xu</td>
<td>网址URL</td>
</tr>
</tbody>
</table>
<h3 id="语气词-1个一类"><a href="#语气词-1个一类" class="headerlink" title="语气词(1个一类)"></a>语气词(1个一类)</h3><table>
<thead>
<tr>
<th>字母</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>y</td>
<td>语气词(delete yg)</td>
</tr>
</tbody>
</table>
<h3 id="状态词-1个一类"><a href="#状态词-1个一类" class="headerlink" title="状态词(1个一类)"></a>状态词(1个一类)</h3><table>
<thead>
<tr>
<th>字母</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>z</td>
<td>状态词</td>
</tr>
</tbody>
</table>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color1">jieba</a>
        		</li>
      		
		</ul>
	</div>

      
	<div class="article-category tagcloud">
		<i class="icon-book icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="/categories/python语言基础//" class="article-tag-list-link color1">python语言基础</a>
        		</li>
      		
		</ul>
	</div>


      
        <p class="article-more-link">
          <a class="article-more-a" href="/2018/07/18/jieba分词/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>





<!-- 目录内容 -->
             
        <!-- 目录内容结束 -->
  
    <article id="post-Celery任务调度" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/07/18/Celery任务调度/">Celery任务调度</a>
    </h1>
  

        
        <a href="/2018/07/18/Celery任务调度/" class="archive-article-date">
  	<time datetime="2018-07-18T07:07:28.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2018-07-18</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Celery任务调度"><a href="#Celery任务调度" class="headerlink" title="Celery任务调度"></a>Celery任务调度</h1><h2 id="一、Celery任务调度简单示例"><a href="#一、Celery任务调度简单示例" class="headerlink" title="一、Celery任务调度简单示例"></a>一、Celery任务调度简单示例</h2><ul>
<li>环境：Linux，Celery，Flower</li>
<li>脚本：tasks.py</li>
<li>功能：任务调度；任务运行状态监控和日志显示</li>
<li>安装：<ul>
<li>pip install flower</li>
<li>pip install celery==3.1.25 </li>
<li>redis数据库或者RabbitMQ百度安装吧，不属于python包范畴了。（放消息队列的经纪人，用其中一个就行，更推荐第二种，因为我暂时不会第二种，用了第一种）</li>
</ul>
</li>
<li>tasks.py代码如下：</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> celery <span class="keyword">import</span> Celery,platforms</span><br><span class="line"></span><br><span class="line">app = Celery(<span class="string">'tasks'</span>,backend=<span class="string">'amqp'</span>,，broker=<span class="string">'amqp://public:qfZjSmJjDs51EyIk@192.168.12.103:5672/'</span>)     </span><br><span class="line"><span class="comment">#backend:消息中间件类型，可无；broker：指定AMQP Broker(Advanced Message Queue Protocal，高级消息队列协议 消息中间件)</span></span><br><span class="line">platforms.C_FORCE_ROOT = <span class="keyword">True</span>       <span class="comment">#用户解决root用户无法启动worker的问题</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.task                           #对函数做celery task注解              </span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(x,y)</span>:</span><span class="comment">#烂大街的举例函数，就先用这个吧</span></span><br><span class="line">    <span class="keyword">return</span> x + y</span><br></pre></td></tr></table></figure>
<p>命令行内输入：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">celery</span> -A tasks worker -l <span class="literal">info</span></span><br></pre></td></tr></table></figure>
<p>worker便启动了</p>
<p>此时在文件目录下打开新窗口进入python或者ipython都可以：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> tasks <span class="keyword">import</span> add</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>add.delay(<span class="number">2</span>,<span class="number">34</span>)</span><br></pre></td></tr></table></figure>
<p>这时你在第一个窗口就能看到效果了。</p>
<h2 id="flower监控"><a href="#flower监控" class="headerlink" title="flower监控"></a>flower监控</h2><p>这玩意是干啥的呢？</p>
<p>就是消息队列啥的都让他在浏览器上显示</p>
<h3 id="第一种方法："><a href="#第一种方法：" class="headerlink" title="第一种方法："></a>第一种方法：</h3><ul>
<li>在tasks.py同级目录执行<code>celery flower -A tasks --address=127.0.0.1 –-port=5555</code>，启动worker，绑定flower监控并设置监控端口；</li>
<li>或者开两个进程分别执行<code>celery -A tasks worker -l info和celery -A tasks flower –port=5555</code>，效果也一样。 
　　</li>
</ul>
<p>worker启动后，另开进程进入task.py目录，执行如下代码，会在<code>localhost:5555</code>的监控页面看到tasks运行结果。</p>
<p><a href="http://flower.readthedocs.org/en/latest/install.html#usage" target="_blank" rel="noopener">详细内容点我</a></p>
<h3 id="第二种方法"><a href="#第二种方法" class="headerlink" title="第二种方法"></a>第二种方法</h3><ul>
<li>celery flower –broker=amqp://用户名:密码@localhost:5672//  或</li>
<li>celery flower –broker=redis://用户名:密码@localhost:6379/0</li>
</ul>
<p>访问 <a href="http://localhost:5555/" target="_blank" rel="noopener">http://localhost:5555/</a> 即可。</p>
<h2 id="二-Celery定时任务示例"><a href="#二-Celery定时任务示例" class="headerlink" title="二.Celery定时任务示例"></a>二.Celery定时任务示例</h2><ul>
<li>脚本：tasks.py，config.py（配置文件）</li>
<li>功能：Crontab定时，Periodic Task </li>
</ul>
<p>tasks.py代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> celery <span class="keyword">import</span> Celery,platforms</span><br><span class="line"></span><br><span class="line">app = Celery(<span class="string">'tasks'</span>)</span><br><span class="line">app.config_from_object(<span class="string">'config'</span>) <span class="comment">#参数跟下面的文件名一样   #以config.py作为配置文件导入参数</span></span><br><span class="line">platforms.C_FORCE_ROOT = <span class="keyword">True</span><span class="comment">#它的意思跟上面一样，</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.task</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(x,y)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> x + y</span><br></pre></td></tr></table></figure>
<p>config.py代码如下：<br><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> absolute_import          #如果没有这一行，下一行可能会出错          </span><br><span class="line"><span class="keyword">from</span> celery.schedules <span class="keyword">import</span> crontab</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> timedelta</span><br><span class="line"></span><br><span class="line">BROKER_URL = <span class="string">'amqp://public:qfZjSmJjDs51EyIk@192.168.12.103:5672/'</span></span><br><span class="line"></span><br><span class="line"># Crontab定时任务的设置方式</span><br><span class="line"># CELERYBEAT_SCHEDULE = &#123;</span><br><span class="line">#     <span class="string">'every-minute'</span>: &#123;</span><br><span class="line">#         <span class="string">'task'</span>: <span class="string">'tasks.add'</span>,</span><br><span class="line">#         <span class="string">'schedule'</span>: crontab(minute=<span class="string">'*/1'</span>),       #crontab的参数设置见后面</span><br><span class="line">#         <span class="string">'args'</span>: (<span class="number">1</span>,<span class="number">2</span>),</span><br><span class="line">#     &#125;,</span><br><span class="line"># &#125;</span><br><span class="line"></span><br><span class="line"># Periodic task的设置方式</span><br><span class="line">CELERYBEAT_SCHEDULE = &#123;</span><br><span class="line">    <span class="string">'add-every-2-seconds'</span>: &#123;</span><br><span class="line">        <span class="string">'task'</span>: <span class="string">'tasks.add'</span>,</span><br><span class="line">        <span class="string">'schedule'</span>: timedelta(seconds=<span class="number">2</span>),</span><br><span class="line">        <span class="string">'args'</span>: (<span class="number">16</span>, <span class="number">10</span>),</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">CELERY_TIMEZONE = <span class="string">'UTC'</span>  #时区设置，也可以为<span class="string">'Europe/London'</span></span><br></pre></td></tr></table></figure></p>
<ul>
<li>在脚本同级目录执行<code>celery -A tasks worker -B</code>，即启动worker和beat服务；</li>
<li>或者先用<code>celery -A proj worker –loglevel=INFO</code>启动worker，再用<code>celery -A tasks beat -s celerybeat-schedule</code> #这里的celerybeat-schedule指定一个记录文件**启动beat服务也行。 
　　</li>
</ul>
<p>同上也可以用浏览器打开<code>localhost:8083</code>查看tasks运行状态与详细日志<br><img src="https://img-blog.csdn.net/20160229172442670" alt="image"></p>
<table>
<thead>
<tr>
<th>写法</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>crontab()</td>
<td>每分钟执行</td>
</tr>
<tr>
<td>crontab(minute=0, hour=0)</td>
<td>每天午夜执行</td>
</tr>
<tr>
<td>crontab(minute=0, hour=’*/3’)</td>
<td>每三个小时执行: 午夜, 3am, 6am, 9am, 正午, 3pm, 6pm, 9pm.</td>
</tr>
<tr>
<td>crontab(minute=0,hour=’0,3,6,9,12,15,18,21’)</td>
<td>同上</td>
</tr>
<tr>
<td>crontab(minute=’*/15’)</td>
<td>每15分钟执行</td>
</tr>
<tr>
<td>crontab(day_of_week=’sunday’)</td>
<td>星期日每分钟</td>
</tr>
<tr>
<td>crontab(minute=’‘,hour=’‘, day_of_week=’sun’)</td>
<td>同上</td>
</tr>
<tr>
<td>crontab(minute=’*/10’,hour=’3,17,22’, day_of_week=’thu,fri’)</td>
<td>每10分钟执行，仅限于周六日3-4 am, 5-6 pm, and 10-11 pm</td>
</tr>
<tr>
<td>crontab(minute=0, hour=’/2,/3’)</td>
<td>偶数小时或者能被3整除的小时数执行</td>
</tr>
<tr>
<td>crontab(minute=0, hour=’*/5’)</td>
<td>被5整除的小时数，如3pm</td>
</tr>
<tr>
<td>crontab(minute=0, hour=’*/3,8-17’)</td>
<td>8am-5pm能被3整除的</td>
</tr>
<tr>
<td>crontab(0, 0, day_of_month=’2’)</td>
<td>每月第2天</td>
</tr>
<tr>
<td>crontab(0, 0,day_of_month=’2-30/3’)</td>
<td>每偶数天</td>
</tr>
<tr>
<td>crontab(0, 0,day_of_month=’1-7,15-21’)</td>
<td>每月1和3周</td>
</tr>
<tr>
<td>crontab(0, 0, day_of_month=’11’,month_of_year=’5’)</td>
<td>每年5月11日</td>
</tr>
<tr>
<td>crontab(0, 0,month_of_year=’*/3’)</td>
<td>每个季度第1月</td>
</tr>
</tbody>
</table>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color2">Celery</a>
        		</li>
      		
		</ul>
	</div>

      
	<div class="article-category tagcloud">
		<i class="icon-book icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="/categories/python语言基础//" class="article-tag-list-link color1">python语言基础</a>
        		</li>
      		
		</ul>
	</div>


      
        <p class="article-more-link">
          <a class="article-more-a" href="/2018/07/18/Celery任务调度/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>





<!-- 目录内容 -->
             
        <!-- 目录内容结束 -->
  
    <article id="post-Scrapy信号机制" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/07/15/Scrapy信号机制/">Scrapy信号机制</a>
    </h1>
  

        
        <a href="/2018/07/15/Scrapy信号机制/" class="archive-article-date">
  	<time datetime="2018-07-15T15:07:02.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2018-07-15</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>需求：想让程序完成某样事情之后发生一个信号，或着。。。不或者了，反正是就是发送信号的。哼。</p>
<h2 id="首先看一下scrapy-dispatcher"><a href="#首先看一下scrapy-dispatcher" class="headerlink" title="首先看一下scrapy dispatcher"></a>首先看一下scrapy dispatcher</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pydispatch <span class="keyword">import</span> dispatcher</span><br><span class="line"></span><br><span class="line">SIGNAL = <span class="string">'aa'</span></span><br><span class="line">SIGNAL1 = <span class="string">'bb'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">handle_event</span><span class="params">(sender)</span>:</span></span><br><span class="line">    print(<span class="string">'signal aa is send by'</span>, sender)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">handle_event1</span><span class="params">(sender)</span>:</span></span><br><span class="line">    print(<span class="string">'signal bb is send by'</span>, sender)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">dispatcher.connect(handle_event, signal=SIGNAL, sender=dispatcher.Any)</span><br><span class="line">dispatcher.connect(handle_event1, signal=SIGNAL1, sender=dispatcher.Any)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line"></span><br><span class="line">    dispatcher.send(signal=SIGNAL, sender=<span class="string">"打印中的sender"</span>)</span><br></pre></td></tr></table></figure>
<p>输出结果：<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">signal aa <span class="keyword">is</span> send <span class="keyword">by</span> 打印中的sender</span><br></pre></td></tr></table></figure></p>
<h2 id="Signals信号槽"><a href="#Signals信号槽" class="headerlink" title="Signals信号槽"></a>Signals信号槽</h2><p>看了 scrapy 的官方文档，关于 signals 的函数在 from_crawler()中有如下示例代码：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">crawler.signals.connect(ext.spider_opened, signal=signals.spider_opened) <span class="comment">#代码 1 </span></span><br><span class="line">crawler.signals.connect(ext.spider_closed, signal=signals.spider_closed) <span class="comment">#代码 2  </span></span><br><span class="line"></span><br><span class="line">对应两个方法定义如下： </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">spider_opened</span><span class="params">(<span class="keyword">self</span>, spider)</span></span>: </span><br><span class="line">    spider.log(<span class="string">"opened spider %s"</span> % spider.name) </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">spider_closed</span><span class="params">(<span class="keyword">self</span>, spider)</span></span>: </span><br><span class="line">    spider.log(<span class="string">"closed spider %s"</span> % spider.name)</span><br></pre></td></tr></table></figure>
<h2 id="两个都用"><a href="#两个都用" class="headerlink" title="两个都用"></a>两个都用</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> scrapy.xlib.pydispatch <span class="keyword">import</span> dispatcher</span><br><span class="line"><span class="keyword">from</span> scrapy <span class="keyword">import</span> signals</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">    dispatcher.connect(self.spider_stopped, signals.engine_stopped)<span class="comment">##建立信号和槽，在爬虫结束时调用</span></span><br><span class="line">    dispatcher.connect(self.spider_closed, signals.spider_closed)<span class="comment">##建立信号和槽，在爬虫关闭时调用</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">#爬虫关闭时 调用本方法</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">spider_closed</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">"i close"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#爬虫结束时 调用本方法</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">spider_stopped</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">"i done"</span>)</span><br></pre></td></tr></table></figure>
<p>spider类初始化时就绑定了两个方法,<code>spider_closed</code>和<code>spider_stopped</code><br>其实还有好多，具体看<a href="https://link.jianshu.com/?t=http%3A%2F%2Fdocs.pythontab.com%2Fscrapy%2Fscrapy0.24%2Ftopics%2Fsignals.html" target="_blank" rel="noopener">官方文档</a></p>
<h6 id="注意，-signals-spider-closed比signals-engine-stopped先执行"><a href="#注意，-signals-spider-closed比signals-engine-stopped先执行" class="headerlink" title="注意， signals.spider_closed比signals.engine_stopped先执行"></a>注意， signals.spider_closed比signals.engine_stopped先执行</h6><h2 id="完整点的看一下"><a href="#完整点的看一下" class="headerlink" title="完整点的看一下"></a>完整点的看一下</h2><p>这个是我在网上粘的python2的代码，但是不重要，重要的是思想！<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> scrapy <span class="keyword">import</span> signals</span><br><span class="line"><span class="keyword">from</span> scrapy.xlib.pydispatch <span class="keyword">import</span> dispatcher</span><br><span class="line"><span class="keyword">from</span> scrapy.linkextractors <span class="keyword">import</span> LinkExtractor</span><br><span class="line"><span class="keyword">from</span> scrapy.spiders <span class="keyword">import</span> CrawlSpider, Rule</span><br><span class="line"><span class="keyword">from</span> items <span class="keyword">import</span> IpProxyPoolItem</span><br><span class="line"><span class="keyword">from</span> model.spider_running_log <span class="keyword">import</span> SpiderCrawlLog</span><br><span class="line"><span class="keyword">from</span> model <span class="keyword">import</span> loadSession</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProxySpiderSpider</span><span class="params">(CrawlSpider)</span>:</span></span><br><span class="line">    name = <span class="string">'MagicSpider'</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,rule)</span>:</span></span><br><span class="line">        <span class="comment">#spider启动信号和spider_opened函数绑定</span></span><br><span class="line">        dispatcher.connect(self.spider_opened, signals.spider_opened)</span><br><span class="line">        <span class="comment">#spider关闭信号和spider_spider_closed函数绑定</span></span><br><span class="line">        dispatcher.connect(self.spider_closed, signals.spider_closed)</span><br><span class="line">        self.rule = rule</span><br><span class="line">        self.name = rule.name</span><br><span class="line">        self.allowed_domains = rule.allowed_domains.split(<span class="string">','</span>)</span><br><span class="line">        self.start_urls = rule.start_urls.split(<span class="string">','</span>)</span><br><span class="line">        rule_list = []</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 添加`下一页`的规则</span></span><br><span class="line">        <span class="keyword">if</span> len(rule.next_page):</span><br><span class="line">            rule_list.append(Rule(LinkExtractor(restrict_xpaths=rule.next_page), follow=<span class="keyword">True</span>))</span><br><span class="line"></span><br><span class="line">        rule_list.append(Rule(LinkExtractor(</span><br><span class="line">            allow=rule.allow_url.split(<span class="string">','</span>),</span><br><span class="line">            unique=<span class="keyword">True</span>),</span><br><span class="line">            follow=<span class="keyword">True</span>,</span><br><span class="line">            callback=<span class="string">'parse_item'</span>))</span><br><span class="line"></span><br><span class="line">        self.rules = tuple(rule_list)</span><br><span class="line">        super(ProxySpiderSpider, self).__init__()</span><br><span class="line">    <span class="comment">#spider关闭时的逻辑</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">spider_closed</span><span class="params">(self, spider)</span>:</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">"spider is closed!"</span></span><br><span class="line">        session = loadSession()</span><br><span class="line">        log = session.query(SpiderCrawlLog).filter(SpiderCrawlLog.spiderID == self.rule.id,</span><br><span class="line">                                                   SpiderCrawlLog.endTime == <span class="keyword">None</span></span><br><span class="line">                                                   ).first()</span><br><span class="line">        log.endTime = datetime.now().strftime(<span class="string">"%Y-%m-%d %H:%M:%S"</span>)</span><br><span class="line">        log.status = <span class="string">"closed"</span></span><br><span class="line">        session.commit()</span><br><span class="line"></span><br><span class="line">    <span class="comment">#spider启动时的逻辑</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">spider_opened</span><span class="params">(self, spider)</span>:</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">"spider is running!"</span></span><br><span class="line">        item = SpiderCrawlLog(</span><br><span class="line">                              spiderID=self.rule.id,</span><br><span class="line">                              spiderName=self.rule.name,</span><br><span class="line">                              status=<span class="string">"Running..."</span>,</span><br><span class="line">                              startTime=datetime.now().strftime(<span class="string">"%Y-%m-%d %H:%M:%S"</span>),</span><br><span class="line">                              endTime=<span class="keyword">None</span>,</span><br><span class="line">                              pages=<span class="number">0</span>,</span><br><span class="line">                              items=<span class="number">0</span></span><br><span class="line">                              )</span><br><span class="line">        session = loadSession()</span><br><span class="line">        log = session.query(SpiderCrawlLog).filter(</span><br><span class="line">            SpiderCrawlLog.spiderID == self.rule.id,</span><br><span class="line">            SpiderCrawlLog.endTime == <span class="keyword">None</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 查询当前spider是否有未结束的日志</span></span><br><span class="line">        <span class="keyword">if</span> log.count() == <span class="number">0</span> :</span><br><span class="line">            session.add(item)</span><br><span class="line">            session.commit()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">parse_item</span><span class="params">(self, response)</span>:</span></span><br><span class="line">        <span class="comment"># print 'Hi, this is an item page! %s' % response.url</span></span><br><span class="line">        <span class="comment">#print response.body</span></span><br><span class="line"></span><br><span class="line">        session = loadSession()</span><br><span class="line">        log = session.query(SpiderCrawlLog).filter(SpiderCrawlLog.spiderID == self.rule.id,</span><br><span class="line">                                                   SpiderCrawlLog.endTime == <span class="keyword">None</span>).first()</span><br><span class="line">        log.pages = int(log.pages) + <span class="number">1</span></span><br><span class="line">        session.commit()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        item=IpProxyPoolItem()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> len(self.rule.loop_xpath):</span><br><span class="line">            <span class="comment"># print 'Find %d items!'% len(response.xpath(self.rule.loop_xpath))</span></span><br><span class="line">            <span class="keyword">for</span> proxy <span class="keyword">in</span> response.xpath(self.rule.loop_xpath):</span><br><span class="line">                <span class="keyword">if</span> len(self.rule.ip_xpath):</span><br><span class="line">                    tmp_ip = proxy.xpath(self.rule.ip_xpath).extract_first()</span><br><span class="line">                    ip = tmp_ip.strip() <span class="keyword">if</span> tmp_ip <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span> <span class="keyword">else</span> <span class="string">""</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    ip = <span class="string">""</span></span><br><span class="line">                <span class="keyword">if</span> len(self.rule.port_xpath):</span><br><span class="line">                    tmp_port = proxy.xpath(self.rule.port_xpath).extract_first()</span><br><span class="line">                    port = tmp_port.strip() <span class="keyword">if</span> tmp_port <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span> <span class="keyword">else</span> <span class="string">""</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    port = <span class="string">""</span></span><br><span class="line">                <span class="keyword">if</span> len(self.rule.location1_xpath):</span><br><span class="line">                    tmp_location1 = proxy.xpath(self.rule.location1_xpath).extract_first()</span><br><span class="line">                    location1 = tmp_location1.strip() <span class="keyword">if</span> tmp_location1 <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span> <span class="keyword">else</span> <span class="string">""</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    location1 = <span class="string">""</span></span><br><span class="line">                <span class="keyword">if</span> len(self.rule.location2_xpath):</span><br><span class="line">                    tmp_location2 = proxy.xpath(self.rule.location2_xpath).extract_first()</span><br><span class="line">                    location2 = tmp_location2.strip() <span class="keyword">if</span> tmp_location2 <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span> <span class="keyword">else</span> <span class="string">""</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    location2 = <span class="string">""</span></span><br><span class="line">                <span class="keyword">if</span> len(self.rule.lifetime_xpath):</span><br><span class="line">                    tmp_lifetime = proxy.xpath(self.rule.lifetime_xpath).extract_first()</span><br><span class="line">                    lifetime = tmp_lifetime.strip() <span class="keyword">if</span> tmp_lifetime <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span> <span class="keyword">else</span> <span class="string">""</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    lifetime = <span class="string">""</span></span><br><span class="line">                <span class="keyword">if</span> len(self.rule.lastcheck_xpath):</span><br><span class="line">                    tmp_lastcheck = proxy.xpath(self.rule.lastcheck_xpath).extract_first()</span><br><span class="line">                    lastcheck = tmp_lastcheck.strip() <span class="keyword">if</span> tmp_lastcheck <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span> <span class="keyword">else</span> <span class="string">""</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    lastcheck = <span class="string">""</span></span><br><span class="line">                <span class="keyword">if</span> len(self.rule.level_xpath):</span><br><span class="line">                    tmp_level = proxy.xpath(self.rule.level_xpath).extract_first()</span><br><span class="line">                    level = tmp_level.strip() <span class="keyword">if</span> tmp_level <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span> <span class="keyword">else</span> <span class="string">""</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    level = <span class="string">""</span></span><br><span class="line">                <span class="keyword">if</span> len(self.rule.type_xpath):</span><br><span class="line">                    tmp_type = proxy.xpath(self.rule.type_xpath).extract_first()</span><br><span class="line">                    type = tmp_type.strip() <span class="keyword">if</span> tmp_type <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span> <span class="keyword">else</span> <span class="string">""</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    type = <span class="string">""</span></span><br><span class="line">                <span class="keyword">if</span> len(self.rule.speed_xpath):</span><br><span class="line">                    tmp_speed = proxy.xpath(self.rule.speed_xpath).extract_first()</span><br><span class="line">                    speed = tmp_speed.strip() <span class="keyword">if</span> tmp_speed <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span> <span class="keyword">else</span> <span class="string">""</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    speed = <span class="string">""</span></span><br><span class="line"></span><br><span class="line">                item[<span class="string">'ip_port'</span>]=(<span class="string">":"</span>.join([ip,port])) <span class="keyword">if</span> len(port) <span class="keyword">else</span> ip</span><br><span class="line">                item[<span class="string">'type'</span>]=type</span><br><span class="line">                item[<span class="string">'level'</span>]=level</span><br><span class="line">                item[<span class="string">'location'</span>]=(<span class="string">" "</span>.join([location1,location2])) <span class="keyword">if</span> location2 <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span> <span class="keyword">and</span> len(location2) <span class="keyword">else</span> location1</span><br><span class="line">                item[<span class="string">'speed'</span>]=speed</span><br><span class="line">                item[<span class="string">'lifetime'</span>]=lifetime</span><br><span class="line">                item[<span class="string">'lastcheck'</span>]=lastcheck</span><br><span class="line">                item[<span class="string">'rule_id'</span>]=self.rule.id</span><br><span class="line">                item[<span class="string">'source'</span>]=response.url</span><br><span class="line">                <span class="keyword">yield</span> item</span><br></pre></td></tr></table></figure></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>这几个代码总能搞清楚这个信号机制怎么用了吧。</p>
<p>参考：</p>
<ul>
<li><a href="http://jinbitou.net/2016/12/19/2271.html" target="_blank" rel="noopener">http://jinbitou.net/2016/12/19/2271.html</a></li>
<li><a href="https://blog.csdn.net/u011429899/article/details/79458406" target="_blank" rel="noopener">https://blog.csdn.net/u011429899/article/details/79458406</a></li>
<li><a href="https://www.jianshu.com/p/d4668a5d3b61" target="_blank" rel="noopener">https://www.jianshu.com/p/d4668a5d3b61</a></li>
<li><a href="http://docs.pythontab.com/scrapy/scrapy0.24/topics/api.html#topics-api-signals" target="_blank" rel="noopener">http://docs.pythontab.com/scrapy/scrapy0.24/topics/api.html#topics-api-signals</a></li>
</ul>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color3">爬虫</a>
        		</li>
      		 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color2">Scrapy</a>
        		</li>
      		 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color3">信号</a>
        		</li>
      		
		</ul>
	</div>

      
	<div class="article-category tagcloud">
		<i class="icon-book icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="/categories/爬虫//" class="article-tag-list-link color3">爬虫</a>
        		</li>
      		
		</ul>
	</div>


      
        <p class="article-more-link">
          <a class="article-more-a" href="/2018/07/15/Scrapy信号机制/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>





<!-- 目录内容 -->
             
        <!-- 目录内容结束 -->
  
    <article id="post-Scrapy对接Selenium" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/07/15/Scrapy对接Selenium/">Scrapy对接Selenium</a>
    </h1>
  

        
        <a href="/2018/07/15/Scrapy对接Selenium/" class="archive-article-date">
  	<time datetime="2018-07-15T14:22:27.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2018-07-15</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Scrapy抓取页面的方式和requests库类似，都是直接模拟HTTP请求，而Scrapy也不能抓取JavaScript动态渲染的页面。在前文中抓取JavaScript渲染的页面有两种方式。一种是分析Ajax请求，找到其对应的接口抓取，Scrapy同样可以用此种方式抓取。另一种是直接用Selenium或Splash模拟浏览器进行抓取，我们不需要关心页面后台发生的请求，也不需要分析渲染过程，只需要关心页面最终结果即可，可见即可爬。那么，如果Scrapy可以对接Selenium，那Scrapy就可以处理任何网站的抓取了。</p>
<h2 id="一、本节目标"><a href="#一、本节目标" class="headerlink" title="一、本节目标"></a>一、本节目标</h2><p>本节我们来看看Scrapy框架如何对接Selenium，以PhantomJS进行演示。我们依然抓取淘宝商品信息，抓取逻辑和前文中用Selenium抓取淘宝商品完全相同。</p>
<h2 id="二、准备工作"><a href="#二、准备工作" class="headerlink" title="二、准备工作"></a>二、准备工作</h2><p>请确保PhantomJS和MongoDB已经安装好并可以正常运行，安装好Scrapy、Selenium、PyMongo库。</p>
<h2 id="三、新建项目"><a href="#三、新建项目" class="headerlink" title="三、新建项目"></a>三、新建项目</h2><p>首先新建项目，名为<code>scrapyseleniumtest</code>，命令如下所示：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scrapy startproject scrapyseleniumtest</span><br></pre></td></tr></table></figure>
<p>新建一个Spider，命令如下所示：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scrapy genspider taobao www<span class="selector-class">.taobao</span><span class="selector-class">.com</span></span><br></pre></td></tr></table></figure>
<p>修改ROBOTSTXT_OBEY为False，如下所示：</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">ROBOTSTXT_OBEY</span> = <span class="literal">False</span></span><br></pre></td></tr></table></figure>
<h2 id="四、定义-Item"><a href="#四、定义-Item" class="headerlink" title="四、定义 Item"></a>四、定义 Item</h2><p>首先定义Item对象，名为ProductItem，代码如下所示：</p>
<figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">from</span> scrapy <span class="keyword">import</span> Item, Field</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="type">ProductItem</span>(<span class="type">Item</span>):</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">    collection = 'products'</span></span><br><span class="line"><span class="class">    image = <span class="type">Field</span>()</span></span><br><span class="line"><span class="class">    price = <span class="type">Field</span>()</span></span><br><span class="line"><span class="class">    deal = <span class="type">Field</span>()</span></span><br><span class="line"><span class="class">    title = <span class="type">Field</span>()</span></span><br><span class="line"><span class="class">    shop = <span class="type">Field</span>()</span></span><br><span class="line"><span class="class">    location = <span class="type">Field</span>()</span></span><br></pre></td></tr></table></figure>
<p>这里我们定义了6个Field，也就是6个字段，跟之前的案例完全相同。然后定义了一个collection属性，即此Item保存的MongoDB的Collection名称。</p>
<p>初步实现Spider的start_requests()方法，如下所示：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> scrapy <span class="keyword">import</span> Request, Spider</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> quote</span><br><span class="line"><span class="keyword">from</span> scrapyseleniumtest.items <span class="keyword">import</span> ProductItem</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TaobaoSpider</span><span class="params">(Spider)</span>:</span></span><br><span class="line">    name = <span class="string">'taobao'</span></span><br><span class="line">    allowed_domains = [<span class="string">'www.taobao.com'</span>]</span><br><span class="line">    base_url = <span class="string">'https://s.taobao.com/search?q='</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">start_requests</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">for</span> keyword <span class="keyword">in</span> self.settings.get(<span class="string">'KEYWORDS'</span>):</span><br><span class="line">            <span class="keyword">for</span> page <span class="keyword">in</span> range(<span class="number">1</span>, self.settings.get(<span class="string">'MAX_PAGE'</span>) + <span class="number">1</span>):</span><br><span class="line">                url = self.base_url + quote(keyword)</span><br><span class="line">                <span class="keyword">yield</span> Request(url=url, callback=self.parse, meta=&#123;<span class="string">'page'</span>: page&#125;, dont_filter=<span class="keyword">True</span>)</span><br></pre></td></tr></table></figure>
<p>首先定义了一个base_url，即商品列表的URL，其后拼接一个搜索关键字就是该关键字在淘宝的搜索结果商品列表页面。</p>
<p>关键字用KEYWORDS标识，定义为一个列表。最大翻页页码用MAX_PAGE表示。它们统一定义在setttings.py里面，如下所示：</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">KEYWORDS</span> = [<span class="string">'iPad'</span>]</span><br><span class="line"><span class="attr">MAX_PAGE</span> = <span class="number">100</span></span><br></pre></td></tr></table></figure>
<p>在start_requests()方法里，我们首先遍历了关键字，遍历了分页页码，构造并生成Request。由于每次搜索的URL是相同的，所以分页页码用meta参数来传递，同时设置dont_filter不去重。这样爬虫启动的时候，就会生成每个关键字对应的商品列表的每一页的请求了。</p>
<h2 id="五、对接-Selenium"><a href="#五、对接-Selenium" class="headerlink" title="五、对接 Selenium"></a>五、对接 Selenium</h2><p>接下来我们需要处理这些请求的抓取。这次我们对接Selenium进行抓取，采用Downloader Middleware来实现。在Middleware里面的process_request()方法里对每个抓取请求进行处理，启动浏览器并进行页面渲染，再将渲染后的结果构造一个HtmlResponse对象返回。代码实现如下所示：</p>
<figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="title">from</span> selenium.common.exceptions <span class="keyword">import</span> TimeoutException</span><br><span class="line"><span class="title">from</span> selenium.webdriver.common.by <span class="keyword">import</span> By</span><br><span class="line"><span class="title">from</span> selenium.webdriver.support.ui <span class="keyword">import</span> WebDriverWait</span><br><span class="line"><span class="title">from</span> selenium.webdriver.support <span class="keyword">import</span> expected_conditions <span class="keyword">as</span> EC</span><br><span class="line"><span class="title">from</span> scrapy.http <span class="keyword">import</span> HtmlResponse</span><br><span class="line"><span class="title">from</span> logging <span class="keyword">import</span> getLogger</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="type">SeleniumMiddleware</span>():</span></span><br><span class="line"><span class="class">    def __init__(<span class="title">self</span>, <span class="title">timeout</span>=<span class="type">None</span>, <span class="title">service_args</span>=[]):</span></span><br><span class="line"><span class="class">        self.logger = getLogger(<span class="title">__name__</span>)</span></span><br><span class="line"><span class="class">        self.timeout = timeout</span></span><br><span class="line"><span class="class">        self.browser = webdriver.<span class="type">PhantomJS</span>(<span class="title">service_args</span>=<span class="title">service_args</span>)</span></span><br><span class="line"><span class="class">        self.browser.set_window_size(1400, 700)</span></span><br><span class="line"><span class="class">        self.browser.set_page_load_timeout(<span class="title">self</span>.<span class="title">timeout</span>)</span></span><br><span class="line"><span class="class">        self.wait = <span class="type">WebDriverWait</span>(<span class="title">self</span>.<span class="title">browser</span>, <span class="title">self</span>.<span class="title">timeout</span>)</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">    def __del__(<span class="title">self</span>):</span></span><br><span class="line"><span class="class">        self.browser.close()</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">    def process_request(<span class="title">self</span>, <span class="title">request</span>, <span class="title">spider</span>):</span></span><br><span class="line"><span class="class">        """</span></span><br><span class="line"><span class="class">        用<span class="type">PhantomJS</span>抓取页面</span></span><br><span class="line"><span class="class">        :param request: <span class="type">Request</span>对象</span></span><br><span class="line"><span class="class">        :param spider: <span class="type">Spider</span>对象</span></span><br><span class="line"><span class="class">        :return: <span class="type">HtmlResponse</span></span></span><br><span class="line"><span class="class">        """</span></span><br><span class="line"><span class="class">        self.logger.debug('<span class="type">PhantomJS</span> <span class="title">is</span> <span class="type">Starting</span>')</span></span><br><span class="line"><span class="class">        page = request.meta.get('<span class="title">page'</span>, 1)</span></span><br><span class="line"><span class="class">        try:</span></span><br><span class="line"><span class="class">            self.browser.get(<span class="title">request</span>.<span class="title">url</span>)</span></span><br><span class="line"><span class="class">            if page &gt; 1:</span></span><br><span class="line"><span class="class">                input = self.wait.until(</span></span><br><span class="line"><span class="class">                    <span class="type">EC</span>.<span class="title">presence_of_element_located</span>((<span class="type">By</span>.<span class="type">CSS_SELECTOR</span>, '#<span class="title">mainsrp</span>-<span class="title">pager</span> <span class="title">div</span>.<span class="title">form</span> &gt; <span class="title">input'</span>)))</span></span><br><span class="line"><span class="class">                submit = self.wait.until(</span></span><br><span class="line"><span class="class">                    <span class="type">EC</span>.<span class="title">element_to_be_clickable</span>((<span class="type">By</span>.<span class="type">CSS_SELECTOR</span>, '#<span class="title">mainsrp</span>-<span class="title">pager</span> <span class="title">div</span>.<span class="title">form</span> &gt; <span class="title">span</span>.<span class="title">btn</span>.<span class="type">J_Submit</span>')))</span></span><br><span class="line"><span class="class">                input.clear()</span></span><br><span class="line"><span class="class">                input.send_keys(<span class="title">page</span>)</span></span><br><span class="line"><span class="class">                submit.click()</span></span><br><span class="line"><span class="class">            self.wait.until(<span class="type">EC</span>.<span class="title">text_to_be_present_in_element</span>((<span class="type">By</span>.<span class="type">CSS_SELECTOR</span>, '#<span class="title">mainsrp</span>-<span class="title">pager</span> <span class="title">li</span>.<span class="title">item</span>.<span class="title">active</span> &gt; <span class="title">span'</span>), str(<span class="title">page</span>)))</span></span><br><span class="line"><span class="class">            self.wait.until(<span class="type">EC</span>.<span class="title">presence_of_element_located</span>((<span class="type">By</span>.<span class="type">CSS_SELECTOR</span>, '.<span class="title">m</span>-<span class="title">itemlist</span> .<span class="title">items</span> .<span class="title">item'</span>)))</span></span><br><span class="line"><span class="class">            return <span class="type">HtmlResponse</span>(<span class="title">url</span>=<span class="title">request</span>.<span class="title">url</span>, <span class="title">body</span>=<span class="title">self</span>.<span class="title">browser</span>.<span class="title">page_source</span>, <span class="title">request</span>=<span class="title">request</span>, <span class="title">encoding</span>='<span class="title">utf</span>-8', <span class="title">status</span>=200)</span></span><br><span class="line"><span class="class">        except <span class="type">TimeoutException</span>:</span></span><br><span class="line"><span class="class">            return <span class="type">HtmlResponse</span>(<span class="title">url</span>=<span class="title">request</span>.<span class="title">url</span>, <span class="title">status</span>=500, <span class="title">request</span>=<span class="title">request</span>)</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">    @classmethod</span></span><br><span class="line"><span class="class">    def from_crawler(<span class="title">cls</span>, <span class="title">crawler</span>):</span></span><br><span class="line"><span class="class">        return cls(<span class="title">timeout</span>=<span class="title">crawler</span>.<span class="title">settings</span>.<span class="title">get</span>('<span class="type">SELENIUM_TIMEOUT</span>'),</span></span><br><span class="line"><span class="class">                   service_args=crawler.settings.get('<span class="type">PHANTOMJS_SERVICE_ARGS</span>'))</span></span><br></pre></td></tr></table></figure>
<p>首先我们在<strong>init</strong>()里对一些对象进行初始化，包括PhantomJS、WebDriverWait等对象，同时设置页面大小和页面加载超时时间。在process_request()方法中，我们通过Request的meta属性获取当前需要爬取的页码，调用PhantomJS对象的get()方法访问Request的对应的URL。这就相当于从Request对象里获取请求链接，然后再用PhantomJS加载，而不再使用Scrapy里的Downloader。</p>
<p>随后的处理等待和翻页的方法在此不再赘述，和前文的原理完全相同。最后，页面加载完成之后，我们调用PhantomJS的page_source属性即可获取当前页面的源代码，然后用它来直接构造并返回一个HtmlResponse对象。构造这个对象的时候需要传入多个参数，如url、body等，这些参数实际上就是它的基础属性。可以在官方文档查看HtmlResponse对象的结构： <a href="https://doc.scrapy.org/en/latest/topics/request-response.html" target="_blank" rel="noopener">https://doc.scrapy.org/en/latest/topics/request-response.html</a> 。</p>
<p>这样我们就成功利用PhantomJS来代替Scrapy完成了页面的加载，最后将Response返回即可。</p>
<p>有人可能会纳闷：为什么实现这么一个Downloader Middleware就可以了？之前的Request对象怎么办？Scrapy不再处理了吗？Response返回后又传递给了谁？</p>
<p>是的，Request对象到这里就不会再处理了，也不会再像以前一样交给Downloader下载。Response会直接传给Spider进行解析。</p>
<p>我们需要回顾一下Downloader Middleware的process_request()方法的处理逻辑，内容如下所示：</p>
<p>当process_request()方法返回Response对象的时候，更低优先级的Downloader Middleware的process_request()和process_exception()方法就不会被继续调用了，转而开始执行每个Downloader Middleware的process_response()方法，调用完毕之后直接将Response对象发送给Spider来处理。</p>
<p>这里直接返回了一个HtmlResponse对象，它是Response的子类，返回之后便顺次调用每个Downloader Middleware的process_response()方法。而在process_response()中我们没有对其做特殊处理，它会被发送给Spider，传给Request的回调函数进行解析。</p>
<p>到现在，我们应该能了解Downloader Middleware实现Selenium对接的原理了。</p>
<p>在settings.py里，我们设置调用刚才定义的SeleniumMiddleware，如下所示：</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">DOWNLOADER_MIDDLEWARES = &#123;</span><br><span class="line">    'scrapyseleniumtest.middlewares.SeleniumMiddleware': 543,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="六、解析页面"><a href="#六、解析页面" class="headerlink" title="六、解析页面"></a>六、解析页面</h2><p>Response对象就会回传给Spider内的回调函数进行解析。所以下一步我们就实现其回调函数，对网页来进行解析，代码如下所示：</p>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">def parse(self, response):</span><br><span class="line">    products = response.xpath(</span><br><span class="line">        <span class="string">'//div[@id="mainsrp-itemlist"]//div[@class="items"][1]//div[contains(@class, "item")]'</span>)</span><br><span class="line">    <span class="keyword">for</span> product <span class="keyword">in</span> products:</span><br><span class="line">        <span class="literal">item</span> = ProductItem()</span><br><span class="line">        <span class="literal">item</span>[<span class="string">'price'</span>] = <span class="string">''</span>.join(product.xpath(<span class="string">'.//div[contains(@class, "price")]//text()'</span>).extract()).<span class="keyword">strip</span>()</span><br><span class="line">        <span class="literal">item</span>[<span class="string">'title'</span>] = <span class="string">''</span>.join(product.xpath(<span class="string">'.//div[contains(@class, "title")]//text()'</span>).extract()).<span class="keyword">strip</span>()</span><br><span class="line">        <span class="literal">item</span>[<span class="string">'shop'</span>] = <span class="string">''</span>.join(product.xpath(<span class="string">'.//div[contains(@class, "shop")]//text()'</span>).extract()).<span class="keyword">strip</span>()</span><br><span class="line">        <span class="literal">item</span>[<span class="string">'image'</span>] = <span class="string">''</span>.join(product.xpath(<span class="string">'.//div[@class="pic"]//img[contains(@class, "img")]/@data-src'</span>).extract()).<span class="keyword">strip</span>()</span><br><span class="line">        <span class="literal">item</span>[<span class="string">'deal'</span>] = product.xpath(<span class="string">'.//div[contains(@class, "deal-cnt")]//text()'</span>).extract_first()</span><br><span class="line">        <span class="literal">item</span>[<span class="string">'location'</span>] = product.xpath(<span class="string">'.//div[contains(@class, "location")]//text()'</span>).extract_first()</span><br><span class="line">        yield <span class="literal">item</span></span><br></pre></td></tr></table></figure>
<p>在这里我们使用XPath进行解析，调用response变量的xpath()方法即可。首先我们传递选取所有商品对应的XPath，可以匹配所有商品，随后对结果进行遍历，依次选取每个商品的名称、价格、图片等内容，构造并返回一个ProductItem对象。</p>
<h2 id="七、存储结果"><a href="#七、存储结果" class="headerlink" title="七、存储结果"></a>七、存储结果</h2><p>最后我们实现一个Item Pipeline，将结果保存到MongoDB，如下所示：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">import pymongo</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MongoPipeline</span>(<span class="title">object</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(<span class="keyword">self</span>, mongo_uri, mongo_db)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">self</span>.mongo_uri = mongo_uri</span><br><span class="line">        <span class="keyword">self</span>.mongo_db = mongo_db</span><br><span class="line"></span><br><span class="line">    @classmethod</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">from_crawler</span><span class="params">(cls, crawler)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">return</span> cls(mongo_uri=crawler.settings.get(<span class="string">'MONGO_URI'</span>), mongo_db=crawler.settings.get(<span class="string">'MONGO_DB'</span>))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">open_spider</span><span class="params">(<span class="keyword">self</span>, spider)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">self</span>.client = pymongo.MongoClient(<span class="keyword">self</span>.mongo_uri)</span><br><span class="line">        <span class="keyword">self</span>.db = <span class="keyword">self</span>.client[<span class="keyword">self</span>.mongo_db]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_item</span><span class="params">(<span class="keyword">self</span>, item, spider)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">self</span>.db[item.collection].insert(dict(item))</span><br><span class="line">        <span class="keyword">return</span> item</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">close_spider</span><span class="params">(<span class="keyword">self</span>, spider)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">self</span>.client.close()</span><br></pre></td></tr></table></figure>
<p>此实现和前文中存储到MongoDB的方法完全一致，原理不再赘述。记得在settings.py中开启它的调用，如下所示：</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ITEM_PIPELINES = &#123;</span><br><span class="line">    'scrapyseleniumtest.pipelines.MongoPipeline': 300,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中，MONGO_URI和MONGO_DB的定义如下所示：</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">MONGO_URI</span> = <span class="string">'localhost'</span></span><br><span class="line"><span class="attr">MONGO_DB</span> = <span class="string">'taobao'</span></span><br></pre></td></tr></table></figure>
<h2 id="八、运行"><a href="#八、运行" class="headerlink" title="八、运行"></a>八、运行</h2><p>整个项目就完成了，执行如下命令启动抓取即可：</p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">scrapy crawl taobao</span></span><br></pre></td></tr></table></figure>
<p>运行结果如下图所示。</p>
<p><img src="https://img.colabug.com/2018/07/ny2Uvar-1.png" alt="image"></p>
<p>查看MongoDB，结果如下图所示。<br><img src="https://img.colabug.com/2018/07/VrUrYb2-1.png" alt="image"></p>
<p>这样我们便成功在Scrapy中对接Selenium并实现了淘宝商品的抓取。</p>
<h2 id="九、结语"><a href="#九、结语" class="headerlink" title="九、结语"></a>九、结语</h2><p>我们通过实现Downloader Middleware的方式实现了Selenium的对接。但这种方法其实是阻塞式的，也就是说这样就破坏了Scrapy异步处理的逻辑，速度会受到影响。为了不破坏其异步加载逻辑，我们可以使用Splash实现。下一节我们再来看看Scrapy对接<code>Splash</code>的方式。</p>
<p>转自：<a href="https://www.colabug.com/3514734.html" target="_blank" rel="noopener">https://www.colabug.com/3514734.html</a></p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color3">爬虫</a>
        		</li>
      		 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color2">Scrapy</a>
        		</li>
      		 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color4">Selenium</a>
        		</li>
      		
		</ul>
	</div>

      
	<div class="article-category tagcloud">
		<i class="icon-book icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="/categories/爬虫//" class="article-tag-list-link color3">爬虫</a>
        		</li>
      		
		</ul>
	</div>


      
        <p class="article-more-link">
          <a class="article-more-a" href="/2018/07/15/Scrapy对接Selenium/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>





<!-- 目录内容 -->
             
        <!-- 目录内容结束 -->
  
    <article id="post-logging-日志模块" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/07/15/logging-日志模块/">logging 日志模块</a>
    </h1>
  

        
        <a href="/2018/07/15/logging-日志模块/" class="archive-article-date">
  	<time datetime="2018-07-15T14:04:24.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2018-07-15</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>在 PyCon 2018 上，Mario Corchero 介绍了在开发过程中如何更方便轻松地记录日志的流程。<br><img src="https://user-gold-cdn.xitu.io/2018/6/3/163c61861faf256f?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="image"></p>
<p>整个演讲的内容包括：</p>
<ul>
<li>为什么日志记录非常重要</li>
<li>日志记录的流程是怎样的</li>
<li>怎样来进行日志记录</li>
<li>怎样进行日志记录相关配置</li>
<li>日志记录使用常见误区</li>
</ul>
<p>下面我们来梳理一下整个演讲的过程，其实其核心就是介绍了 <code>logging</code> 模块的使用方法和一些配置。</p>
<h3 id="日志记录的重要性"><a href="#日志记录的重要性" class="headerlink" title="日志记录的重要性"></a>日志记录的重要性</h3><p>在开发过程中，如果程序运行出现了问题，我们是可以使用我们自己的 Debug 工具来检测到到底是哪一步出现了问题，如果出现了问题的话，是很容易排查的。但程序开发完成之后，我们会将它部署到生产环境中去，这时候代码相当于是在一个黑盒环境下运行的，我们只能看到其运行的效果，是不能直接看到代码运行过程中每一步的状态的。在这个环境下，运行过程中难免会在某个地方出现问题，甚至这个问题可能是我们开发过程中未曾遇到的问题，碰到这种情况应该怎么办？</p>
<p>如果我们现在只能得知当前问题的现象，而没有其他任何信息的话，如果我们想要解决掉这个问题的话，那么只能根据问题的现象来试图复现一下，然后再一步步去调试，这恐怕是很难的，很大的概率上我们是无法精准地复现这个问题的，而且 <code>Debug</code> 的过程也会耗费巨多的时间，这样一旦生产环境上出现了问题，修复就会变得非常棘手。但这如果我们当时有做日志记录的话，不论是正常运行还是出现报错，都有相关的时间记录，状态记录，错误记录等，那么这样我们就可以方便地追踪到在当时的运行过程中出现了怎样的状况，从而可以快速排查问题。</p>
<p>因此，日志记录是非常有必要的，任何一款软件如果没有标准的日志记录，都不能算作一个合格的软件。作为开发者，我们需要重视并做好日志记录过程。</p>
<h3 id="日志记录的流程框架"><a href="#日志记录的流程框架" class="headerlink" title="日志记录的流程框架"></a>日志记录的流程框架</h3><p>那么在 Python 中，怎样才能算作一个比较标准的日志记录过程呢？或许很多人会使用 print 语句输出一些运行信息，然后再在控制台观察，运行的时候再将输出重定向到文件输出流保存到文件中，这样其实是非常不规范的，在 Python 中有一个标准的 <code>logging</code> 模块，我们可以使用它来进行标注的日志记录，利用它我们可以更方便地进行日志记录，同时还可以做更方便的级别区分以及一些额外日志信息的记录，如时间、运行模块信息等。</p>
<p>接下来我们先了解一下日志记录流程的整体框架。</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/6/3/163c618941cfc03f?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="image"></p>
<p>如图所示，整个日志记录的框架可以分为这么几个部分：</p>
<ul>
<li><code>Logger</code>：即 <code>Logger Main</code> Class，是我们进行日志记录时创建的对象，我们可以调用它的方法传入日志模板和信息，来生成一条条日志记录，称作 <code>Log Record</code>。</li>
<li><code>Log Record</code>：就代指生成的一条条日志记录。</li>
<li><code>Handler</code>：即用来处理日志记录的类，它可以将 <code>Log Record</code> 输出到我们指定的日志位置和存储形式等，如我们可以指定将日志通过 <code>TP</code> 协议记录到远程的服务器上，<code>Handler</code> 就会帮我们完成这些事情。</li>
<li><code>Formatter</code>：实际上生成的 <code>Log Record</code> 也是一个个对象，那么我们想要把它们保存成一条条我们想要的日志文本的话，就需要有一个格式化的过程，那么这个过程就由 Formatter 来完成，返回的就是日志字符串，然后传回给 Handler 来处理。</li>
<li>Filter：另外保存日志的时候我们可能不需要全部保存，我们可能只需要保存我们想要的部分就可以了，所以保存前还需要进行一下过滤，留下我们想要的日志，如只保存某个级别的日志，或只保存包含某个关键字的日志等，那么这个过滤过程就交给 <code>Filter</code> 来完成。</li>
<li><code>Parent Handler：Handler</code> 之间可以存在分层关系，以使得不同 <code>Handler</code> 之间共享相同功能的代码。<br>以上就是整个 <code>logging</code> 模块的基本架构和对象功能，了解了之后我们详细来了解一下 <code>logging</code> 模块的用法。</li>
</ul>
<h3 id="日志记录的相关用法"><a href="#日志记录的相关用法" class="headerlink" title="日志记录的相关用法"></a>日志记录的相关用法</h3><p>总的来说 <code>logging</code> 模块相比 <code>print</code> 有这么几个优点：</p>
<ul>
<li>可以在 <code>logging</code> 模块中设置日志等级，在不同的版本（如开发环境、生产环境）上通过设置不同的输出等级来记录对应的日志，非常灵活。</li>
<li><code>print</code> 的输出信息都会输出到标准输出流中，而 logging 模块就更加灵活，可以设置输出到任意位置，如写入文件、写入远程服务器等。</li>
<li><code>logging</code> 模块具有灵活的配置和格式化功能，如配置输出当前模块信息、运行时间等，相比 print 的字符串格式化更加方便易用。</li>
</ul>
<p>下面我们初步来了解下 <code>logging</code> 模块的基本用法，先用一个实例来感受一下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line">logging.basicConfig(level=logging.INFO, format=<span class="string">'%(asctime)s - %(name)s - %(levelname)s - %(message)s'</span>)</span><br><span class="line">logger = logging.getLogger(__name__)</span><br><span class="line"></span><br><span class="line">logger.info(<span class="string">'This is a log info'</span>)</span><br><span class="line">logger.debug(<span class="string">'Debugging'</span>)</span><br><span class="line">logger.warning(<span class="string">'Warning exists'</span>)</span><br><span class="line">logger.info(<span class="string">'Finish'</span>)</span><br></pre></td></tr></table></figure>
<p>在这里我们首先引入了 <code>logging</code> 模块，然后进行了一下基本的配置，这里通过 <code>basicConfig</code> 配置了 <code>level</code> 信息和 <code>format</code> 信息，这里 level 配置为 INFO 信息，即只输出 <code>INFO</code> 级别的信息，另外这里指定了 <code>format</code> 格式的字符串，包括 <code>asctime</code>、<code>name</code>、<code>levelname</code>、<code>message</code> 四个内容，分别代表运行时间、模块名称、日志级别、日志内容，这样输出内容便是这四者组合而成的内容了，这就是 logging 的全局配置。</p>
<p>接下来声明了一个 <code>Logger</code> 对象，它就是日志输出的主类，调用对象的 <code>info()</code> 方法就可以输出 <code>INFO</code> 级别的日志信息，调用 <code>debug()</code> 方法就可以输出 <code>DEBUG</code> 级别的日志信息，非常方便。在初始化的时候我们传入了模块的名称，这里直接使用 <code>__name__</code> 来代替了，就是模块的名称，如果直接运行这个脚本的话就是 <code>__main__</code>，如果是 <code>import</code> 的模块的话就是被引入模块的名称，这个变量在不同的模块中的名字是不同的，所以一般使用 <code>__name__</code> 来表示就好了，再接下来输出了四条日志信息，其中有两条 <code>INFO</code>、一条 <code>WARNING</code>、一条 <code>DEBUG</code> 信息，我们看下输出结果：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">2018-06-03 13:42:43,526 - __main__ - <span class="builtin-name">INFO</span> - This is a log info</span><br><span class="line">2018-06-03 13:42:43,526 - __main__ - <span class="builtin-name">WARNING</span> - <span class="builtin-name">Warning</span> exists</span><br><span class="line">2018-06-03 13:42:43,526 - __main__ - <span class="builtin-name">INFO</span> - Finish</span><br></pre></td></tr></table></figure>
<p>可以看到输出结果一共有三条日志信息，每条日志都是对应了指定的格式化内容，另外我们发现 <code>DEBUG</code> 的信息是没有输出的，这是因为我们在全局配置的时候设置了输出为 <code>INFO</code> 级别，所以 <code>DEBUG</code> 级别的信息就被过滤掉了。</p>
<p>这时如果我们将输出的日志级别设置为 <code>DEBUG</code>，就可以看到 <code>DEBUG</code> 级别的日志输出了：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">logging.basicConfig(<span class="attribute">level</span>=logging.DEBUG, <span class="attribute">format</span>=<span class="string">'%(asctime)s - %(name)s - %(levelname)s - %(message)s'</span>)</span><br></pre></td></tr></table></figure>
<p>输出结果：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">2018-06-03 13:49:22,770 - __main__ - <span class="builtin-name">INFO</span> - This is a log info</span><br><span class="line">2018-06-03 13:49:22,770 - __main__ - <span class="builtin-name">DEBUG</span> - Debugging</span><br><span class="line">2018-06-03 13:49:22,770 - __main__ - <span class="builtin-name">WARNING</span> - <span class="builtin-name">Warning</span> exists</span><br><span class="line">2018-06-03 13:49:22,770 - __main__ - <span class="builtin-name">INFO</span> - Finish</span><br></pre></td></tr></table></figure>
<p>由此可见，相比 <code>print</code> 来说，通过刚才的代码，我们既可以输出时间、模块名称，又可以输出不同级别的日志信息作区分并加以过滤，是不是灵活多了？</p>
<p>当然这只是 <code>logging</code> 模块的一小部分功能，接下来我们首先来全面了解一下 <code>basicConfig</code> 的参数都有哪些：</p>
<ul>
<li><code>filename</code>：即日志输出的文件名，如果指定了这个信息之后，实际上会启用 <code>FileHandler</code>，而不再是 <code>StreamHandler</code>，这样日志信息便会输出到文件中了。</li>
<li><code>filemode</code>：这个是指定日志文件的写入方式，有两种形式，一种是 <code>w</code>，一种是 <code>a</code>，分别代表清除后写入和追加写入。</li>
<li><code>format</code>：指定日志信息的输出格式，即上文示例所示的参数，详细参数可以参考<a href="https://link.juejin.im/?target=https%3A%2F%2Fdocs.python.org%2F3%2Flibrary%2Flogging.html%3Fhighlight%3Dlogging%2520threadname%23logrecord-attributes" target="_blank" rel="noopener">python文档</a>部分参数如下所示：<ul>
<li><code>%(levelno)s</code>：打印日志级别的数值。</li>
<li><code>%(levelname)s</code>：打印日志级别的名称。</li>
<li><code>%(pathname)s</code>：打印当前执行程序的路径，其实就是sys.argv[0]。</li>
<li><code>%(filename)s</code>：打印当前执行程序名。</li>
<li><code>%(funcName)s</code>：打印日志的当前函数。</li>
<li><code>%(lineno)d</code>：打印日志的当前行号。</li>
<li><code>%(asctime)s</code>：打印日志的时间。</li>
<li><code>%(thread)d</code>：打印线程ID。</li>
<li><code>%(threadName)s</code>：打印线程名称。</li>
<li><code>%(process)d</code>：打印进程ID。</li>
<li><code>%(processName)s</code>：打印线程名称。</li>
<li><code>%(module)s</code>：打印模块名称。</li>
<li><code>%(message)s</code>：打印日志信息。</li>
</ul>
</li>
<li><code>datefmt</code>：指定时间的输出格式。</li>
<li><code>style</code>：如果 <code>format</code> 参数指定了，这个参数就可以指定格式化时的占位符风格，如 %、{、$ 等。</li>
<li><code>level</code>：指定日志输出的类别，程序会输出大于等于此级别的信息。</li>
<li><code>stream</code>：在没有指定 <code>filename</code> 的时候会默认使用 <code>StreamHandler</code>，这时 <code>stream</code> 可以指定初始化的文件流。</li>
<li><code>handlers</code>：可以指定日志处理时所使用的 <code>Handlers</code>，必须是可迭代的。<br>下面我们再用一个实例来感受一下：</li>
</ul>
<figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line"><span class="title">logging</span>.basicConfig(level=logging.<span class="type">DEBUG</span>,</span><br><span class="line">                    filename='output.log',</span><br><span class="line">                    datefmt='%<span class="type">Y</span>/%m/%d %<span class="type">H</span>:%<span class="type">M</span>:%<span class="type">S'</span>,</span><br><span class="line">                    format='%(asctime)s - %(name)s - %(levelname)s - %(lineno)d - %(<span class="keyword">module</span>)s - %(message)s')</span><br><span class="line">logger = logging.getLogger(__name__)</span><br><span class="line"></span><br><span class="line">logger.info('<span class="type">This</span> is a log info')</span><br><span class="line">logger.debug('<span class="type">Debugging</span>')</span><br><span class="line">logger.warning('<span class="type">Warning</span> exists')</span><br><span class="line">logger.info('<span class="type">Finish</span>')</span><br></pre></td></tr></table></figure>
<p>这里我们指定了输出文件的名称为 <code>output.log</code>，另外指定了日期的输出格式，其中年月日的格式变成了 <code>%Y/%m/%d</code>，另外输出的 <code>format</code> 格式增加了<code>lineno、module</code> 这两个信息，运行之后便会生成一个 <code>output.log</code> 的文件，内容如下：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">2018/06/03 14:43:26 - __main__ - <span class="builtin-name">INFO</span> - 9 - demo3 - This is a log info</span><br><span class="line">2018/06/03 14:43:26 - __main__ - <span class="builtin-name">DEBUG</span> - 10 - demo3 - Debugging</span><br><span class="line">2018/06/03 14:43:26 - __main__ - <span class="builtin-name">WARNING</span> - 11 - demo3 - <span class="builtin-name">Warning</span> exists</span><br><span class="line">2018/06/03 14:43:26 - __main__ - <span class="builtin-name">INFO</span> - 12 - demo3 - Finish</span><br></pre></td></tr></table></figure>
<p>可以看到日志便会输出到文件中，同时输出了行号、模块名称等信息。</p>
<p>以上我们通过 <code>basicConfig</code> 来进行了一些全局的配置，我们同样可以使用 <code>Formatter、Handler</code> 进行更灵活的处理，下面我们来了解一下。</p>
<h4 id="Level"><a href="#Level" class="headerlink" title="Level"></a>Level</h4><p>首先我们来了解一下输出日志的等级信息，logging 模块共提供了如下等级，每个等级其实都对应了一个数值，列表如下：</p>
<p>等级    数值</p>
<table>
<thead>
<tr>
<th>等级</th>
<th>数值</th>
</tr>
</thead>
<tbody>
<tr>
<td>CRITICAL</td>
<td>50</td>
</tr>
<tr>
<td>FATAL</td>
<td>50</td>
</tr>
<tr>
<td>ERROR</td>
<td>40</td>
</tr>
<tr>
<td>WARNING</td>
<td>30</td>
</tr>
<tr>
<td>WARN</td>
<td>30</td>
</tr>
<tr>
<td>INFO</td>
<td>20</td>
</tr>
<tr>
<td>DEBUG</td>
<td>10</td>
</tr>
<tr>
<td>NOTSET</td>
<td>0</td>
</tr>
</tbody>
</table>
<p>这里最高的等级是 <code>CRITICAL</code> 和 <code>FATAL</code>，两个对应的数值都是 <code>50</code>，另外对于 <code>WARNING</code> 还提供了简写形式 <code>WARN</code>，两个对应的数值都是 <code>30</code>。</p>
<p>我们设置了输出 <code>level</code>，系统便只会输出 <code>level</code> 数值大于或等于该 <code>level</code> 的的日志结果，例如我们设置了输出日志 <code>level</code> 为 <code>INFO</code>，那么输出级别大于等于 <code>INFO</code> 的日志，如 <code>WARNING、ERROR</code> 等，<code>DEBUG</code> 和 <code>NOSET</code> 级别的不会输出。</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">import</span> logging</span><br><span class="line"></span><br><span class="line">logger = logging.getLogger(__name__)</span><br><span class="line">logger.setLevel(level=logging.WARN)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Log</span></span><br><span class="line">logger.<span class="literal">debug</span>(<span class="string">'Debugging'</span>)</span><br><span class="line">logger.critical(<span class="string">'Critical Something'</span>)</span><br><span class="line">logger.<span class="literal">error</span>(<span class="string">'Error Occurred'</span>)</span><br><span class="line">logger.warning(<span class="string">'Warning exists'</span>)</span><br><span class="line">logger.<span class="literal">info</span>(<span class="string">'Finished'</span>)</span><br></pre></td></tr></table></figure>
<p>这里我们设置了输出级别为 <code>WARN</code>，然后对应输出了五种不同级别的日志信息，运行结果如下：</p>
<figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Critical Something</span><br><span class="line"><span class="keyword">Error </span>Occurred</span><br><span class="line">Warning exists</span><br></pre></td></tr></table></figure>
<p>可以看到只有 <code>CRITICAL、ERROR、WARNING</code> 信息输出了，<code>DEBUG、INFO</code> 信息没有输出。</p>
<h4 id="Handler"><a href="#Handler" class="headerlink" title="Handler"></a>Handler</h4><p>下面我们先来了解一下 <code>Handler</code> 的用法，看下面的实例：</p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line">logger = logging.getLogger(__name__)</span><br><span class="line">logger.setLevel(level=logging.INFO)</span><br><span class="line"><span class="keyword">handler</span> = logging.FileHandler(<span class="string">'output.log'</span>)</span><br><span class="line">formatter = logging.Formatter(<span class="string">'%(asctime)s - %(name)s - %(levelname)s - %(message)s'</span>)</span><br><span class="line"><span class="keyword">handler</span>.setFormatter(formatter)</span><br><span class="line">logger.addHandler(<span class="keyword">handler</span>)</span><br><span class="line"></span><br><span class="line">logger.info(<span class="string">'This is a log info'</span>)</span><br><span class="line">logger.debug(<span class="string">'Debugging'</span>)</span><br><span class="line">logger.<span class="keyword">warning</span>(<span class="string">'Warning exists'</span>)</span><br><span class="line">logger.info(<span class="string">'Finish'</span>)</span><br></pre></td></tr></table></figure>
<p>这里我们没有再使用 <code>basicConfig</code> 全局配置，而是先声明了一个 <code>Logger</code> 对象，然后指定了其对应的 <code>Handler</code> 为 <code>FileHandler</code> 对象，然后 <code>Handler</code> 对象还单独指定了 <code>Formatter</code> 对象单独配置输出格式，最后给 <code>Logger</code> 对象添加对应的 <code>Handler</code> 即可，最后可以发现日志就会被输出到 <code>output.log</code> 中，内容如下：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">2018-06-03 14:53:36,467 - __main__ - <span class="builtin-name">INFO</span> - This is a log info</span><br><span class="line">2018-06-03 14:53:36,468 - __main__ - <span class="builtin-name">WARNING</span> - <span class="builtin-name">Warning</span> exists</span><br><span class="line">2018-06-03 14:53:36,468 - __main__ - <span class="builtin-name">INFO</span> - Finish</span><br></pre></td></tr></table></figure>
<p>另外我们还可以使用其他的 <code>Handler</code> 进行日志的输出，<code>logging</code> 模块提供的 <code>Handler</code> 有：</p>
<ul>
<li><code>StreamHandler：logging.StreamHandler</code>；日志输出到流，可以是 <code>sys.stderr，sys.stdout</code> 或者文件。</li>
<li><code>FileHandler：logging.FileHandler</code>；日志输出到文件。</li>
<li><code>BaseRotatingHandler：logging.handlers.BaseRotatingHandler</code>；基本的日志回滚方式。</li>
<li><code>RotatingHandler</code>：<code>logging.handlers.RotatingHandler</code>；日志回滚方式，支持日志文件最大数量和日志文件回滚。</li>
<li><code>TimeRotatingHandler</code>：<code>logging.handlers.TimeRotatingHandler</code>；日志回滚方式，在一定时间区域内回滚日志文件。</li>
<li><code>SocketHandler</code>：<code>logging.handlers.SocketHandler</code>；远程输出日志到<code>TCP/IP sockets</code>。</li>
<li><code>DatagramHandler</code>：<code>logging.handlers.DatagramHandler</code>；远程输出日志到<code>UDP sockets</code>。</li>
<li><code>SMTPHandler：logging.handlers.SMTPHandler</code>；远程输出日志到邮件地址。</li>
<li><code>SysLogHandler</code>：<code>logging.handlers.SysLogHandler</code>；日志输出到<code>syslog</code>。</li>
<li><code>NTEventLogHandler</code>：l<code>ogging.handlers.NTEventLogHandler</code>；远程输出日志到<code>Windows NT/2000/X</code>P的事件日志。</li>
<li><code>MemoryHandler</code>：<code>logging.handlers.MemoryHandler</code>；日志输出到内存中的指定<code>buffer</code>。</li>
<li><code>HTTPHandler</code>：<code>logging.handlers.HTTPHandler</code>；通过”<code>GET</code>”或者”<code>POST</code>”远程输出到HTTP服务器。</li>
</ul>
<p>下面我们使用三个 <code>Handler</code> 来实现日志同时输出到控制台、文件、HTTP 服务器：</p>
<figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">import logging</span><br><span class="line"><span class="keyword">from</span> logging.handlers import HTTPHandler</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">logger = logging.getLogger(__name__)</span><br><span class="line">logger.setLevel(level=logging.DEBUG)</span><br><span class="line"></span><br><span class="line"># StreamHandler</span><br><span class="line">stream_handler = logging.StreamHandler(sys.stdout)</span><br><span class="line">stream_handler.setLevel(level=logging.DEBUG)</span><br><span class="line">logger.addHandler(stream_handler)</span><br><span class="line"></span><br><span class="line"># FileHandler</span><br><span class="line">file_handler = logging.FileHandler(<span class="string">'output.log'</span>)</span><br><span class="line">file_handler.setLevel(level=logging.INFO)</span><br><span class="line">formatter = logging.Formatter(<span class="string">'%(asctime)s - %(name)s - %(levelname)s - %(message)s'</span>)</span><br><span class="line">file_handler.setFormatter(formatter)</span><br><span class="line">logger.addHandler(file_handler)</span><br><span class="line"></span><br><span class="line"># HTTPHandler</span><br><span class="line">http_handler = HTTPHandler(host=<span class="string">'localhost:8001'</span>, url=<span class="string">'log'</span>, <span class="function"><span class="keyword">method</span>='<span class="title">POST</span>')</span></span><br><span class="line"><span class="function"><span class="title">logger</span>.<span class="title">addHandler</span><span class="params">(http_handler)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"># <span class="title">Log</span></span></span><br><span class="line"><span class="function"><span class="title">logger</span>.<span class="title">info</span><span class="params">(<span class="string">'This is a log info'</span>)</span></span></span><br><span class="line"><span class="function"><span class="title">logger</span>.<span class="title">debug</span><span class="params">(<span class="string">'Debugging'</span>)</span></span></span><br><span class="line"><span class="function"><span class="title">logger</span>.<span class="title">warning</span><span class="params">(<span class="string">'Warning exists'</span>)</span></span></span><br><span class="line"><span class="function"><span class="title">logger</span>.<span class="title">info</span><span class="params">(<span class="string">'Finish'</span>)</span></span></span><br></pre></td></tr></table></figure>
<p>运行之前我们需要先启动 <code>HTTP Server</code>，并运行在 <code>8001</code> 端口，其中 <code>log</code> 接口是用来接收日志的接口。</p>
<p>运行之后控制台输出会输出如下内容：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">This is a log info</span><br><span class="line">Debugging</span><br><span class="line"><span class="builtin-name">Warning</span> exists</span><br><span class="line">Finish</span><br></pre></td></tr></table></figure>
<p><code>output.log</code> 文件会写入如下内容：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">2018-06-03 15:13:44,895 - __main__ - <span class="builtin-name">INFO</span> - This is a log info</span><br><span class="line">2018-06-03 15:13:44,947 - __main__ - <span class="builtin-name">WARNING</span> - <span class="builtin-name">Warning</span> exists</span><br><span class="line">2018-06-03 15:13:44,949 - __main__ - <span class="builtin-name">INFO</span> - Finish</span><br></pre></td></tr></table></figure>
<p><code>HTTP Server</code> 会收到控制台输出的信息。</p>
<p>这样一来，我们就通过设置多个 <code>Handler</code> 来控制了日志的多目标输出。</p>
<p>另外值得注意的是，在这里 <code>StreamHandler</code> 对象我们没有设置 <code>Formatter</code>，因此控制台只输出了日志的内容，而没有包含时间、模块等信息，而 <code>FileHandler</code> 我们通过 <code>setFormatter()</code> 方法设置了一个 <code>Formatter</code> 对象，因此输出的内容便是格式化后的日志信息。</p>
<p>另外每个 <code>Handler</code> 还可以设置 <code>level</code> 信息，最终输出结果的 <code>level</code> 信息会取 <code>Logger</code> 对象的 <code>level</code> 和 <code>Handler</code> 对象的 <code>level</code> 的交集。</p>
<h4 id="Formatter"><a href="#Formatter" class="headerlink" title="Formatter"></a>Formatter</h4><p>在进行日志格式化输出的时候，我们可以不借助于 <code>basicConfig</code> 来全局配置格式化输出内容，可以借助于 <code>Formatter</code> 来完成，下面我们再来单独看下 <code>Formatter</code> 的用法：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">import</span> logging</span><br><span class="line"></span><br><span class="line">logger = logging.getLogger(__name__)</span><br><span class="line">logger.setLevel(level=logging.WARN)</span><br><span class="line">formatter = logging.Formatter(fmt=<span class="string">'%(asctime)s - %(name)s - %(levelname)s - %(message)s'</span>, datefmt=<span class="string">'%Y/%m/%d %H:%M:%S'</span>)</span><br><span class="line">handler = logging.StreamHandler()</span><br><span class="line">handler.setFormatter(formatter)</span><br><span class="line">logger.addHandler(handler)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Log</span></span><br><span class="line">logger.<span class="literal">debug</span>(<span class="string">'Debugging'</span>)</span><br><span class="line">logger.critical(<span class="string">'Critical Something'</span>)</span><br><span class="line">logger.<span class="literal">error</span>(<span class="string">'Error Occurred'</span>)</span><br><span class="line">logger.warning(<span class="string">'Warning exists'</span>)</span><br><span class="line">logger.<span class="literal">info</span>(<span class="string">'Finished'</span>)</span><br></pre></td></tr></table></figure>
<p>在这里我们指定了一个 <code>Formatter</code>，并传入了 <code>fmt</code> 和 <code>datefmt</code> 参数，这样就指定了日志结果的输出格式和时间格式，然后 <code>handler</code> 通过 <code>setFormatter()</code> 方法设置此 <code>Formatter</code> 对象即可，输出结果如下：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">2018/06/03 15:47:15 - __main__ - CRITICAL - Critical Something</span><br><span class="line">2018/06/03 15:47:15 - __main__ - <span class="builtin-name">ERROR</span> - <span class="builtin-name">Error</span> Occurred</span><br><span class="line">2018/06/03 15:47:15 - __main__ - <span class="builtin-name">WARNING</span> - <span class="builtin-name">Warning</span> exists</span><br></pre></td></tr></table></figure>
<p>这样我们可以每个 <code>Handler</code> 单独配置输出的格式，非常灵活。</p>
<h4 id="捕获-Traceback"><a href="#捕获-Traceback" class="headerlink" title="捕获 Traceback"></a>捕获 Traceback</h4><p>如果遇到错误，我们更希望报错时出现的详细 <code>Traceback</code> 信息，便于调试，利用 <code>logging</code> 模块我们可以非常方便地实现这个记录，我们用一个实例来感受一下：</p>
<figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">import logging</span><br><span class="line"></span><br><span class="line">logger = logging.getLogger(__name__)</span><br><span class="line">logger.setLevel(level=logging.DEBUG)</span><br><span class="line"></span><br><span class="line"><span class="meta"># Formatter</span></span><br><span class="line">formatter = logging.Formatter(<span class="string">'%(asctime)s - %(name)s - %(levelname)s - %(message)s'</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta"># FileHandler</span></span><br><span class="line">file_handler = logging.FileHandler(<span class="string">'result.log'</span>)</span><br><span class="line">file_handler.setFormatter(formatter)</span><br><span class="line">logger.addHandler(file_handler)</span><br><span class="line"></span><br><span class="line"><span class="meta"># StreamHandler</span></span><br><span class="line">stream_handler = logging.StreamHandler()</span><br><span class="line">stream_handler.setFormatter(formatter)</span><br><span class="line">logger.addHandler(stream_handler)</span><br><span class="line"></span><br><span class="line"><span class="meta"># Log</span></span><br><span class="line">logger.info(<span class="string">'Start'</span>)</span><br><span class="line">logger.warning(<span class="string">'Something maybe fail.'</span>)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    result = <span class="number">10</span> / <span class="number">0</span></span><br><span class="line">except Exception:</span><br><span class="line">    logger.error(<span class="string">'Faild to get result'</span>, exc_info=True)</span><br><span class="line">logger.info(<span class="string">'Finished'</span>)</span><br></pre></td></tr></table></figure>
<p>这里我们在 <code>error()</code> 方法中添加了一个参数，将 <code>exc_info</code>设置为了 <code>True</code>，这样我们就可以输出执行过程中的信息了，即完整的 <code>Traceback</code> 信息。</p>
<p>运行结果如下：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">2018-06-03 16:00:15,382 - __main__ - <span class="builtin-name">INFO</span> - Start <span class="builtin-name">print</span> log</span><br><span class="line">2018-06-03 16:00:15,382 - __main__ - <span class="builtin-name">DEBUG</span> - <span class="keyword">Do</span> something</span><br><span class="line">2018-06-03 16:00:15,382 - __main__ - <span class="builtin-name">WARNING</span> - Something maybe fail.</span><br><span class="line">2018-06-03 16:00:15,382 - __main__ - <span class="builtin-name">ERROR</span> - Faild <span class="keyword">to</span> <span class="builtin-name">get</span> result</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"/private/var/books/aicodes/loggingtest/demo8.py"</span>, line 23, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    result = 10 / 0</span><br><span class="line">ZeroDivisionError: division by zero</span><br><span class="line">2018-06-03 16:00:15,383 - __main__ - <span class="builtin-name">INFO</span> - Finished</span><br></pre></td></tr></table></figure>
<p>可以看到这样我们就非常方便地记录下来了报错的信息，一旦出现了错误，我们也能非常方便地排查。</p>
<h4 id="配置共享"><a href="#配置共享" class="headerlink" title="配置共享"></a>配置共享</h4><p>在写项目的时候，我们肯定会将许多配置放置在许多模块下面，这时如果我们每个文件都来配置 <code>logging</code> 配置那就太繁琐了，<code>logging</code> 模块提供了父子模块共享配置的机制，会根据 <code>Logger</code> 的名称来自动加载父模块的配置。</p>
<p>例如我们这里首先定义一个 <code>main.py</code> 文件：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">import</span> logging</span><br><span class="line">import core</span><br><span class="line"></span><br><span class="line">logger = logging.getLogger(<span class="string">'main'</span>)</span><br><span class="line">logger.setLevel(level=logging.DEBUG)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Handler</span></span><br><span class="line">handler = logging.FileHandler(<span class="string">'result.log'</span>)</span><br><span class="line">handler.setLevel(logging.INFO)</span><br><span class="line">formatter = logging.Formatter(<span class="string">'%(asctime)s - %(name)s - %(levelname)s - %(message)s'</span>)</span><br><span class="line">handler.setFormatter(formatter)</span><br><span class="line">logger.addHandler(handler)</span><br><span class="line"></span><br><span class="line">logger.<span class="literal">info</span>(<span class="string">'Main Info'</span>)</span><br><span class="line">logger.<span class="literal">debug</span>(<span class="string">'Main Debug'</span>)</span><br><span class="line">logger.<span class="literal">error</span>(<span class="string">'Main Error'</span>)</span><br><span class="line">core.run()</span><br></pre></td></tr></table></figure>
<p>这里我们配置了日志的输出格式和文件路径，同时定义了 <code>Logger</code> 的名称为 <code>main</code>，然后引入了另外一个模块 <code>core</code>，最后调用了 <code>core</code> 的 <code>run()</code> 方法。</p>
<p>接下来我们定义 <code>core.py</code>，内容如下：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">import</span> logging</span><br><span class="line"></span><br><span class="line">logger = logging.getLogger(<span class="string">'main.core'</span>)</span><br><span class="line"></span><br><span class="line">def run():</span><br><span class="line">    logger.<span class="literal">info</span>(<span class="string">'Core Info'</span>)</span><br><span class="line">    logger.<span class="literal">debug</span>(<span class="string">'Core Debug'</span>)</span><br><span class="line">    logger.<span class="literal">error</span>(<span class="string">'Core Error'</span>)</span><br></pre></td></tr></table></figure>
<p>这里我们定义了 <code>Logger</code> 的名称为 <code>main.core</code>，注意这里开头是 <code>main</code>，即刚才我们在 <code>main.py</code> 里面的 <code>Logger</code> 的名称，这样 <code>core.py</code> 里面的 <code>Logger</code> 就会复用 <code>main.py</code> 里面的<code>Logger</code> 配置，而不用再去配置一次了。</p>
<p>运行之后会生成一个 <code>result.log</code> 文件，内容如下：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">2018-06-03 16:55:56,259 - main - <span class="builtin-name">INFO</span> - Main Info</span><br><span class="line">2018-06-03 16:55:56,259 - main - <span class="builtin-name">ERROR</span> - Main Error</span><br><span class="line">2018-06-03 16:55:56,259 - main.core - <span class="builtin-name">INFO</span> - Core Info</span><br><span class="line">2018-06-03 16:55:56,259 - main.core - <span class="builtin-name">ERROR</span> - Core Error</span><br></pre></td></tr></table></figure>
<p>可以看到父子模块都使用了同样的输出配置。</p>
<p>如此一来，我们只要在入口文件里面定义好 logging 模块的输出配置，子模块只需要在定义 Logger 对象时名称使用父模块的名称开头即可共享配置，非常方便。</p>
<h4 id="文件配置"><a href="#文件配置" class="headerlink" title="文件配置"></a>文件配置</h4><p>在开发过程中，将配置在代码里面写死并不是一个好的习惯，更好的做法是将配置写在配置文件里面，我们可以将配置写入到配置文件，然后运行时读取配置文件里面的配置，这样是更方便管理和维护的，下面我们以一个实例来说明一下，首先我们定义一个 yaml 配置文件：</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">version</span>: <span class="number">1</span></span><br><span class="line"><span class="attribute">formatters</span>:</span><br><span class="line">  <span class="attribute">brief</span>:</span><br><span class="line">    <span class="attribute">format</span>: <span class="string">"%(asctime)s - %(message)s"</span></span><br><span class="line">  <span class="attribute">simple</span>:</span><br><span class="line">    <span class="attribute">format</span>: <span class="string">"%(asctime)s - %(name)s - %(levelname)s - %(message)s"</span></span><br><span class="line"><span class="attribute">handlers</span>:</span><br><span class="line">  <span class="attribute">console</span>:</span><br><span class="line">    <span class="attribute">class </span>: logging.StreamHandler</span><br><span class="line">    <span class="attribute">formatter</span>: brief</span><br><span class="line">    <span class="attribute">level   </span>: INFO</span><br><span class="line">    <span class="attribute">stream  </span>: <span class="attribute">ext</span>:<span class="comment">//sys.stdout</span></span><br><span class="line">  <span class="attribute">file</span>:</span><br><span class="line">    <span class="attribute">class </span>: logging.FileHandler</span><br><span class="line">    <span class="attribute">formatter</span>: simple</span><br><span class="line">    <span class="attribute">level</span>: DEBUG</span><br><span class="line">    <span class="attribute">filename</span>: debug.log</span><br><span class="line">  <span class="attribute">error</span>:</span><br><span class="line">    <span class="attribute">class</span>: logging.handlers.RotatingFileHandler</span><br><span class="line">    <span class="attribute">level</span>: ERROR</span><br><span class="line">    <span class="attribute">formatter</span>: simple</span><br><span class="line">    <span class="attribute">filename</span>: error.log</span><br><span class="line">    <span class="attribute">maxBytes</span>: <span class="number">10485760</span></span><br><span class="line">    <span class="attribute">backupCount</span>: <span class="number">20</span></span><br><span class="line">    <span class="attribute">encoding</span>: utf8</span><br><span class="line"><span class="attribute">loggers</span>:</span><br><span class="line">  main.<span class="attribute">core</span>:</span><br><span class="line">    <span class="attribute">level</span>: DEBUG</span><br><span class="line">    <span class="attribute">handlers</span>: [console, file, error]</span><br><span class="line"><span class="attribute">root</span>:</span><br><span class="line">  <span class="attribute">level</span>: DEBUG</span><br><span class="line">  <span class="attribute">handlers</span>: [console]</span><br></pre></td></tr></table></figure>
<p>这里我们定义了 <code>formatters、handlers、loggers、root</code> 等模块，实际上对应的就是各个 <code>Formatter、Handler、Logger</code> 的配置，参数和它们的构造方法都是相同的。</p>
<p>接下来我们定义一个主入口文件，<code>main.py</code>，内容如下：</p>
<figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">import</span> core</span><br><span class="line"><span class="keyword">import</span> yaml</span><br><span class="line"><span class="keyword">import</span> logging.config</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def setup_logging(default_path=<span class="string">'config.yaml'</span>, default_level=logging.INFO):</span><br><span class="line">    <span class="built_in">path</span> = default_path</span><br><span class="line">    <span class="keyword">if</span> os.<span class="built_in">path</span>.exists(<span class="built_in">path</span>):</span><br><span class="line">        <span class="keyword">with</span> open(<span class="built_in">path</span>, <span class="string">'r'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> f:</span><br><span class="line">            config = yaml.load(f)</span><br><span class="line">            logging.config.dictConfig(config)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        logging.basicConfig(level=default_level)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def <span class="built_in">log</span>():</span><br><span class="line">    logging.debug(<span class="string">'Start'</span>)</span><br><span class="line">    logging.info(<span class="string">'Exec'</span>)</span><br><span class="line">    logging.info(<span class="string">'Finished'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    yaml_path = <span class="string">'config.yaml'</span></span><br><span class="line">    setup_logging(yaml_path)</span><br><span class="line">    <span class="built_in">log</span>()</span><br><span class="line">    core.run()</span><br></pre></td></tr></table></figure>
<p>这里我们定义了一个 <code>setup_logging()</code> 方法，里面读取了 <code>yaml</code> 文件的配置，然后通过 <code>dictConfig()</code>方法将配置项传给了 <code>logging</code> 模块进行全局初始化。</p>
<p>另外这个模块还引入了另外一个模块 <code>core</code>，所以我们定义 <code>core.py</code> 如下：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">import</span> logging</span><br><span class="line"></span><br><span class="line">logger = logging.getLogger(<span class="string">'main.core'</span>)</span><br><span class="line"></span><br><span class="line">def run():</span><br><span class="line">    logger.<span class="literal">info</span>(<span class="string">'Core Info'</span>)</span><br><span class="line">    logger.<span class="literal">debug</span>(<span class="string">'Core Debug'</span>)</span><br><span class="line">    logger.<span class="literal">error</span>(<span class="string">'Core Error'</span>)</span><br></pre></td></tr></table></figure>
<p>这个文件的内容和上文是没有什么变化的。</p>
<p>观察配置文件，主入口文件 <code>main.py</code> 实际上对应的是 <code>root</code> 一项配置，它指定了 <code>handlers</code> 是 <code>console</code>，即只输出到控制台。另外在 <code>loggers</code> 一项配置里面，我们定义了 <code>main.core</code> 模块，<code>handlers</code> 是 <code>console</code>、<code>file</code>、<code>error</code> 三项，即输出到控制台、输出到普通文件和回滚文件。</p>
<p>这样运行之后，我们便可以看到所有的运行结果输出到了控制台：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">2018<span class="selector-tag">-06-03</span> 17<span class="selector-pseudo">:07</span><span class="selector-pseudo">:12</span>,727 <span class="selector-tag">-</span> <span class="selector-tag">Exec</span></span><br><span class="line">2018<span class="selector-tag">-06-03</span> 17<span class="selector-pseudo">:07</span><span class="selector-pseudo">:12</span>,727 <span class="selector-tag">-</span> <span class="selector-tag">Finished</span></span><br><span class="line">2018<span class="selector-tag">-06-03</span> 17<span class="selector-pseudo">:07</span><span class="selector-pseudo">:12</span>,727 <span class="selector-tag">-</span> <span class="selector-tag">Core</span> <span class="selector-tag">Info</span></span><br><span class="line">2018<span class="selector-tag">-06-03</span> 17<span class="selector-pseudo">:07</span><span class="selector-pseudo">:12</span>,727 <span class="selector-tag">-</span> <span class="selector-tag">Core</span> <span class="selector-tag">Info</span></span><br><span class="line">2018<span class="selector-tag">-06-03</span> 17<span class="selector-pseudo">:07</span><span class="selector-pseudo">:12</span>,728 <span class="selector-tag">-</span> <span class="selector-tag">Core</span> <span class="selector-tag">Error</span></span><br><span class="line">2018<span class="selector-tag">-06-03</span> 17<span class="selector-pseudo">:07</span><span class="selector-pseudo">:12</span>,728 <span class="selector-tag">-</span> <span class="selector-tag">Core</span> <span class="selector-tag">Error</span></span><br></pre></td></tr></table></figure>
<p>在 <code>debug.log</code> 文件中则包含了 <code>core.py</code> 的运行结果：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">2018-06-03 17:07:12,727 - main.core - <span class="builtin-name">INFO</span> - Core Info</span><br><span class="line">2018-06-03 17:07:12,727 - main.core - <span class="builtin-name">DEBUG</span> - Core Debug</span><br><span class="line">2018-06-03 17:07:12,728 - main.core - <span class="builtin-name">ERROR</span> - Core Error</span><br></pre></td></tr></table></figure>
<p>可以看到，通过配置文件，我们可以非常灵活地定义 <code>Handler</code>、<code>Formatter</code>、<code>Logger</code> 等配置，同时也显得非常直观，也非常容易维护，在实际项目中，推荐使用此种方式进行配置。</p>
<p>以上便是 <code>logging</code> 模块的基本使用方法，有了它，我们可以方便地进行日志管理和维护，会给我们的工作带来极大的方便。</p>
<h4 id="日志记录使用常见误区"><a href="#日志记录使用常见误区" class="headerlink" title="日志记录使用常见误区"></a>日志记录使用常见误区</h4><p>在日志输出的时候经常我们会用到字符串拼接的形式，很多情况下我们可能会使用字符串的 format() 来构造一个字符串，但这其实并不是一个好的方法，因为还有更好的方法，下面我们对比两个例子：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">import</span> logging</span><br><span class="line"></span><br><span class="line">logging.basicConfig(level=logging.DEBUG, format=<span class="string">'%(asctime)s - %(name)s - %(levelname)s - %(message)s'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># bad</span></span><br><span class="line">logging.<span class="literal">debug</span>(<span class="string">'Hello &#123;0&#125;, &#123;1&#125;!'</span>.format(<span class="string">'World'</span>, <span class="string">'Congratulations'</span>))</span><br><span class="line"><span class="comment"># good</span></span><br><span class="line">logging.<span class="literal">debug</span>(<span class="string">'Hello %s, %s!'</span>, <span class="string">'World'</span>, <span class="string">'Congratulations'</span>)</span><br></pre></td></tr></table></figure>
<p>这里有两种打印 <code>Log</code> 的方法，第一种使用了字符串的 <code>format()</code> 的方法进行构造，传给 <code>logging</code> 的只用到了第一个参数，实际上 <code>logging</code> 模块提供了字符串格式化的方法，我们只需要在第一个参数写上要打印输出的模板，占位符用<code>%s</code>、<code>%d</code> 等表示即可，然后在后续参数添加对应的值就可以了，推荐使用这种方法。</p>
<p>运行结果如下：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2018<span class="selector-tag">-06-03</span> 22<span class="selector-pseudo">:27</span><span class="selector-pseudo">:51</span>,220 <span class="selector-tag">-</span> <span class="selector-tag">root</span> <span class="selector-tag">-</span> <span class="selector-tag">DEBUG</span> <span class="selector-tag">-</span> <span class="selector-tag">Hello</span> <span class="selector-tag">World</span>, <span class="selector-tag">Congratulations</span>!</span><br><span class="line">2018<span class="selector-tag">-06-03</span> 22<span class="selector-pseudo">:27</span><span class="selector-pseudo">:51</span>,220 <span class="selector-tag">-</span> <span class="selector-tag">root</span> <span class="selector-tag">-</span> <span class="selector-tag">DEBUG</span> <span class="selector-tag">-</span> <span class="selector-tag">Hello</span> <span class="selector-tag">World</span>, <span class="selector-tag">Congratulations</span>!</span><br></pre></td></tr></table></figure>
<p><img src="https://user-gold-cdn.xitu.io/2018/6/3/163c618ce73174a9?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="image"></p>
<p>另外在进行异常处理的时候，通常我们会直接将异常进行字符串格式化，但其实可以直接指定一个参数将 <code>traceback</code> 打印出来，示例如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import logging</span><br><span class="line"></span><br><span class="line">logging.basicConfig(level=logging.DEBUG, format=<span class="string">'%(asctime)s - %(name)s - %(levelname)s - %(message)s'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    result = <span class="number">5</span> / <span class="number">0</span></span><br><span class="line">except <span class="keyword">Exception</span> <span class="keyword">as</span> e:</span><br><span class="line">    <span class="comment"># bad</span></span><br><span class="line">    logging.error(<span class="string">'Error: %s'</span>, e)</span><br><span class="line">    <span class="comment"># good</span></span><br><span class="line">    logging.error(<span class="string">'Error'</span>, exc_info=<span class="keyword">True</span>)</span><br><span class="line">    <span class="comment"># good</span></span><br><span class="line">    logging.<span class="keyword">exception</span>(<span class="string">'Error'</span>)</span><br></pre></td></tr></table></figure>
<p>如果我们直接使用字符串格式化的方法将错误输出的话，是不会包含 <code>Traceback</code> 信息的，但如果我们加上 <code>exc_info</code> 参数或者直接使用 <code>exception()</code> 方法打印的话，那就会输出 <code>Traceback</code> 信息了。</p>
<p>运行结果如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">2018-06-03 22:24:31,927 - root - ERROR - Error: division by zero</span><br><span class="line">2018-06-03 22:24:31,927 - root - ERROR - Error</span><br><span class="line">Traceback (most recent <span class="keyword">call</span> <span class="keyword">last</span>):</span><br><span class="line">  <span class="keyword">File</span> <span class="string">"/private/var/books/aicodes/loggingtest/demo9.py"</span>, line <span class="number">6</span>, <span class="keyword">in</span> &lt;<span class="keyword">module</span>&gt;</span><br><span class="line">    <span class="keyword">result</span> = <span class="number">5</span> / <span class="number">0</span></span><br><span class="line">ZeroDivisionError: division <span class="keyword">by</span> zero</span><br><span class="line"><span class="number">2018</span><span class="number">-06</span><span class="number">-03</span> <span class="number">22</span>:<span class="number">24</span>:<span class="number">31</span>,<span class="number">928</span> - root - <span class="keyword">ERROR</span> - <span class="keyword">Error</span></span><br><span class="line">Traceback (most recent <span class="keyword">call</span> <span class="keyword">last</span>):</span><br><span class="line">  <span class="keyword">File</span> <span class="string">"/private/var/books/aicodes/loggingtest/demo9.py"</span>, line <span class="number">6</span>, <span class="keyword">in</span> &lt;<span class="keyword">module</span>&gt;</span><br><span class="line">    <span class="keyword">result</span> = <span class="number">5</span> / <span class="number">0</span></span><br><span class="line">ZeroDivisionError: division <span class="keyword">by</span> zero</span><br></pre></td></tr></table></figure>
<p><img src="https://user-gold-cdn.xitu.io/2018/6/3/163c618f69092989?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="image"><br>以上便是整个对 logging 模块的介绍。嗯，是时候抛弃 print 了，开始体验下 logging 的便利吧！</p>
<p>转载自：<a href="https://cuiqingcai.com/6080.html" target="_blank" rel="noopener">https://cuiqingcai.com/6080.html</a></p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color2">python</a>
        		</li>
      		 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color3">日志</a>
        		</li>
      		
		</ul>
	</div>

      
	<div class="article-category tagcloud">
		<i class="icon-book icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="/categories/python语言基础//" class="article-tag-list-link color1">python语言基础</a>
        		</li>
      		
		</ul>
	</div>


      
        <p class="article-more-link">
          <a class="article-more-a" href="/2018/07/15/logging-日志模块/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>





<!-- 目录内容 -->
             
        <!-- 目录内容结束 -->
  
    <article id="post-Scrapyd爬虫部署（win版" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/07/14/Scrapyd爬虫部署（win版/">Scrapyd爬虫部署（win版)</a>
    </h1>
  

        
        <a href="/2018/07/14/Scrapyd爬虫部署（win版/" class="archive-article-date">
  	<time datetime="2018-07-14T10:50:30.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2018-07-14</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="https://img.colabug.com/2018/03/e66e3c71c5e8bc31600d609e97d271f4.png" alt="image"><br>用Shell配合Python做了一个离线的作业控制系统，功能是有了，但是拓展性着实有点差，对小脚本小工具来说效果还可以，但是对于大型的爬虫类以及需要灵活控制的项目，可能就不太适合了。所以要用到Scrapyd。</p>
<p>首先呢，这玩意是应该在linux用的，抱着玩一玩的心态，我们来搞一搞。</p>
<h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><p>我的编码环境如下：</p>
<ul>
<li>OS： windows10</li>
<li>Python：Python3.6</li>
<li>Scrapy: Scrapy 1.5.0</li>
<li>Scrapyd: 1.2.0</li>
<li>Scrapyd-client: 1.1.0</li>
</ul>
<p>具体的安装方式很简单，Python3.6自带了超好用的包管理工具pip，因此安装起来就很方便了。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">pip install scrapy</span><br><span class="line"><span class="comment"># 如果已经安装了scrapy ,现在想升级的话也可以使用下面的命令</span></span><br><span class="line"><span class="comment">#pip install scrapy --upgrade</span></span><br><span class="line"></span><br><span class="line">pip install scrapyd</span><br><span class="line">pip install scrapyd-client</span><br></pre></td></tr></table></figure>
<p>经过一段时间的等待，我们环境所依赖的应该就安装好了。</p>
<h2 id="修改配置"><a href="#修改配置" class="headerlink" title="修改配置"></a>修改配置</h2><p>创建完项目会有scrapy.cfg文件（创建项目就不写了，创建都不会的话，先学学框架吧）</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[settings]</span><br><span class="line">default = 项目名.settings</span><br><span class="line"></span><br><span class="line">[deploy]</span><br><span class="line"><span class="comment">#url = http://localhost:6800/  # 部署爬虫项目的时候这个注释记得打开</span></span><br><span class="line">project = 项目名</span><br></pre></td></tr></table></figure>
<h2 id="crapyd爬虫部署服务"><a href="#crapyd爬虫部署服务" class="headerlink" title="crapyd爬虫部署服务"></a>crapyd爬虫部署服务</h2><h3 id="开启scrapyd服务"><a href="#开启scrapyd服务" class="headerlink" title="开启scrapyd服务"></a>开启scrapyd服务</h3><p>在任意目录下的打开终端，输入<code>scrapyd</code>,观察是否运行成功，运行成功的话，就可以打开<code>http://localhost:6800</code>看是否正常显示．</p>
<h2 id="部署爬虫"><a href="#部署爬虫" class="headerlink" title="部署爬虫"></a>部署爬虫</h2><p>服务已经开启，这个时候要记得打开<code>scrapy.cfg</code>中的deploy的url参数。否则scrapy爬虫部署可能就失败了。</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[deploy:target]</span></span><br><span class="line"><span class="attr">url</span> = http://localhost:<span class="number">6800</span>/</span><br><span class="line"><span class="attr">project</span> = 项目名</span><br></pre></td></tr></table></figure>
<hr>
<p>写好爬虫、安装好了<code>scrapyd</code>和<code>scrapd-client</code>后，我们可能会遇到scrapyd-deploy不是windows下的命令的问题。这是由于环境变量找不到导致的。下面有两种方法：</p>
<h3 id="方法1（我没成功，网上的办法）："><a href="#方法1（我没成功，网上的办法）：" class="headerlink" title="方法1（我没成功，网上的办法）："></a>方法1（我没成功，网上的办法）：</h3><p><img src="https://img.colabug.com/2018/03/69741661011524bb1bdc01936160d02d.png" alt="image"></p>
<h4 id="编辑两个文件："><a href="#编辑两个文件：" class="headerlink" title="编辑两个文件："></a>编辑两个文件：</h4><ul>
<li>scrapy.bat文件中输入以下内容 ：</li>
</ul>
<figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@echo <span class="literal">off</span></span><br><span class="line">D:<span class="string">\Python3.6\python</span> D:<span class="string">\Python3.6\Scripts\scrapy</span> %*</span><br><span class="line"><span class="comment">#地址根据自己安装的来看，跟环境变量一致</span></span><br></pre></td></tr></table></figure>
<ul>
<li>scrapyd-deploy.bat 文件中输入以下内容：</li>
</ul>
<figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@echo <span class="literal">off</span></span><br><span class="line">D:<span class="string">\Python3.6\python</span> D:<span class="string">\Python3.6\Scripts\scrapyd-deploy</span> %*</span><br><span class="line"><span class="comment">#地址根据自己安装的来看，跟环境变量一致</span></span><br></pre></td></tr></table></figure>
<p>输入部署命令<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scrapyd-deploy target -<span class="selector-tag">p</span> 项目名</span><br></pre></td></tr></table></figure></p>
<p>按照输出信息的提示，我们只需要访问 <a href="https://note.youdao.com/" target="_blank" rel="noopener">http://localhost:6800/addversion.json</a> 资源就可以看到具体的部署信息了。</p>
<h3 id="方法2（我用的方法）"><a href="#方法2（我用的方法）" class="headerlink" title="方法2（我用的方法）"></a>方法2（我用的方法）</h3><p>在项目的根目录下运行如下的命令<br><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python D:<span class="symbol">\P</span>ython3.6<span class="symbol">\S</span>cripts<span class="symbol">\s</span>crapyd-deploy target -p 项目名</span><br></pre></td></tr></table></figure></p>
<p>这里的<code>D:\Python3.6\Scripts\</code>是你的python安装目录，Scripts是安装目录下的一个文件夹，</p>
<ul>
<li>注意前面一定要加上python,</li>
<li>target是在前面<code>scrapy.cfg</code>中设置的<code>[deploy:XXX]</code>，XXX就是target,中括号中<code>:XXX</code>没有，现在加上去，叫什么都行，只要他们一致。</li>
<li>project 是<code>scrapy.cfg</code>文件中<code>project = 项目名</code>的项目名。</li>
</ul>
<h4 id="验证是否成功"><a href="#验证是否成功" class="headerlink" title="验证是否成功"></a>验证是否成功</h4><p>你可以在网页上看有没有显示你的工程名字，另外在根目录下输入<br><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python D:<span class="symbol">\P</span>ython3.6<span class="symbol">\S</span>cripts<span class="symbol">\s</span>crapyd-deploy -l</span><br></pre></td></tr></table></figure></p>
<p>就能列出你所有部署过的项目了</p>
<p>按照输出信息的提示，我们只需要访问 <a href="https://note.youdao.com/" target="_blank" rel="noopener">http://localhost:6800/addversion.json</a> 资源就可以看到具体的部署信息了。</p>
<hr>
<p>方法2结束</p>
<h2 id="安装curl"><a href="#安装curl" class="headerlink" title="安装curl"></a>安装curl</h2><p>本来是要作业控制了，但是windows没有<code>curl</code>，所以还要安装它！</p>
<p>下载连接：<a href="https://note.youdao.com/" target="_blank" rel="noopener">https://curl.haxx.se/download.html</a><br>记得找windows版本啊，要是Linux系统直接一句命令就行了，我下载的时候架梯子下载的。下载完解压就好了，exe文件不是给你运行的，是把他的文件路径放到环境变量PATH里。</p>
<h2 id="作业控制"><a href="#作业控制" class="headerlink" title="作业控制"></a>作业控制</h2><p>scrapyd的官方文档也是很详细，我们可以通过对<code>schedule.json</code>，<code>cancle.json</code>等资源来实现以HTTP服务的方式控制爬虫。具体的文档为 <a href="https://note.youdao.com/" target="_blank" rel="noopener">http://scrapyd.readthedocs.io/en/latest/api.html</a></p>
<p>比如下面的开启爬虫：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl <span class="string">http:</span><span class="comment">//localhost:6800/schedule.json -d project=项目名 -d spider=爬虫名</span></span><br></pre></td></tr></table></figure>
<p>然后的下面的结果就说明已经成功开启了一个爬虫。</p>
<figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#这里的jobid比较重要，下面会用到这个取消爬虫</span></span><br><span class="line">&#123;<span class="string">"status"</span>: <span class="string">"ok"</span>, <span class="string">"jobid"</span>: <span class="string">"3013f9d1283611e79a63acb57dec5d04"</span>, <span class="string">"node_name"</span>: <span class="string">"DESKTOP-L78TJQ7"</span>&#125;</span><br></pre></td></tr></table></figure>
<p>这里的jobid比较重要，下面会用到这个取消爬虫</p>
<p>查看具体的爬虫运行信息了： <a href="https://note.youdao.com/" target="_blank" rel="noopener">http://localhost:6800/jobs</a><br><img src="https://img.colabug.com/2018/03/4f6712189c91d620efaf00e0a52aa605.png" alt="image"><br>点击“ <code>Log</code>”超链接，就可以看到爬虫的具体的输出信息了。<br><img src="https://img.colabug.com/2018/03/40c3ccdd69d8de53a55e245156c69d25.png" alt="image"></p>
<ul>
<li>取消爬虫：<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl <span class="string">http:</span><span class="comment">//localhost:6800/cancel.json -d project=myproject -d job=jobid</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><code>jobid</code>就是上面的提到过的，如果取消我的这个实例代码如：<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl <span class="string">http:</span><span class="comment">//localhost:6800/cancel.json -d project=项目名 -d job=3013f9d1283611e79a63acb57dec5d04</span></span><br></pre></td></tr></table></figure></p>
<p>那么它的状态就会变成如下：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">"status"</span>: <span class="string">"ok"</span>, <span class="attr">"prevstate"</span>: <span class="string">"running"</span>, <span class="attr">"node_name"</span>: <span class="string">"DESKTOP-L78TJQ7"</span>&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>列出项目：<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl <span class="string">http:</span><span class="comment">//localhost:6800/listprojects.json</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>,下面将会出现你已经部署的项目</p>
<ul>
<li><p>删除项目：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl <span class="string">http:</span><span class="comment">//localhost:6800/delproject.json -d project=myproject</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>列出版本：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl <span class="string">http:</span><span class="comment">//localhost:6800/listversions.json?project=myproject</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>,这里的<code>project</code>是项目的名字，是在<code>scrapy.cfg</code>设置的</p>
<ul>
<li>列出爬虫：<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl <span class="string">http:</span><span class="comment">//localhost:6800/listspiders.json?project=myproject</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>这里的<code>project</code>是项目的名字，是在<code>scrapy.cfg</code>设置的</p>
<ul>
<li>列出job:<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl <span class="string">http:</span><span class="comment">//localhost:6800/listjobs.json?project=myproject</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>这里的<code>project</code>是项目的名字，是在<code>scrapy.cfg</code>设置的</p>
<ul>
<li>删除版本：<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl <span class="string">http:</span><span class="comment">//localhost:6800/delversion.json -d project=myproject -d version=r99</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>，这里的<code>version</code>是自己的项目版本号，在删除之前需要查看版本号</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>scrapyd就是一个底层使用了<code>twisted</code>的集成了的IPC服务套件（注意即使是同一个spider，两次run也要放到不同的JOBDIR，具体可以参考文档），很方便。然而自己去实现的话，对这块的内容也会理解的更深刻。</p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color3">爬虫</a>
        		</li>
      		 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color3">Scrapyd</a>
        		</li>
      		 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color3">部署</a>
        		</li>
      		
		</ul>
	</div>

      
	<div class="article-category tagcloud">
		<i class="icon-book icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="/categories/爬虫//" class="article-tag-list-link color3">爬虫</a>
        		</li>
      		
		</ul>
	</div>


      
        <p class="article-more-link">
          <a class="article-more-a" href="/2018/07/14/Scrapyd爬虫部署（win版/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>





<!-- 目录内容 -->
             
        <!-- 目录内容结束 -->
  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/2/">&laquo; Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/4/">Next &raquo;</a>
    </nav>
  


          </div>
        </div>
      </div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2018 萌木盖
    	</div>
		<span id="busuanzi_container_site_pv">    本站总访问量<span id="busuanzi_value_site_pv"></span>次</span>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    <script>
	var yiliaConfig = {
		mathjax: false,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: true,
		toc_hide_index: true,
		root: "/",
		innerArchive: true,
		showTags: true
	}
</script>

<script>!function(t){function n(e){if(r[e])return r[e].exports;var i=r[e]={exports:{},id:e,loaded:!1};return t[e].call(i.exports,i,i.exports,n),i.loaded=!0,i.exports}var r={};n.m=t,n.c=r,n.p="./",n(0)}([function(t,n,r){r(195),t.exports=r(191)},function(t,n,r){var e=r(3),i=r(52),o=r(27),u=r(28),c=r(53),f="prototype",a=function(t,n,r){var s,l,h,v,p=t&a.F,d=t&a.G,y=t&a.S,g=t&a.P,b=t&a.B,m=d?e:y?e[n]||(e[n]={}):(e[n]||{})[f],x=d?i:i[n]||(i[n]={}),w=x[f]||(x[f]={});d&&(r=n);for(s in r)l=!p&&m&&void 0!==m[s],h=(l?m:r)[s],v=b&&l?c(h,e):g&&"function"==typeof h?c(Function.call,h):h,m&&u(m,s,h,t&a.U),x[s]!=h&&o(x,s,v),g&&w[s]!=h&&(w[s]=h)};e.core=i,a.F=1,a.G=2,a.S=4,a.P=8,a.B=16,a.W=32,a.U=64,a.R=128,t.exports=a},function(t,n,r){var e=r(6);t.exports=function(t){if(!e(t))throw TypeError(t+" is not an object!");return t}},function(t,n){var r=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=r)},function(t,n){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,n){var r=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=r)},function(t,n){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,n,r){var e=r(126)("wks"),i=r(76),o=r(3).Symbol,u="function"==typeof o;(t.exports=function(t){return e[t]||(e[t]=u&&o[t]||(u?o:i)("Symbol."+t))}).store=e},function(t,n){var r={}.hasOwnProperty;t.exports=function(t,n){return r.call(t,n)}},function(t,n,r){var e=r(94),i=r(33);t.exports=function(t){return e(i(t))}},function(t,n,r){t.exports=!r(4)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(t,n,r){var e=r(2),i=r(167),o=r(50),u=Object.defineProperty;n.f=r(10)?Object.defineProperty:function(t,n,r){if(e(t),n=o(n,!0),e(r),i)try{return u(t,n,r)}catch(t){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(t[n]=r.value),t}},function(t,n,r){t.exports=!r(18)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(t,n,r){var e=r(14),i=r(22);t.exports=r(12)?function(t,n,r){return e.f(t,n,i(1,r))}:function(t,n,r){return t[n]=r,t}},function(t,n,r){var e=r(20),i=r(58),o=r(42),u=Object.defineProperty;n.f=r(12)?Object.defineProperty:function(t,n,r){if(e(t),n=o(n,!0),e(r),i)try{return u(t,n,r)}catch(t){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(t[n]=r.value),t}},function(t,n,r){var e=r(40)("wks"),i=r(23),o=r(5).Symbol,u="function"==typeof o;(t.exports=function(t){return e[t]||(e[t]=u&&o[t]||(u?o:i)("Symbol."+t))}).store=e},function(t,n,r){var e=r(67),i=Math.min;t.exports=function(t){return t>0?i(e(t),9007199254740991):0}},function(t,n,r){var e=r(46);t.exports=function(t){return Object(e(t))}},function(t,n){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,n,r){var e=r(63),i=r(34);t.exports=Object.keys||function(t){return e(t,i)}},function(t,n,r){var e=r(21);t.exports=function(t){if(!e(t))throw TypeError(t+" is not an object!");return t}},function(t,n){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,n){t.exports=function(t,n){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:n}}},function(t,n){var r=0,e=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++r+e).toString(36))}},function(t,n){var r={}.hasOwnProperty;t.exports=function(t,n){return r.call(t,n)}},function(t,n){var r=t.exports={version:"2.4.0"};"number"==typeof __e&&(__e=r)},function(t,n){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,n,r){var e=r(11),i=r(66);t.exports=r(10)?function(t,n,r){return e.f(t,n,i(1,r))}:function(t,n,r){return t[n]=r,t}},function(t,n,r){var e=r(3),i=r(27),o=r(24),u=r(76)("src"),c="toString",f=Function[c],a=(""+f).split(c);r(52).inspectSource=function(t){return f.call(t)},(t.exports=function(t,n,r,c){var f="function"==typeof r;f&&(o(r,"name")||i(r,"name",n)),t[n]!==r&&(f&&(o(r,u)||i(r,u,t[n]?""+t[n]:a.join(String(n)))),t===e?t[n]=r:c?t[n]?t[n]=r:i(t,n,r):(delete t[n],i(t,n,r)))})(Function.prototype,c,function(){return"function"==typeof this&&this[u]||f.call(this)})},function(t,n,r){var e=r(1),i=r(4),o=r(46),u=function(t,n,r,e){var i=String(o(t)),u="<"+n;return""!==r&&(u+=" "+r+'="'+String(e).replace(/"/g,"&quot;")+'"'),u+">"+i+"</"+n+">"};t.exports=function(t,n){var r={};r[t]=n(u),e(e.P+e.F*i(function(){var n=""[t]('"');return n!==n.toLowerCase()||n.split('"').length>3}),"String",r)}},function(t,n,r){var e=r(115),i=r(46);t.exports=function(t){return e(i(t))}},function(t,n,r){var e=r(116),i=r(66),o=r(30),u=r(50),c=r(24),f=r(167),a=Object.getOwnPropertyDescriptor;n.f=r(10)?a:function(t,n){if(t=o(t),n=u(n,!0),f)try{return a(t,n)}catch(t){}if(c(t,n))return i(!e.f.call(t,n),t[n])}},function(t,n,r){var e=r(24),i=r(17),o=r(145)("IE_PROTO"),u=Object.prototype;t.exports=Object.getPrototypeOf||function(t){return t=i(t),e(t,o)?t[o]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?u:null}},function(t,n){t.exports=function(t){if(void 0==t)throw TypeError("Can't call method on  "+t);return t}},function(t,n){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(t,n){t.exports={}},function(t,n){t.exports=!0},function(t,n){n.f={}.propertyIsEnumerable},function(t,n,r){var e=r(14).f,i=r(8),o=r(15)("toStringTag");t.exports=function(t,n,r){t&&!i(t=r?t:t.prototype,o)&&e(t,o,{configurable:!0,value:n})}},function(t,n,r){var e=r(40)("keys"),i=r(23);t.exports=function(t){return e[t]||(e[t]=i(t))}},function(t,n,r){var e=r(5),i="__core-js_shared__",o=e[i]||(e[i]={});t.exports=function(t){return o[t]||(o[t]={})}},function(t,n){var r=Math.ceil,e=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?e:r)(t)}},function(t,n,r){var e=r(21);t.exports=function(t,n){if(!e(t))return t;var r,i;if(n&&"function"==typeof(r=t.toString)&&!e(i=r.call(t)))return i;if("function"==typeof(r=t.valueOf)&&!e(i=r.call(t)))return i;if(!n&&"function"==typeof(r=t.toString)&&!e(i=r.call(t)))return i;throw TypeError("Can't convert object to primitive value")}},function(t,n,r){var e=r(5),i=r(25),o=r(36),u=r(44),c=r(14).f;t.exports=function(t){var n=i.Symbol||(i.Symbol=o?{}:e.Symbol||{});"_"==t.charAt(0)||t in n||c(n,t,{value:u.f(t)})}},function(t,n,r){n.f=r(15)},function(t,n){var r={}.toString;t.exports=function(t){return r.call(t).slice(8,-1)}},function(t,n){t.exports=function(t){if(void 0==t)throw TypeError("Can't call method on  "+t);return t}},function(t,n,r){var e=r(4);t.exports=function(t,n){return!!t&&e(function(){n?t.call(null,function(){},1):t.call(null)})}},function(t,n,r){var e=r(53),i=r(115),o=r(17),u=r(16),c=r(203);t.exports=function(t,n){var r=1==t,f=2==t,a=3==t,s=4==t,l=6==t,h=5==t||l,v=n||c;return function(n,c,p){for(var d,y,g=o(n),b=i(g),m=e(c,p,3),x=u(b.length),w=0,S=r?v(n,x):f?v(n,0):void 0;x>w;w++)if((h||w in b)&&(d=b[w],y=m(d,w,g),t))if(r)S[w]=y;else if(y)switch(t){case 3:return!0;case 5:return d;case 6:return w;case 2:S.push(d)}else if(s)return!1;return l?-1:a||s?s:S}}},function(t,n,r){var e=r(1),i=r(52),o=r(4);t.exports=function(t,n){var r=(i.Object||{})[t]||Object[t],u={};u[t]=n(r),e(e.S+e.F*o(function(){r(1)}),"Object",u)}},function(t,n,r){var e=r(6);t.exports=function(t,n){if(!e(t))return t;var r,i;if(n&&"function"==typeof(r=t.toString)&&!e(i=r.call(t)))return i;if("function"==typeof(r=t.valueOf)&&!e(i=r.call(t)))return i;if(!n&&"function"==typeof(r=t.toString)&&!e(i=r.call(t)))return i;throw TypeError("Can't convert object to primitive value")}},function(t,n,r){var e=r(5),i=r(25),o=r(91),u=r(13),c="prototype",f=function(t,n,r){var a,s,l,h=t&f.F,v=t&f.G,p=t&f.S,d=t&f.P,y=t&f.B,g=t&f.W,b=v?i:i[n]||(i[n]={}),m=b[c],x=v?e:p?e[n]:(e[n]||{})[c];v&&(r=n);for(a in r)(s=!h&&x&&void 0!==x[a])&&a in b||(l=s?x[a]:r[a],b[a]=v&&"function"!=typeof x[a]?r[a]:y&&s?o(l,e):g&&x[a]==l?function(t){var n=function(n,r,e){if(this instanceof t){switch(arguments.length){case 0:return new t;case 1:return new t(n);case 2:return new t(n,r)}return new t(n,r,e)}return t.apply(this,arguments)};return n[c]=t[c],n}(l):d&&"function"==typeof l?o(Function.call,l):l,d&&((b.virtual||(b.virtual={}))[a]=l,t&f.R&&m&&!m[a]&&u(m,a,l)))};f.F=1,f.G=2,f.S=4,f.P=8,f.B=16,f.W=32,f.U=64,f.R=128,t.exports=f},function(t,n){var r=t.exports={version:"2.4.0"};"number"==typeof __e&&(__e=r)},function(t,n,r){var e=r(26);t.exports=function(t,n,r){if(e(t),void 0===n)return t;switch(r){case 1:return function(r){return t.call(n,r)};case 2:return function(r,e){return t.call(n,r,e)};case 3:return function(r,e,i){return t.call(n,r,e,i)}}return function(){return t.apply(n,arguments)}}},function(t,n,r){var e=r(183),i=r(1),o=r(126)("metadata"),u=o.store||(o.store=new(r(186))),c=function(t,n,r){var i=u.get(t);if(!i){if(!r)return;u.set(t,i=new e)}var o=i.get(n);if(!o){if(!r)return;i.set(n,o=new e)}return o},f=function(t,n,r){var e=c(n,r,!1);return void 0!==e&&e.has(t)},a=function(t,n,r){var e=c(n,r,!1);return void 0===e?void 0:e.get(t)},s=function(t,n,r,e){c(r,e,!0).set(t,n)},l=function(t,n){var r=c(t,n,!1),e=[];return r&&r.forEach(function(t,n){e.push(n)}),e},h=function(t){return void 0===t||"symbol"==typeof t?t:String(t)},v=function(t){i(i.S,"Reflect",t)};t.exports={store:u,map:c,has:f,get:a,set:s,keys:l,key:h,exp:v}},function(t,n,r){"use strict";if(r(10)){var e=r(69),i=r(3),o=r(4),u=r(1),c=r(127),f=r(152),a=r(53),s=r(68),l=r(66),h=r(27),v=r(73),p=r(67),d=r(16),y=r(75),g=r(50),b=r(24),m=r(180),x=r(114),w=r(6),S=r(17),_=r(137),O=r(70),E=r(32),P=r(71).f,j=r(154),F=r(76),M=r(7),A=r(48),N=r(117),T=r(146),I=r(155),k=r(80),L=r(123),R=r(74),C=r(130),D=r(160),U=r(11),W=r(31),G=U.f,B=W.f,V=i.RangeError,z=i.TypeError,q=i.Uint8Array,K="ArrayBuffer",J="Shared"+K,Y="BYTES_PER_ELEMENT",H="prototype",$=Array[H],X=f.ArrayBuffer,Q=f.DataView,Z=A(0),tt=A(2),nt=A(3),rt=A(4),et=A(5),it=A(6),ot=N(!0),ut=N(!1),ct=I.values,ft=I.keys,at=I.entries,st=$.lastIndexOf,lt=$.reduce,ht=$.reduceRight,vt=$.join,pt=$.sort,dt=$.slice,yt=$.toString,gt=$.toLocaleString,bt=M("iterator"),mt=M("toStringTag"),xt=F("typed_constructor"),wt=F("def_constructor"),St=c.CONSTR,_t=c.TYPED,Ot=c.VIEW,Et="Wrong length!",Pt=A(1,function(t,n){return Tt(T(t,t[wt]),n)}),jt=o(function(){return 1===new q(new Uint16Array([1]).buffer)[0]}),Ft=!!q&&!!q[H].set&&o(function(){new q(1).set({})}),Mt=function(t,n){if(void 0===t)throw z(Et);var r=+t,e=d(t);if(n&&!m(r,e))throw V(Et);return e},At=function(t,n){var r=p(t);if(r<0||r%n)throw V("Wrong offset!");return r},Nt=function(t){if(w(t)&&_t in t)return t;throw z(t+" is not a typed array!")},Tt=function(t,n){if(!(w(t)&&xt in t))throw z("It is not a typed array constructor!");return new t(n)},It=function(t,n){return kt(T(t,t[wt]),n)},kt=function(t,n){for(var r=0,e=n.length,i=Tt(t,e);e>r;)i[r]=n[r++];return i},Lt=function(t,n,r){G(t,n,{get:function(){return this._d[r]}})},Rt=function(t){var n,r,e,i,o,u,c=S(t),f=arguments.length,s=f>1?arguments[1]:void 0,l=void 0!==s,h=j(c);if(void 0!=h&&!_(h)){for(u=h.call(c),e=[],n=0;!(o=u.next()).done;n++)e.push(o.value);c=e}for(l&&f>2&&(s=a(s,arguments[2],2)),n=0,r=d(c.length),i=Tt(this,r);r>n;n++)i[n]=l?s(c[n],n):c[n];return i},Ct=function(){for(var t=0,n=arguments.length,r=Tt(this,n);n>t;)r[t]=arguments[t++];return r},Dt=!!q&&o(function(){gt.call(new q(1))}),Ut=function(){return gt.apply(Dt?dt.call(Nt(this)):Nt(this),arguments)},Wt={copyWithin:function(t,n){return D.call(Nt(this),t,n,arguments.length>2?arguments[2]:void 0)},every:function(t){return rt(Nt(this),t,arguments.length>1?arguments[1]:void 0)},fill:function(t){return C.apply(Nt(this),arguments)},filter:function(t){return It(this,tt(Nt(this),t,arguments.length>1?arguments[1]:void 0))},find:function(t){return et(Nt(this),t,arguments.length>1?arguments[1]:void 0)},findIndex:function(t){return it(Nt(this),t,arguments.length>1?arguments[1]:void 0)},forEach:function(t){Z(Nt(this),t,arguments.length>1?arguments[1]:void 0)},indexOf:function(t){return ut(Nt(this),t,arguments.length>1?arguments[1]:void 0)},includes:function(t){return ot(Nt(this),t,arguments.length>1?arguments[1]:void 0)},join:function(t){return vt.apply(Nt(this),arguments)},lastIndexOf:function(t){return st.apply(Nt(this),arguments)},map:function(t){return Pt(Nt(this),t,arguments.length>1?arguments[1]:void 0)},reduce:function(t){return lt.apply(Nt(this),arguments)},reduceRight:function(t){return ht.apply(Nt(this),arguments)},reverse:function(){for(var t,n=this,r=Nt(n).length,e=Math.floor(r/2),i=0;i<e;)t=n[i],n[i++]=n[--r],n[r]=t;return n},some:function(t){return nt(Nt(this),t,arguments.length>1?arguments[1]:void 0)},sort:function(t){return pt.call(Nt(this),t)},subarray:function(t,n){var r=Nt(this),e=r.length,i=y(t,e);return new(T(r,r[wt]))(r.buffer,r.byteOffset+i*r.BYTES_PER_ELEMENT,d((void 0===n?e:y(n,e))-i))}},Gt=function(t,n){return It(this,dt.call(Nt(this),t,n))},Bt=function(t){Nt(this);var n=At(arguments[1],1),r=this.length,e=S(t),i=d(e.length),o=0;if(i+n>r)throw V(Et);for(;o<i;)this[n+o]=e[o++]},Vt={entries:function(){return at.call(Nt(this))},keys:function(){return ft.call(Nt(this))},values:function(){return ct.call(Nt(this))}},zt=function(t,n){return w(t)&&t[_t]&&"symbol"!=typeof n&&n in t&&String(+n)==String(n)},qt=function(t,n){return zt(t,n=g(n,!0))?l(2,t[n]):B(t,n)},Kt=function(t,n,r){return!(zt(t,n=g(n,!0))&&w(r)&&b(r,"value"))||b(r,"get")||b(r,"set")||r.configurable||b(r,"writable")&&!r.writable||b(r,"enumerable")&&!r.enumerable?G(t,n,r):(t[n]=r.value,t)};St||(W.f=qt,U.f=Kt),u(u.S+u.F*!St,"Object",{getOwnPropertyDescriptor:qt,defineProperty:Kt}),o(function(){yt.call({})})&&(yt=gt=function(){return vt.call(this)});var Jt=v({},Wt);v(Jt,Vt),h(Jt,bt,Vt.values),v(Jt,{slice:Gt,set:Bt,constructor:function(){},toString:yt,toLocaleString:Ut}),Lt(Jt,"buffer","b"),Lt(Jt,"byteOffset","o"),Lt(Jt,"byteLength","l"),Lt(Jt,"length","e"),G(Jt,mt,{get:function(){return this[_t]}}),t.exports=function(t,n,r,f){f=!!f;var a=t+(f?"Clamped":"")+"Array",l="Uint8Array"!=a,v="get"+t,p="set"+t,y=i[a],g=y||{},b=y&&E(y),m=!y||!c.ABV,S={},_=y&&y[H],j=function(t,r){var e=t._d;return e.v[v](r*n+e.o,jt)},F=function(t,r,e){var i=t._d;f&&(e=(e=Math.round(e))<0?0:e>255?255:255&e),i.v[p](r*n+i.o,e,jt)},M=function(t,n){G(t,n,{get:function(){return j(this,n)},set:function(t){return F(this,n,t)},enumerable:!0})};m?(y=r(function(t,r,e,i){s(t,y,a,"_d");var o,u,c,f,l=0,v=0;if(w(r)){if(!(r instanceof X||(f=x(r))==K||f==J))return _t in r?kt(y,r):Rt.call(y,r);o=r,v=At(e,n);var p=r.byteLength;if(void 0===i){if(p%n)throw V(Et);if((u=p-v)<0)throw V(Et)}else if((u=d(i)*n)+v>p)throw V(Et);c=u/n}else c=Mt(r,!0),u=c*n,o=new X(u);for(h(t,"_d",{b:o,o:v,l:u,e:c,v:new Q(o)});l<c;)M(t,l++)}),_=y[H]=O(Jt),h(_,"constructor",y)):L(function(t){new y(null),new y(t)},!0)||(y=r(function(t,r,e,i){s(t,y,a);var o;return w(r)?r instanceof X||(o=x(r))==K||o==J?void 0!==i?new g(r,At(e,n),i):void 0!==e?new g(r,At(e,n)):new g(r):_t in r?kt(y,r):Rt.call(y,r):new g(Mt(r,l))}),Z(b!==Function.prototype?P(g).concat(P(b)):P(g),function(t){t in y||h(y,t,g[t])}),y[H]=_,e||(_.constructor=y));var A=_[bt],N=!!A&&("values"==A.name||void 0==A.name),T=Vt.values;h(y,xt,!0),h(_,_t,a),h(_,Ot,!0),h(_,wt,y),(f?new y(1)[mt]==a:mt in _)||G(_,mt,{get:function(){return a}}),S[a]=y,u(u.G+u.W+u.F*(y!=g),S),u(u.S,a,{BYTES_PER_ELEMENT:n,from:Rt,of:Ct}),Y in _||h(_,Y,n),u(u.P,a,Wt),R(a),u(u.P+u.F*Ft,a,{set:Bt}),u(u.P+u.F*!N,a,Vt),u(u.P+u.F*(_.toString!=yt),a,{toString:yt}),u(u.P+u.F*o(function(){new y(1).slice()}),a,{slice:Gt}),u(u.P+u.F*(o(function(){return[1,2].toLocaleString()!=new y([1,2]).toLocaleString()})||!o(function(){_.toLocaleString.call([1,2])})),a,{toLocaleString:Ut}),k[a]=N?A:T,e||N||h(_,bt,T)}}else t.exports=function(){}},function(t,n){var r={}.toString;t.exports=function(t){return r.call(t).slice(8,-1)}},function(t,n,r){var e=r(21),i=r(5).document,o=e(i)&&e(i.createElement);t.exports=function(t){return o?i.createElement(t):{}}},function(t,n,r){t.exports=!r(12)&&!r(18)(function(){return 7!=Object.defineProperty(r(57)("div"),"a",{get:function(){return 7}}).a})},function(t,n,r){"use strict";var e=r(36),i=r(51),o=r(64),u=r(13),c=r(8),f=r(35),a=r(96),s=r(38),l=r(103),h=r(15)("iterator"),v=!([].keys&&"next"in[].keys()),p="keys",d="values",y=function(){return this};t.exports=function(t,n,r,g,b,m,x){a(r,n,g);var w,S,_,O=function(t){if(!v&&t in F)return F[t];switch(t){case p:case d:return function(){return new r(this,t)}}return function(){return new r(this,t)}},E=n+" Iterator",P=b==d,j=!1,F=t.prototype,M=F[h]||F["@@iterator"]||b&&F[b],A=M||O(b),N=b?P?O("entries"):A:void 0,T="Array"==n?F.entries||M:M;if(T&&(_=l(T.call(new t)))!==Object.prototype&&(s(_,E,!0),e||c(_,h)||u(_,h,y)),P&&M&&M.name!==d&&(j=!0,A=function(){return M.call(this)}),e&&!x||!v&&!j&&F[h]||u(F,h,A),f[n]=A,f[E]=y,b)if(w={values:P?A:O(d),keys:m?A:O(p),entries:N},x)for(S in w)S in F||o(F,S,w[S]);else i(i.P+i.F*(v||j),n,w);return w}},function(t,n,r){var e=r(20),i=r(100),o=r(34),u=r(39)("IE_PROTO"),c=function(){},f="prototype",a=function(){var t,n=r(57)("iframe"),e=o.length;for(n.style.display="none",r(93).appendChild(n),n.src="javascript:",t=n.contentWindow.document,t.open(),t.write("<script>document.F=Object<\/script>"),t.close(),a=t.F;e--;)delete a[f][o[e]];return a()};t.exports=Object.create||function(t,n){var r;return null!==t?(c[f]=e(t),r=new c,c[f]=null,r[u]=t):r=a(),void 0===n?r:i(r,n)}},function(t,n,r){var e=r(63),i=r(34).concat("length","prototype");n.f=Object.getOwnPropertyNames||function(t){return e(t,i)}},function(t,n){n.f=Object.getOwnPropertySymbols},function(t,n,r){var e=r(8),i=r(9),o=r(90)(!1),u=r(39)("IE_PROTO");t.exports=function(t,n){var r,c=i(t),f=0,a=[];for(r in c)r!=u&&e(c,r)&&a.push(r);for(;n.length>f;)e(c,r=n[f++])&&(~o(a,r)||a.push(r));return a}},function(t,n,r){t.exports=r(13)},function(t,n,r){var e=r(76)("meta"),i=r(6),o=r(24),u=r(11).f,c=0,f=Object.isExtensible||function(){return!0},a=!r(4)(function(){return f(Object.preventExtensions({}))}),s=function(t){u(t,e,{value:{i:"O"+ ++c,w:{}}})},l=function(t,n){if(!i(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!o(t,e)){if(!f(t))return"F";if(!n)return"E";s(t)}return t[e].i},h=function(t,n){if(!o(t,e)){if(!f(t))return!0;if(!n)return!1;s(t)}return t[e].w},v=function(t){return a&&p.NEED&&f(t)&&!o(t,e)&&s(t),t},p=t.exports={KEY:e,NEED:!1,fastKey:l,getWeak:h,onFreeze:v}},function(t,n){t.exports=function(t,n){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:n}}},function(t,n){var r=Math.ceil,e=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?e:r)(t)}},function(t,n){t.exports=function(t,n,r,e){if(!(t instanceof n)||void 0!==e&&e in t)throw TypeError(r+": incorrect invocation!");return t}},function(t,n){t.exports=!1},function(t,n,r){var e=r(2),i=r(173),o=r(133),u=r(145)("IE_PROTO"),c=function(){},f="prototype",a=function(){var t,n=r(132)("iframe"),e=o.length;for(n.style.display="none",r(135).appendChild(n),n.src="javascript:",t=n.contentWindow.document,t.open(),t.write("<script>document.F=Object<\/script>"),t.close(),a=t.F;e--;)delete a[f][o[e]];return a()};t.exports=Object.create||function(t,n){var r;return null!==t?(c[f]=e(t),r=new c,c[f]=null,r[u]=t):r=a(),void 0===n?r:i(r,n)}},function(t,n,r){var e=r(175),i=r(133).concat("length","prototype");n.f=Object.getOwnPropertyNames||function(t){return e(t,i)}},function(t,n,r){var e=r(175),i=r(133);t.exports=Object.keys||function(t){return e(t,i)}},function(t,n,r){var e=r(28);t.exports=function(t,n,r){for(var i in n)e(t,i,n[i],r);return t}},function(t,n,r){"use strict";var e=r(3),i=r(11),o=r(10),u=r(7)("species");t.exports=function(t){var n=e[t];o&&n&&!n[u]&&i.f(n,u,{configurable:!0,get:function(){return this}})}},function(t,n,r){var e=r(67),i=Math.max,o=Math.min;t.exports=function(t,n){return t=e(t),t<0?i(t+n,0):o(t,n)}},function(t,n){var r=0,e=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++r+e).toString(36))}},function(t,n,r){var e=r(33);t.exports=function(t){return Object(e(t))}},function(t,n,r){var e=r(7)("unscopables"),i=Array.prototype;void 0==i[e]&&r(27)(i,e,{}),t.exports=function(t){i[e][t]=!0}},function(t,n,r){var e=r(53),i=r(169),o=r(137),u=r(2),c=r(16),f=r(154),a={},s={},n=t.exports=function(t,n,r,l,h){var v,p,d,y,g=h?function(){return t}:f(t),b=e(r,l,n?2:1),m=0;if("function"!=typeof g)throw TypeError(t+" is not iterable!");if(o(g)){for(v=c(t.length);v>m;m++)if((y=n?b(u(p=t[m])[0],p[1]):b(t[m]))===a||y===s)return y}else for(d=g.call(t);!(p=d.next()).done;)if((y=i(d,b,p.value,n))===a||y===s)return y};n.BREAK=a,n.RETURN=s},function(t,n){t.exports={}},function(t,n,r){var e=r(11).f,i=r(24),o=r(7)("toStringTag");t.exports=function(t,n,r){t&&!i(t=r?t:t.prototype,o)&&e(t,o,{configurable:!0,value:n})}},function(t,n,r){var e=r(1),i=r(46),o=r(4),u=r(150),c="["+u+"]",f="​",a=RegExp("^"+c+c+"*"),s=RegExp(c+c+"*$"),l=function(t,n,r){var i={},c=o(function(){return!!u[t]()||f[t]()!=f}),a=i[t]=c?n(h):u[t];r&&(i[r]=a),e(e.P+e.F*c,"String",i)},h=l.trim=function(t,n){return t=String(i(t)),1&n&&(t=t.replace(a,"")),2&n&&(t=t.replace(s,"")),t};t.exports=l},function(t,n,r){t.exports={default:r(86),__esModule:!0}},function(t,n,r){t.exports={default:r(87),__esModule:!0}},function(t,n,r){"use strict";function e(t){return t&&t.__esModule?t:{default:t}}n.__esModule=!0;var i=r(84),o=e(i),u=r(83),c=e(u),f="function"==typeof c.default&&"symbol"==typeof o.default?function(t){return typeof t}:function(t){return t&&"function"==typeof c.default&&t.constructor===c.default&&t!==c.default.prototype?"symbol":typeof t};n.default="function"==typeof c.default&&"symbol"===f(o.default)?function(t){return void 0===t?"undefined":f(t)}:function(t){return t&&"function"==typeof c.default&&t.constructor===c.default&&t!==c.default.prototype?"symbol":void 0===t?"undefined":f(t)}},function(t,n,r){r(110),r(108),r(111),r(112),t.exports=r(25).Symbol},function(t,n,r){r(109),r(113),t.exports=r(44).f("iterator")},function(t,n){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,n){t.exports=function(){}},function(t,n,r){var e=r(9),i=r(106),o=r(105);t.exports=function(t){return function(n,r,u){var c,f=e(n),a=i(f.length),s=o(u,a);if(t&&r!=r){for(;a>s;)if((c=f[s++])!=c)return!0}else for(;a>s;s++)if((t||s in f)&&f[s]===r)return t||s||0;return!t&&-1}}},function(t,n,r){var e=r(88);t.exports=function(t,n,r){if(e(t),void 0===n)return t;switch(r){case 1:return function(r){return t.call(n,r)};case 2:return function(r,e){return t.call(n,r,e)};case 3:return function(r,e,i){return t.call(n,r,e,i)}}return function(){return t.apply(n,arguments)}}},function(t,n,r){var e=r(19),i=r(62),o=r(37);t.exports=function(t){var n=e(t),r=i.f;if(r)for(var u,c=r(t),f=o.f,a=0;c.length>a;)f.call(t,u=c[a++])&&n.push(u);return n}},function(t,n,r){t.exports=r(5).document&&document.documentElement},function(t,n,r){var e=r(56);t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==e(t)?t.split(""):Object(t)}},function(t,n,r){var e=r(56);t.exports=Array.isArray||function(t){return"Array"==e(t)}},function(t,n,r){"use strict";var e=r(60),i=r(22),o=r(38),u={};r(13)(u,r(15)("iterator"),function(){return this}),t.exports=function(t,n,r){t.prototype=e(u,{next:i(1,r)}),o(t,n+" Iterator")}},function(t,n){t.exports=function(t,n){return{value:n,done:!!t}}},function(t,n,r){var e=r(19),i=r(9);t.exports=function(t,n){for(var r,o=i(t),u=e(o),c=u.length,f=0;c>f;)if(o[r=u[f++]]===n)return r}},function(t,n,r){var e=r(23)("meta"),i=r(21),o=r(8),u=r(14).f,c=0,f=Object.isExtensible||function(){return!0},a=!r(18)(function(){return f(Object.preventExtensions({}))}),s=function(t){u(t,e,{value:{i:"O"+ ++c,w:{}}})},l=function(t,n){if(!i(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!o(t,e)){if(!f(t))return"F";if(!n)return"E";s(t)}return t[e].i},h=function(t,n){if(!o(t,e)){if(!f(t))return!0;if(!n)return!1;s(t)}return t[e].w},v=function(t){return a&&p.NEED&&f(t)&&!o(t,e)&&s(t),t},p=t.exports={KEY:e,NEED:!1,fastKey:l,getWeak:h,onFreeze:v}},function(t,n,r){var e=r(14),i=r(20),o=r(19);t.exports=r(12)?Object.defineProperties:function(t,n){i(t);for(var r,u=o(n),c=u.length,f=0;c>f;)e.f(t,r=u[f++],n[r]);return t}},function(t,n,r){var e=r(37),i=r(22),o=r(9),u=r(42),c=r(8),f=r(58),a=Object.getOwnPropertyDescriptor;n.f=r(12)?a:function(t,n){if(t=o(t),n=u(n,!0),f)try{return a(t,n)}catch(t){}if(c(t,n))return i(!e.f.call(t,n),t[n])}},function(t,n,r){var e=r(9),i=r(61).f,o={}.toString,u="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],c=function(t){try{return i(t)}catch(t){return u.slice()}};t.exports.f=function(t){return u&&"[object Window]"==o.call(t)?c(t):i(e(t))}},function(t,n,r){var e=r(8),i=r(77),o=r(39)("IE_PROTO"),u=Object.prototype;t.exports=Object.getPrototypeOf||function(t){return t=i(t),e(t,o)?t[o]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?u:null}},function(t,n,r){var e=r(41),i=r(33);t.exports=function(t){return function(n,r){var o,u,c=String(i(n)),f=e(r),a=c.length;return f<0||f>=a?t?"":void 0:(o=c.charCodeAt(f),o<55296||o>56319||f+1===a||(u=c.charCodeAt(f+1))<56320||u>57343?t?c.charAt(f):o:t?c.slice(f,f+2):u-56320+(o-55296<<10)+65536)}}},function(t,n,r){var e=r(41),i=Math.max,o=Math.min;t.exports=function(t,n){return t=e(t),t<0?i(t+n,0):o(t,n)}},function(t,n,r){var e=r(41),i=Math.min;t.exports=function(t){return t>0?i(e(t),9007199254740991):0}},function(t,n,r){"use strict";var e=r(89),i=r(97),o=r(35),u=r(9);t.exports=r(59)(Array,"Array",function(t,n){this._t=u(t),this._i=0,this._k=n},function(){var t=this._t,n=this._k,r=this._i++;return!t||r>=t.length?(this._t=void 0,i(1)):"keys"==n?i(0,r):"values"==n?i(0,t[r]):i(0,[r,t[r]])},"values"),o.Arguments=o.Array,e("keys"),e("values"),e("entries")},function(t,n){},function(t,n,r){"use strict";var e=r(104)(!0);r(59)(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,n=this._t,r=this._i;return r>=n.length?{value:void 0,done:!0}:(t=e(n,r),this._i+=t.length,{value:t,done:!1})})},function(t,n,r){"use strict";var e=r(5),i=r(8),o=r(12),u=r(51),c=r(64),f=r(99).KEY,a=r(18),s=r(40),l=r(38),h=r(23),v=r(15),p=r(44),d=r(43),y=r(98),g=r(92),b=r(95),m=r(20),x=r(9),w=r(42),S=r(22),_=r(60),O=r(102),E=r(101),P=r(14),j=r(19),F=E.f,M=P.f,A=O.f,N=e.Symbol,T=e.JSON,I=T&&T.stringify,k="prototype",L=v("_hidden"),R=v("toPrimitive"),C={}.propertyIsEnumerable,D=s("symbol-registry"),U=s("symbols"),W=s("op-symbols"),G=Object[k],B="function"==typeof N,V=e.QObject,z=!V||!V[k]||!V[k].findChild,q=o&&a(function(){return 7!=_(M({},"a",{get:function(){return M(this,"a",{value:7}).a}})).a})?function(t,n,r){var e=F(G,n);e&&delete G[n],M(t,n,r),e&&t!==G&&M(G,n,e)}:M,K=function(t){var n=U[t]=_(N[k]);return n._k=t,n},J=B&&"symbol"==typeof N.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof N},Y=function(t,n,r){return t===G&&Y(W,n,r),m(t),n=w(n,!0),m(r),i(U,n)?(r.enumerable?(i(t,L)&&t[L][n]&&(t[L][n]=!1),r=_(r,{enumerable:S(0,!1)})):(i(t,L)||M(t,L,S(1,{})),t[L][n]=!0),q(t,n,r)):M(t,n,r)},H=function(t,n){m(t);for(var r,e=g(n=x(n)),i=0,o=e.length;o>i;)Y(t,r=e[i++],n[r]);return t},$=function(t,n){return void 0===n?_(t):H(_(t),n)},X=function(t){var n=C.call(this,t=w(t,!0));return!(this===G&&i(U,t)&&!i(W,t))&&(!(n||!i(this,t)||!i(U,t)||i(this,L)&&this[L][t])||n)},Q=function(t,n){if(t=x(t),n=w(n,!0),t!==G||!i(U,n)||i(W,n)){var r=F(t,n);return!r||!i(U,n)||i(t,L)&&t[L][n]||(r.enumerable=!0),r}},Z=function(t){for(var n,r=A(x(t)),e=[],o=0;r.length>o;)i(U,n=r[o++])||n==L||n==f||e.push(n);return e},tt=function(t){for(var n,r=t===G,e=A(r?W:x(t)),o=[],u=0;e.length>u;)!i(U,n=e[u++])||r&&!i(G,n)||o.push(U[n]);return o};B||(N=function(){if(this instanceof N)throw TypeError("Symbol is not a constructor!");var t=h(arguments.length>0?arguments[0]:void 0),n=function(r){this===G&&n.call(W,r),i(this,L)&&i(this[L],t)&&(this[L][t]=!1),q(this,t,S(1,r))};return o&&z&&q(G,t,{configurable:!0,set:n}),K(t)},c(N[k],"toString",function(){return this._k}),E.f=Q,P.f=Y,r(61).f=O.f=Z,r(37).f=X,r(62).f=tt,o&&!r(36)&&c(G,"propertyIsEnumerable",X,!0),p.f=function(t){return K(v(t))}),u(u.G+u.W+u.F*!B,{Symbol:N});for(var nt="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),rt=0;nt.length>rt;)v(nt[rt++]);for(var nt=j(v.store),rt=0;nt.length>rt;)d(nt[rt++]);u(u.S+u.F*!B,"Symbol",{for:function(t){return i(D,t+="")?D[t]:D[t]=N(t)},keyFor:function(t){if(J(t))return y(D,t);throw TypeError(t+" is not a symbol!")},useSetter:function(){z=!0},useSimple:function(){z=!1}}),u(u.S+u.F*!B,"Object",{create:$,defineProperty:Y,defineProperties:H,getOwnPropertyDescriptor:Q,getOwnPropertyNames:Z,getOwnPropertySymbols:tt}),T&&u(u.S+u.F*(!B||a(function(){var t=N();return"[null]"!=I([t])||"{}"!=I({a:t})||"{}"!=I(Object(t))})),"JSON",{stringify:function(t){if(void 0!==t&&!J(t)){for(var n,r,e=[t],i=1;arguments.length>i;)e.push(arguments[i++]);return n=e[1],"function"==typeof n&&(r=n),!r&&b(n)||(n=function(t,n){if(r&&(n=r.call(this,t,n)),!J(n))return n}),e[1]=n,I.apply(T,e)}}}),N[k][R]||r(13)(N[k],R,N[k].valueOf),l(N,"Symbol"),l(Math,"Math",!0),l(e.JSON,"JSON",!0)},function(t,n,r){r(43)("asyncIterator")},function(t,n,r){r(43)("observable")},function(t,n,r){r(107);for(var e=r(5),i=r(13),o=r(35),u=r(15)("toStringTag"),c=["NodeList","DOMTokenList","MediaList","StyleSheetList","CSSRuleList"],f=0;f<5;f++){var a=c[f],s=e[a],l=s&&s.prototype;l&&!l[u]&&i(l,u,a),o[a]=o.Array}},function(t,n,r){var e=r(45),i=r(7)("toStringTag"),o="Arguments"==e(function(){return arguments}()),u=function(t,n){try{return t[n]}catch(t){}};t.exports=function(t){var n,r,c;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(r=u(n=Object(t),i))?r:o?e(n):"Object"==(c=e(n))&&"function"==typeof n.callee?"Arguments":c}},function(t,n,r){var e=r(45);t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==e(t)?t.split(""):Object(t)}},function(t,n){n.f={}.propertyIsEnumerable},function(t,n,r){var e=r(30),i=r(16),o=r(75);t.exports=function(t){return function(n,r,u){var c,f=e(n),a=i(f.length),s=o(u,a);if(t&&r!=r){for(;a>s;)if((c=f[s++])!=c)return!0}else for(;a>s;s++)if((t||s in f)&&f[s]===r)return t||s||0;return!t&&-1}}},function(t,n,r){"use strict";var e=r(3),i=r(1),o=r(28),u=r(73),c=r(65),f=r(79),a=r(68),s=r(6),l=r(4),h=r(123),v=r(81),p=r(136);t.exports=function(t,n,r,d,y,g){var b=e[t],m=b,x=y?"set":"add",w=m&&m.prototype,S={},_=function(t){var n=w[t];o(w,t,"delete"==t?function(t){return!(g&&!s(t))&&n.call(this,0===t?0:t)}:"has"==t?function(t){return!(g&&!s(t))&&n.call(this,0===t?0:t)}:"get"==t?function(t){return g&&!s(t)?void 0:n.call(this,0===t?0:t)}:"add"==t?function(t){return n.call(this,0===t?0:t),this}:function(t,r){return n.call(this,0===t?0:t,r),this})};if("function"==typeof m&&(g||w.forEach&&!l(function(){(new m).entries().next()}))){var O=new m,E=O[x](g?{}:-0,1)!=O,P=l(function(){O.has(1)}),j=h(function(t){new m(t)}),F=!g&&l(function(){for(var t=new m,n=5;n--;)t[x](n,n);return!t.has(-0)});j||(m=n(function(n,r){a(n,m,t);var e=p(new b,n,m);return void 0!=r&&f(r,y,e[x],e),e}),m.prototype=w,w.constructor=m),(P||F)&&(_("delete"),_("has"),y&&_("get")),(F||E)&&_(x),g&&w.clear&&delete w.clear}else m=d.getConstructor(n,t,y,x),u(m.prototype,r),c.NEED=!0;return v(m,t),S[t]=m,i(i.G+i.W+i.F*(m!=b),S),g||d.setStrong(m,t,y),m}},function(t,n,r){"use strict";var e=r(27),i=r(28),o=r(4),u=r(46),c=r(7);t.exports=function(t,n,r){var f=c(t),a=r(u,f,""[t]),s=a[0],l=a[1];o(function(){var n={};return n[f]=function(){return 7},7!=""[t](n)})&&(i(String.prototype,t,s),e(RegExp.prototype,f,2==n?function(t,n){return l.call(t,this,n)}:function(t){return l.call(t,this)}))}
},function(t,n,r){"use strict";var e=r(2);t.exports=function(){var t=e(this),n="";return t.global&&(n+="g"),t.ignoreCase&&(n+="i"),t.multiline&&(n+="m"),t.unicode&&(n+="u"),t.sticky&&(n+="y"),n}},function(t,n){t.exports=function(t,n,r){var e=void 0===r;switch(n.length){case 0:return e?t():t.call(r);case 1:return e?t(n[0]):t.call(r,n[0]);case 2:return e?t(n[0],n[1]):t.call(r,n[0],n[1]);case 3:return e?t(n[0],n[1],n[2]):t.call(r,n[0],n[1],n[2]);case 4:return e?t(n[0],n[1],n[2],n[3]):t.call(r,n[0],n[1],n[2],n[3])}return t.apply(r,n)}},function(t,n,r){var e=r(6),i=r(45),o=r(7)("match");t.exports=function(t){var n;return e(t)&&(void 0!==(n=t[o])?!!n:"RegExp"==i(t))}},function(t,n,r){var e=r(7)("iterator"),i=!1;try{var o=[7][e]();o.return=function(){i=!0},Array.from(o,function(){throw 2})}catch(t){}t.exports=function(t,n){if(!n&&!i)return!1;var r=!1;try{var o=[7],u=o[e]();u.next=function(){return{done:r=!0}},o[e]=function(){return u},t(o)}catch(t){}return r}},function(t,n,r){t.exports=r(69)||!r(4)(function(){var t=Math.random();__defineSetter__.call(null,t,function(){}),delete r(3)[t]})},function(t,n){n.f=Object.getOwnPropertySymbols},function(t,n,r){var e=r(3),i="__core-js_shared__",o=e[i]||(e[i]={});t.exports=function(t){return o[t]||(o[t]={})}},function(t,n,r){for(var e,i=r(3),o=r(27),u=r(76),c=u("typed_array"),f=u("view"),a=!(!i.ArrayBuffer||!i.DataView),s=a,l=0,h="Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array".split(",");l<9;)(e=i[h[l++]])?(o(e.prototype,c,!0),o(e.prototype,f,!0)):s=!1;t.exports={ABV:a,CONSTR:s,TYPED:c,VIEW:f}},function(t,n){"use strict";var r={versions:function(){var t=window.navigator.userAgent;return{trident:t.indexOf("Trident")>-1,presto:t.indexOf("Presto")>-1,webKit:t.indexOf("AppleWebKit")>-1,gecko:t.indexOf("Gecko")>-1&&-1==t.indexOf("KHTML"),mobile:!!t.match(/AppleWebKit.*Mobile.*/),ios:!!t.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:t.indexOf("Android")>-1||t.indexOf("Linux")>-1,iPhone:t.indexOf("iPhone")>-1||t.indexOf("Mac")>-1,iPad:t.indexOf("iPad")>-1,webApp:-1==t.indexOf("Safari"),weixin:-1==t.indexOf("MicroMessenger")}}()};t.exports=r},function(t,n,r){"use strict";var e=r(85),i=function(t){return t&&t.__esModule?t:{default:t}}(e),o=function(){function t(t,n,e){return n||e?String.fromCharCode(n||e):r[t]||t}function n(t){return e[t]}var r={"&quot;":'"',"&lt;":"<","&gt;":">","&amp;":"&","&nbsp;":" "},e={};for(var u in r)e[r[u]]=u;return r["&apos;"]="'",e["'"]="&#39;",{encode:function(t){return t?(""+t).replace(/['<> "&]/g,n).replace(/\r?\n/g,"<br/>").replace(/\s/g,"&nbsp;"):""},decode:function(n){return n?(""+n).replace(/<br\s*\/?>/gi,"\n").replace(/&quot;|&lt;|&gt;|&amp;|&nbsp;|&apos;|&#(\d+);|&#(\d+)/g,t).replace(/\u00a0/g," "):""},encodeBase16:function(t){if(!t)return t;t+="";for(var n=[],r=0,e=t.length;e>r;r++)n.push(t.charCodeAt(r).toString(16).toUpperCase());return n.join("")},encodeBase16forJSON:function(t){if(!t)return t;t=t.replace(/[\u4E00-\u9FBF]/gi,function(t){return escape(t).replace("%u","\\u")});for(var n=[],r=0,e=t.length;e>r;r++)n.push(t.charCodeAt(r).toString(16).toUpperCase());return n.join("")},decodeBase16:function(t){if(!t)return t;t+="";for(var n=[],r=0,e=t.length;e>r;r+=2)n.push(String.fromCharCode("0x"+t.slice(r,r+2)));return n.join("")},encodeObject:function(t){if(t instanceof Array)for(var n=0,r=t.length;r>n;n++)t[n]=o.encodeObject(t[n]);else if("object"==(void 0===t?"undefined":(0,i.default)(t)))for(var e in t)t[e]=o.encodeObject(t[e]);else if("string"==typeof t)return o.encode(t);return t},loadScript:function(t){var n=document.createElement("script");document.getElementsByTagName("body")[0].appendChild(n),n.setAttribute("src",t)},addLoadEvent:function(t){var n=window.onload;"function"!=typeof window.onload?window.onload=t:window.onload=function(){n(),t()}}}}();t.exports=o},function(t,n,r){"use strict";var e=r(17),i=r(75),o=r(16);t.exports=function(t){for(var n=e(this),r=o(n.length),u=arguments.length,c=i(u>1?arguments[1]:void 0,r),f=u>2?arguments[2]:void 0,a=void 0===f?r:i(f,r);a>c;)n[c++]=t;return n}},function(t,n,r){"use strict";var e=r(11),i=r(66);t.exports=function(t,n,r){n in t?e.f(t,n,i(0,r)):t[n]=r}},function(t,n,r){var e=r(6),i=r(3).document,o=e(i)&&e(i.createElement);t.exports=function(t){return o?i.createElement(t):{}}},function(t,n){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(t,n,r){var e=r(7)("match");t.exports=function(t){var n=/./;try{"/./"[t](n)}catch(r){try{return n[e]=!1,!"/./"[t](n)}catch(t){}}return!0}},function(t,n,r){t.exports=r(3).document&&document.documentElement},function(t,n,r){var e=r(6),i=r(144).set;t.exports=function(t,n,r){var o,u=n.constructor;return u!==r&&"function"==typeof u&&(o=u.prototype)!==r.prototype&&e(o)&&i&&i(t,o),t}},function(t,n,r){var e=r(80),i=r(7)("iterator"),o=Array.prototype;t.exports=function(t){return void 0!==t&&(e.Array===t||o[i]===t)}},function(t,n,r){var e=r(45);t.exports=Array.isArray||function(t){return"Array"==e(t)}},function(t,n,r){"use strict";var e=r(70),i=r(66),o=r(81),u={};r(27)(u,r(7)("iterator"),function(){return this}),t.exports=function(t,n,r){t.prototype=e(u,{next:i(1,r)}),o(t,n+" Iterator")}},function(t,n,r){"use strict";var e=r(69),i=r(1),o=r(28),u=r(27),c=r(24),f=r(80),a=r(139),s=r(81),l=r(32),h=r(7)("iterator"),v=!([].keys&&"next"in[].keys()),p="keys",d="values",y=function(){return this};t.exports=function(t,n,r,g,b,m,x){a(r,n,g);var w,S,_,O=function(t){if(!v&&t in F)return F[t];switch(t){case p:case d:return function(){return new r(this,t)}}return function(){return new r(this,t)}},E=n+" Iterator",P=b==d,j=!1,F=t.prototype,M=F[h]||F["@@iterator"]||b&&F[b],A=M||O(b),N=b?P?O("entries"):A:void 0,T="Array"==n?F.entries||M:M;if(T&&(_=l(T.call(new t)))!==Object.prototype&&(s(_,E,!0),e||c(_,h)||u(_,h,y)),P&&M&&M.name!==d&&(j=!0,A=function(){return M.call(this)}),e&&!x||!v&&!j&&F[h]||u(F,h,A),f[n]=A,f[E]=y,b)if(w={values:P?A:O(d),keys:m?A:O(p),entries:N},x)for(S in w)S in F||o(F,S,w[S]);else i(i.P+i.F*(v||j),n,w);return w}},function(t,n){var r=Math.expm1;t.exports=!r||r(10)>22025.465794806718||r(10)<22025.465794806718||-2e-17!=r(-2e-17)?function(t){return 0==(t=+t)?t:t>-1e-6&&t<1e-6?t+t*t/2:Math.exp(t)-1}:r},function(t,n){t.exports=Math.sign||function(t){return 0==(t=+t)||t!=t?t:t<0?-1:1}},function(t,n,r){var e=r(3),i=r(151).set,o=e.MutationObserver||e.WebKitMutationObserver,u=e.process,c=e.Promise,f="process"==r(45)(u);t.exports=function(){var t,n,r,a=function(){var e,i;for(f&&(e=u.domain)&&e.exit();t;){i=t.fn,t=t.next;try{i()}catch(e){throw t?r():n=void 0,e}}n=void 0,e&&e.enter()};if(f)r=function(){u.nextTick(a)};else if(o){var s=!0,l=document.createTextNode("");new o(a).observe(l,{characterData:!0}),r=function(){l.data=s=!s}}else if(c&&c.resolve){var h=c.resolve();r=function(){h.then(a)}}else r=function(){i.call(e,a)};return function(e){var i={fn:e,next:void 0};n&&(n.next=i),t||(t=i,r()),n=i}}},function(t,n,r){var e=r(6),i=r(2),o=function(t,n){if(i(t),!e(n)&&null!==n)throw TypeError(n+": can't set as prototype!")};t.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(t,n,e){try{e=r(53)(Function.call,r(31).f(Object.prototype,"__proto__").set,2),e(t,[]),n=!(t instanceof Array)}catch(t){n=!0}return function(t,r){return o(t,r),n?t.__proto__=r:e(t,r),t}}({},!1):void 0),check:o}},function(t,n,r){var e=r(126)("keys"),i=r(76);t.exports=function(t){return e[t]||(e[t]=i(t))}},function(t,n,r){var e=r(2),i=r(26),o=r(7)("species");t.exports=function(t,n){var r,u=e(t).constructor;return void 0===u||void 0==(r=e(u)[o])?n:i(r)}},function(t,n,r){var e=r(67),i=r(46);t.exports=function(t){return function(n,r){var o,u,c=String(i(n)),f=e(r),a=c.length;return f<0||f>=a?t?"":void 0:(o=c.charCodeAt(f),o<55296||o>56319||f+1===a||(u=c.charCodeAt(f+1))<56320||u>57343?t?c.charAt(f):o:t?c.slice(f,f+2):u-56320+(o-55296<<10)+65536)}}},function(t,n,r){var e=r(122),i=r(46);t.exports=function(t,n,r){if(e(n))throw TypeError("String#"+r+" doesn't accept regex!");return String(i(t))}},function(t,n,r){"use strict";var e=r(67),i=r(46);t.exports=function(t){var n=String(i(this)),r="",o=e(t);if(o<0||o==1/0)throw RangeError("Count can't be negative");for(;o>0;(o>>>=1)&&(n+=n))1&o&&(r+=n);return r}},function(t,n){t.exports="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff"},function(t,n,r){var e,i,o,u=r(53),c=r(121),f=r(135),a=r(132),s=r(3),l=s.process,h=s.setImmediate,v=s.clearImmediate,p=s.MessageChannel,d=0,y={},g="onreadystatechange",b=function(){var t=+this;if(y.hasOwnProperty(t)){var n=y[t];delete y[t],n()}},m=function(t){b.call(t.data)};h&&v||(h=function(t){for(var n=[],r=1;arguments.length>r;)n.push(arguments[r++]);return y[++d]=function(){c("function"==typeof t?t:Function(t),n)},e(d),d},v=function(t){delete y[t]},"process"==r(45)(l)?e=function(t){l.nextTick(u(b,t,1))}:p?(i=new p,o=i.port2,i.port1.onmessage=m,e=u(o.postMessage,o,1)):s.addEventListener&&"function"==typeof postMessage&&!s.importScripts?(e=function(t){s.postMessage(t+"","*")},s.addEventListener("message",m,!1)):e=g in a("script")?function(t){f.appendChild(a("script"))[g]=function(){f.removeChild(this),b.call(t)}}:function(t){setTimeout(u(b,t,1),0)}),t.exports={set:h,clear:v}},function(t,n,r){"use strict";var e=r(3),i=r(10),o=r(69),u=r(127),c=r(27),f=r(73),a=r(4),s=r(68),l=r(67),h=r(16),v=r(71).f,p=r(11).f,d=r(130),y=r(81),g="ArrayBuffer",b="DataView",m="prototype",x="Wrong length!",w="Wrong index!",S=e[g],_=e[b],O=e.Math,E=e.RangeError,P=e.Infinity,j=S,F=O.abs,M=O.pow,A=O.floor,N=O.log,T=O.LN2,I="buffer",k="byteLength",L="byteOffset",R=i?"_b":I,C=i?"_l":k,D=i?"_o":L,U=function(t,n,r){var e,i,o,u=Array(r),c=8*r-n-1,f=(1<<c)-1,a=f>>1,s=23===n?M(2,-24)-M(2,-77):0,l=0,h=t<0||0===t&&1/t<0?1:0;for(t=F(t),t!=t||t===P?(i=t!=t?1:0,e=f):(e=A(N(t)/T),t*(o=M(2,-e))<1&&(e--,o*=2),t+=e+a>=1?s/o:s*M(2,1-a),t*o>=2&&(e++,o/=2),e+a>=f?(i=0,e=f):e+a>=1?(i=(t*o-1)*M(2,n),e+=a):(i=t*M(2,a-1)*M(2,n),e=0));n>=8;u[l++]=255&i,i/=256,n-=8);for(e=e<<n|i,c+=n;c>0;u[l++]=255&e,e/=256,c-=8);return u[--l]|=128*h,u},W=function(t,n,r){var e,i=8*r-n-1,o=(1<<i)-1,u=o>>1,c=i-7,f=r-1,a=t[f--],s=127&a;for(a>>=7;c>0;s=256*s+t[f],f--,c-=8);for(e=s&(1<<-c)-1,s>>=-c,c+=n;c>0;e=256*e+t[f],f--,c-=8);if(0===s)s=1-u;else{if(s===o)return e?NaN:a?-P:P;e+=M(2,n),s-=u}return(a?-1:1)*e*M(2,s-n)},G=function(t){return t[3]<<24|t[2]<<16|t[1]<<8|t[0]},B=function(t){return[255&t]},V=function(t){return[255&t,t>>8&255]},z=function(t){return[255&t,t>>8&255,t>>16&255,t>>24&255]},q=function(t){return U(t,52,8)},K=function(t){return U(t,23,4)},J=function(t,n,r){p(t[m],n,{get:function(){return this[r]}})},Y=function(t,n,r,e){var i=+r,o=l(i);if(i!=o||o<0||o+n>t[C])throw E(w);var u=t[R]._b,c=o+t[D],f=u.slice(c,c+n);return e?f:f.reverse()},H=function(t,n,r,e,i,o){var u=+r,c=l(u);if(u!=c||c<0||c+n>t[C])throw E(w);for(var f=t[R]._b,a=c+t[D],s=e(+i),h=0;h<n;h++)f[a+h]=s[o?h:n-h-1]},$=function(t,n){s(t,S,g);var r=+n,e=h(r);if(r!=e)throw E(x);return e};if(u.ABV){if(!a(function(){new S})||!a(function(){new S(.5)})){S=function(t){return new j($(this,t))};for(var X,Q=S[m]=j[m],Z=v(j),tt=0;Z.length>tt;)(X=Z[tt++])in S||c(S,X,j[X]);o||(Q.constructor=S)}var nt=new _(new S(2)),rt=_[m].setInt8;nt.setInt8(0,2147483648),nt.setInt8(1,2147483649),!nt.getInt8(0)&&nt.getInt8(1)||f(_[m],{setInt8:function(t,n){rt.call(this,t,n<<24>>24)},setUint8:function(t,n){rt.call(this,t,n<<24>>24)}},!0)}else S=function(t){var n=$(this,t);this._b=d.call(Array(n),0),this[C]=n},_=function(t,n,r){s(this,_,b),s(t,S,b);var e=t[C],i=l(n);if(i<0||i>e)throw E("Wrong offset!");if(r=void 0===r?e-i:h(r),i+r>e)throw E(x);this[R]=t,this[D]=i,this[C]=r},i&&(J(S,k,"_l"),J(_,I,"_b"),J(_,k,"_l"),J(_,L,"_o")),f(_[m],{getInt8:function(t){return Y(this,1,t)[0]<<24>>24},getUint8:function(t){return Y(this,1,t)[0]},getInt16:function(t){var n=Y(this,2,t,arguments[1]);return(n[1]<<8|n[0])<<16>>16},getUint16:function(t){var n=Y(this,2,t,arguments[1]);return n[1]<<8|n[0]},getInt32:function(t){return G(Y(this,4,t,arguments[1]))},getUint32:function(t){return G(Y(this,4,t,arguments[1]))>>>0},getFloat32:function(t){return W(Y(this,4,t,arguments[1]),23,4)},getFloat64:function(t){return W(Y(this,8,t,arguments[1]),52,8)},setInt8:function(t,n){H(this,1,t,B,n)},setUint8:function(t,n){H(this,1,t,B,n)},setInt16:function(t,n){H(this,2,t,V,n,arguments[2])},setUint16:function(t,n){H(this,2,t,V,n,arguments[2])},setInt32:function(t,n){H(this,4,t,z,n,arguments[2])},setUint32:function(t,n){H(this,4,t,z,n,arguments[2])},setFloat32:function(t,n){H(this,4,t,K,n,arguments[2])},setFloat64:function(t,n){H(this,8,t,q,n,arguments[2])}});y(S,g),y(_,b),c(_[m],u.VIEW,!0),n[g]=S,n[b]=_},function(t,n,r){var e=r(3),i=r(52),o=r(69),u=r(182),c=r(11).f;t.exports=function(t){var n=i.Symbol||(i.Symbol=o?{}:e.Symbol||{});"_"==t.charAt(0)||t in n||c(n,t,{value:u.f(t)})}},function(t,n,r){var e=r(114),i=r(7)("iterator"),o=r(80);t.exports=r(52).getIteratorMethod=function(t){if(void 0!=t)return t[i]||t["@@iterator"]||o[e(t)]}},function(t,n,r){"use strict";var e=r(78),i=r(170),o=r(80),u=r(30);t.exports=r(140)(Array,"Array",function(t,n){this._t=u(t),this._i=0,this._k=n},function(){var t=this._t,n=this._k,r=this._i++;return!t||r>=t.length?(this._t=void 0,i(1)):"keys"==n?i(0,r):"values"==n?i(0,t[r]):i(0,[r,t[r]])},"values"),o.Arguments=o.Array,e("keys"),e("values"),e("entries")},function(t,n){function r(t,n){t.classList?t.classList.add(n):t.className+=" "+n}t.exports=r},function(t,n){function r(t,n){if(t.classList)t.classList.remove(n);else{var r=new RegExp("(^|\\b)"+n.split(" ").join("|")+"(\\b|$)","gi");t.className=t.className.replace(r," ")}}t.exports=r},function(t,n){function r(){throw new Error("setTimeout has not been defined")}function e(){throw new Error("clearTimeout has not been defined")}function i(t){if(s===setTimeout)return setTimeout(t,0);if((s===r||!s)&&setTimeout)return s=setTimeout,setTimeout(t,0);try{return s(t,0)}catch(n){try{return s.call(null,t,0)}catch(n){return s.call(this,t,0)}}}function o(t){if(l===clearTimeout)return clearTimeout(t);if((l===e||!l)&&clearTimeout)return l=clearTimeout,clearTimeout(t);try{return l(t)}catch(n){try{return l.call(null,t)}catch(n){return l.call(this,t)}}}function u(){d&&v&&(d=!1,v.length?p=v.concat(p):y=-1,p.length&&c())}function c(){if(!d){var t=i(u);d=!0;for(var n=p.length;n;){for(v=p,p=[];++y<n;)v&&v[y].run();y=-1,n=p.length}v=null,d=!1,o(t)}}function f(t,n){this.fun=t,this.array=n}function a(){}var s,l,h=t.exports={};!function(){try{s="function"==typeof setTimeout?setTimeout:r}catch(t){s=r}try{l="function"==typeof clearTimeout?clearTimeout:e}catch(t){l=e}}();var v,p=[],d=!1,y=-1;h.nextTick=function(t){var n=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)n[r-1]=arguments[r];p.push(new f(t,n)),1!==p.length||d||i(c)},f.prototype.run=function(){this.fun.apply(null,this.array)},h.title="browser",h.browser=!0,h.env={},h.argv=[],h.version="",h.versions={},h.on=a,h.addListener=a,h.once=a,h.off=a,h.removeListener=a,h.removeAllListeners=a,h.emit=a,h.prependListener=a,h.prependOnceListener=a,h.listeners=function(t){return[]},h.binding=function(t){throw new Error("process.binding is not supported")},h.cwd=function(){return"/"},h.chdir=function(t){throw new Error("process.chdir is not supported")},h.umask=function(){return 0}},function(t,n,r){var e=r(45);t.exports=function(t,n){if("number"!=typeof t&&"Number"!=e(t))throw TypeError(n);return+t}},function(t,n,r){"use strict";var e=r(17),i=r(75),o=r(16);t.exports=[].copyWithin||function(t,n){var r=e(this),u=o(r.length),c=i(t,u),f=i(n,u),a=arguments.length>2?arguments[2]:void 0,s=Math.min((void 0===a?u:i(a,u))-f,u-c),l=1;for(f<c&&c<f+s&&(l=-1,f+=s-1,c+=s-1);s-- >0;)f in r?r[c]=r[f]:delete r[c],c+=l,f+=l;return r}},function(t,n,r){var e=r(79);t.exports=function(t,n){var r=[];return e(t,!1,r.push,r,n),r}},function(t,n,r){var e=r(26),i=r(17),o=r(115),u=r(16);t.exports=function(t,n,r,c,f){e(n);var a=i(t),s=o(a),l=u(a.length),h=f?l-1:0,v=f?-1:1;if(r<2)for(;;){if(h in s){c=s[h],h+=v;break}if(h+=v,f?h<0:l<=h)throw TypeError("Reduce of empty array with no initial value")}for(;f?h>=0:l>h;h+=v)h in s&&(c=n(c,s[h],h,a));return c}},function(t,n,r){"use strict";var e=r(26),i=r(6),o=r(121),u=[].slice,c={},f=function(t,n,r){if(!(n in c)){for(var e=[],i=0;i<n;i++)e[i]="a["+i+"]";c[n]=Function("F,a","return new F("+e.join(",")+")")}return c[n](t,r)};t.exports=Function.bind||function(t){var n=e(this),r=u.call(arguments,1),c=function(){var e=r.concat(u.call(arguments));return this instanceof c?f(n,e.length,e):o(n,e,t)};return i(n.prototype)&&(c.prototype=n.prototype),c}},function(t,n,r){"use strict";var e=r(11).f,i=r(70),o=r(73),u=r(53),c=r(68),f=r(46),a=r(79),s=r(140),l=r(170),h=r(74),v=r(10),p=r(65).fastKey,d=v?"_s":"size",y=function(t,n){var r,e=p(n);if("F"!==e)return t._i[e];for(r=t._f;r;r=r.n)if(r.k==n)return r};t.exports={getConstructor:function(t,n,r,s){var l=t(function(t,e){c(t,l,n,"_i"),t._i=i(null),t._f=void 0,t._l=void 0,t[d]=0,void 0!=e&&a(e,r,t[s],t)});return o(l.prototype,{clear:function(){for(var t=this,n=t._i,r=t._f;r;r=r.n)r.r=!0,r.p&&(r.p=r.p.n=void 0),delete n[r.i];t._f=t._l=void 0,t[d]=0},delete:function(t){var n=this,r=y(n,t);if(r){var e=r.n,i=r.p;delete n._i[r.i],r.r=!0,i&&(i.n=e),e&&(e.p=i),n._f==r&&(n._f=e),n._l==r&&(n._l=i),n[d]--}return!!r},forEach:function(t){c(this,l,"forEach");for(var n,r=u(t,arguments.length>1?arguments[1]:void 0,3);n=n?n.n:this._f;)for(r(n.v,n.k,this);n&&n.r;)n=n.p},has:function(t){return!!y(this,t)}}),v&&e(l.prototype,"size",{get:function(){return f(this[d])}}),l},def:function(t,n,r){var e,i,o=y(t,n);return o?o.v=r:(t._l=o={i:i=p(n,!0),k:n,v:r,p:e=t._l,n:void 0,r:!1},t._f||(t._f=o),e&&(e.n=o),t[d]++,"F"!==i&&(t._i[i]=o)),t},getEntry:y,setStrong:function(t,n,r){s(t,n,function(t,n){this._t=t,this._k=n,this._l=void 0},function(){for(var t=this,n=t._k,r=t._l;r&&r.r;)r=r.p;return t._t&&(t._l=r=r?r.n:t._t._f)?"keys"==n?l(0,r.k):"values"==n?l(0,r.v):l(0,[r.k,r.v]):(t._t=void 0,l(1))},r?"entries":"values",!r,!0),h(n)}}},function(t,n,r){var e=r(114),i=r(161);t.exports=function(t){return function(){if(e(this)!=t)throw TypeError(t+"#toJSON isn't generic");return i(this)}}},function(t,n,r){"use strict";var e=r(73),i=r(65).getWeak,o=r(2),u=r(6),c=r(68),f=r(79),a=r(48),s=r(24),l=a(5),h=a(6),v=0,p=function(t){return t._l||(t._l=new d)},d=function(){this.a=[]},y=function(t,n){return l(t.a,function(t){return t[0]===n})};d.prototype={get:function(t){var n=y(this,t);if(n)return n[1]},has:function(t){return!!y(this,t)},set:function(t,n){var r=y(this,t);r?r[1]=n:this.a.push([t,n])},delete:function(t){var n=h(this.a,function(n){return n[0]===t});return~n&&this.a.splice(n,1),!!~n}},t.exports={getConstructor:function(t,n,r,o){var a=t(function(t,e){c(t,a,n,"_i"),t._i=v++,t._l=void 0,void 0!=e&&f(e,r,t[o],t)});return e(a.prototype,{delete:function(t){if(!u(t))return!1;var n=i(t);return!0===n?p(this).delete(t):n&&s(n,this._i)&&delete n[this._i]},has:function(t){if(!u(t))return!1;var n=i(t);return!0===n?p(this).has(t):n&&s(n,this._i)}}),a},def:function(t,n,r){var e=i(o(n),!0);return!0===e?p(t).set(n,r):e[t._i]=r,t},ufstore:p}},function(t,n,r){t.exports=!r(10)&&!r(4)(function(){return 7!=Object.defineProperty(r(132)("div"),"a",{get:function(){return 7}}).a})},function(t,n,r){var e=r(6),i=Math.floor;t.exports=function(t){return!e(t)&&isFinite(t)&&i(t)===t}},function(t,n,r){var e=r(2);t.exports=function(t,n,r,i){try{return i?n(e(r)[0],r[1]):n(r)}catch(n){var o=t.return;throw void 0!==o&&e(o.call(t)),n}}},function(t,n){t.exports=function(t,n){return{value:n,done:!!t}}},function(t,n){t.exports=Math.log1p||function(t){return(t=+t)>-1e-8&&t<1e-8?t-t*t/2:Math.log(1+t)}},function(t,n,r){"use strict";var e=r(72),i=r(125),o=r(116),u=r(17),c=r(115),f=Object.assign;t.exports=!f||r(4)(function(){var t={},n={},r=Symbol(),e="abcdefghijklmnopqrst";return t[r]=7,e.split("").forEach(function(t){n[t]=t}),7!=f({},t)[r]||Object.keys(f({},n)).join("")!=e})?function(t,n){for(var r=u(t),f=arguments.length,a=1,s=i.f,l=o.f;f>a;)for(var h,v=c(arguments[a++]),p=s?e(v).concat(s(v)):e(v),d=p.length,y=0;d>y;)l.call(v,h=p[y++])&&(r[h]=v[h]);return r}:f},function(t,n,r){var e=r(11),i=r(2),o=r(72);t.exports=r(10)?Object.defineProperties:function(t,n){i(t);for(var r,u=o(n),c=u.length,f=0;c>f;)e.f(t,r=u[f++],n[r]);return t}},function(t,n,r){var e=r(30),i=r(71).f,o={}.toString,u="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],c=function(t){try{return i(t)}catch(t){return u.slice()}};t.exports.f=function(t){return u&&"[object Window]"==o.call(t)?c(t):i(e(t))}},function(t,n,r){var e=r(24),i=r(30),o=r(117)(!1),u=r(145)("IE_PROTO");t.exports=function(t,n){var r,c=i(t),f=0,a=[];for(r in c)r!=u&&e(c,r)&&a.push(r);for(;n.length>f;)e(c,r=n[f++])&&(~o(a,r)||a.push(r));return a}},function(t,n,r){var e=r(72),i=r(30),o=r(116).f;t.exports=function(t){return function(n){for(var r,u=i(n),c=e(u),f=c.length,a=0,s=[];f>a;)o.call(u,r=c[a++])&&s.push(t?[r,u[r]]:u[r]);return s}}},function(t,n,r){var e=r(71),i=r(125),o=r(2),u=r(3).Reflect;t.exports=u&&u.ownKeys||function(t){var n=e.f(o(t)),r=i.f;return r?n.concat(r(t)):n}},function(t,n,r){var e=r(3).parseFloat,i=r(82).trim;t.exports=1/e(r(150)+"-0")!=-1/0?function(t){var n=i(String(t),3),r=e(n);return 0===r&&"-"==n.charAt(0)?-0:r}:e},function(t,n,r){var e=r(3).parseInt,i=r(82).trim,o=r(150),u=/^[\-+]?0[xX]/;t.exports=8!==e(o+"08")||22!==e(o+"0x16")?function(t,n){var r=i(String(t),3);return e(r,n>>>0||(u.test(r)?16:10))}:e},function(t,n){t.exports=Object.is||function(t,n){return t===n?0!==t||1/t==1/n:t!=t&&n!=n}},function(t,n,r){var e=r(16),i=r(149),o=r(46);t.exports=function(t,n,r,u){var c=String(o(t)),f=c.length,a=void 0===r?" ":String(r),s=e(n);if(s<=f||""==a)return c;var l=s-f,h=i.call(a,Math.ceil(l/a.length));return h.length>l&&(h=h.slice(0,l)),u?h+c:c+h}},function(t,n,r){n.f=r(7)},function(t,n,r){"use strict";var e=r(164);t.exports=r(118)("Map",function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},{get:function(t){var n=e.getEntry(this,t);return n&&n.v},set:function(t,n){return e.def(this,0===t?0:t,n)}},e,!0)},function(t,n,r){r(10)&&"g"!=/./g.flags&&r(11).f(RegExp.prototype,"flags",{configurable:!0,get:r(120)})},function(t,n,r){"use strict";var e=r(164);t.exports=r(118)("Set",function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},{add:function(t){return e.def(this,t=0===t?0:t,t)}},e)},function(t,n,r){"use strict";var e,i=r(48)(0),o=r(28),u=r(65),c=r(172),f=r(166),a=r(6),s=u.getWeak,l=Object.isExtensible,h=f.ufstore,v={},p=function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},d={get:function(t){if(a(t)){var n=s(t);return!0===n?h(this).get(t):n?n[this._i]:void 0}},set:function(t,n){return f.def(this,t,n)}},y=t.exports=r(118)("WeakMap",p,d,f,!0,!0);7!=(new y).set((Object.freeze||Object)(v),7).get(v)&&(e=f.getConstructor(p),c(e.prototype,d),u.NEED=!0,i(["delete","has","get","set"],function(t){var n=y.prototype,r=n[t];o(n,t,function(n,i){if(a(n)&&!l(n)){this._f||(this._f=new e);var o=this._f[t](n,i);return"set"==t?this:o}return r.call(this,n,i)})}))},,,,function(t,n){"use strict";function r(){var t=document.querySelector("#page-nav");if(t&&!document.querySelector("#page-nav .extend.prev")&&(t.innerHTML='<a class="extend prev disabled" rel="prev">&laquo; Prev</a>'+t.innerHTML),t&&!document.querySelector("#page-nav .extend.next")&&(t.innerHTML=t.innerHTML+'<a class="extend next disabled" rel="next">Next &raquo;</a>'),yiliaConfig&&yiliaConfig.open_in_new){document.querySelectorAll(".article-entry a:not(.article-more-a)").forEach(function(t){var n=t.getAttribute("target");n&&""!==n||t.setAttribute("target","_blank")})}if(yiliaConfig&&yiliaConfig.toc_hide_index){document.querySelectorAll(".toc-number").forEach(function(t){t.style.display="none"})}var n=document.querySelector("#js-aboutme");n&&0!==n.length&&(n.innerHTML=n.innerText)}t.exports={init:r}},function(t,n,r){"use strict";function e(t){return t&&t.__esModule?t:{default:t}}function i(t,n){var r=/\/|index.html/g;return t.replace(r,"")===n.replace(r,"")}function o(){for(var t=document.querySelectorAll(".js-header-menu li a"),n=window.location.pathname,r=0,e=t.length;r<e;r++){var o=t[r];i(n,o.getAttribute("href"))&&(0,h.default)(o,"active")}}function u(t){for(var n=t.offsetLeft,r=t.offsetParent;null!==r;)n+=r.offsetLeft,r=r.offsetParent;return n}function c(t){for(var n=t.offsetTop,r=t.offsetParent;null!==r;)n+=r.offsetTop,r=r.offsetParent;return n}function f(t,n,r,e,i){var o=u(t),f=c(t)-n;if(f-r<=i){var a=t.$newDom;a||(a=t.cloneNode(!0),(0,d.default)(t,a),t.$newDom=a,a.style.position="fixed",a.style.top=(r||f)+"px",a.style.left=o+"px",a.style.zIndex=e||2,a.style.width="100%",a.style.color="#fff"),a.style.visibility="visible",t.style.visibility="hidden"}else{t.style.visibility="visible";var s=t.$newDom;s&&(s.style.visibility="hidden")}}function a(){var t=document.querySelector(".js-overlay"),n=document.querySelector(".js-header-menu");f(t,document.body.scrollTop,-63,2,0),f(n,document.body.scrollTop,1,3,0)}function s(){document.querySelector("#container").addEventListener("scroll",function(t){a()}),window.addEventListener("scroll",function(t){a()}),a()}var l=r(156),h=e(l),v=r(157),p=(e(v),r(382)),d=e(p),y=r(128),g=e(y),b=r(190),m=e(b),x=r(129);(function(){g.default.versions.mobile&&window.screen.width<800&&(o(),s())})(),(0,x.addLoadEvent)(function(){m.default.init()}),t.exports={}},,,,function(t,n,r){(function(t){"use strict";function n(t,n,r){t[n]||Object[e](t,n,{writable:!0,configurable:!0,value:r})}if(r(381),r(391),r(198),t._babelPolyfill)throw new Error("only one instance of babel-polyfill is allowed");t._babelPolyfill=!0;var e="defineProperty";n(String.prototype,"padLeft","".padStart),n(String.prototype,"padRight","".padEnd),"pop,reverse,shift,keys,values,entries,indexOf,every,some,forEach,map,filter,find,findIndex,includes,join,slice,concat,push,splice,unshift,sort,lastIndexOf,reduce,reduceRight,copyWithin,fill".split(",").forEach(function(t){[][t]&&n(Array,t,Function.call.bind([][t]))})}).call(n,function(){return this}())},,,function(t,n,r){r(210),t.exports=r(52).RegExp.escape},,,,function(t,n,r){var e=r(6),i=r(138),o=r(7)("species");t.exports=function(t){var n;return i(t)&&(n=t.constructor,"function"!=typeof n||n!==Array&&!i(n.prototype)||(n=void 0),e(n)&&null===(n=n[o])&&(n=void 0)),void 0===n?Array:n}},function(t,n,r){var e=r(202);t.exports=function(t,n){return new(e(t))(n)}},function(t,n,r){"use strict";var e=r(2),i=r(50),o="number";t.exports=function(t){if("string"!==t&&t!==o&&"default"!==t)throw TypeError("Incorrect hint");return i(e(this),t!=o)}},function(t,n,r){var e=r(72),i=r(125),o=r(116);t.exports=function(t){var n=e(t),r=i.f;if(r)for(var u,c=r(t),f=o.f,a=0;c.length>a;)f.call(t,u=c[a++])&&n.push(u);return n}},function(t,n,r){var e=r(72),i=r(30);t.exports=function(t,n){for(var r,o=i(t),u=e(o),c=u.length,f=0;c>f;)if(o[r=u[f++]]===n)return r}},function(t,n,r){"use strict";var e=r(208),i=r(121),o=r(26);t.exports=function(){for(var t=o(this),n=arguments.length,r=Array(n),u=0,c=e._,f=!1;n>u;)(r[u]=arguments[u++])===c&&(f=!0);return function(){var e,o=this,u=arguments.length,a=0,s=0;if(!f&&!u)return i(t,r,o);if(e=r.slice(),f)for(;n>a;a++)e[a]===c&&(e[a]=arguments[s++]);for(;u>s;)e.push(arguments[s++]);return i(t,e,o)}}},function(t,n,r){t.exports=r(3)},function(t,n){t.exports=function(t,n){var r=n===Object(n)?function(t){return n[t]}:n;return function(n){return String(n).replace(t,r)}}},function(t,n,r){var e=r(1),i=r(209)(/[\\^$*+?.()|[\]{}]/g,"\\$&");e(e.S,"RegExp",{escape:function(t){return i(t)}})},function(t,n,r){var e=r(1);e(e.P,"Array",{copyWithin:r(160)}),r(78)("copyWithin")},function(t,n,r){"use strict";var e=r(1),i=r(48)(4);e(e.P+e.F*!r(47)([].every,!0),"Array",{every:function(t){return i(this,t,arguments[1])}})},function(t,n,r){var e=r(1);e(e.P,"Array",{fill:r(130)}),r(78)("fill")},function(t,n,r){"use strict";var e=r(1),i=r(48)(2);e(e.P+e.F*!r(47)([].filter,!0),"Array",{filter:function(t){return i(this,t,arguments[1])}})},function(t,n,r){"use strict";var e=r(1),i=r(48)(6),o="findIndex",u=!0;o in[]&&Array(1)[o](function(){u=!1}),e(e.P+e.F*u,"Array",{findIndex:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0)}}),r(78)(o)},function(t,n,r){"use strict";var e=r(1),i=r(48)(5),o="find",u=!0;o in[]&&Array(1)[o](function(){u=!1}),e(e.P+e.F*u,"Array",{find:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0)}}),r(78)(o)},function(t,n,r){"use strict";var e=r(1),i=r(48)(0),o=r(47)([].forEach,!0);e(e.P+e.F*!o,"Array",{forEach:function(t){return i(this,t,arguments[1])}})},function(t,n,r){"use strict";var e=r(53),i=r(1),o=r(17),u=r(169),c=r(137),f=r(16),a=r(131),s=r(154);i(i.S+i.F*!r(123)(function(t){Array.from(t)}),"Array",{from:function(t){var n,r,i,l,h=o(t),v="function"==typeof this?this:Array,p=arguments.length,d=p>1?arguments[1]:void 0,y=void 0!==d,g=0,b=s(h);if(y&&(d=e(d,p>2?arguments[2]:void 0,2)),void 0==b||v==Array&&c(b))for(n=f(h.length),r=new v(n);n>g;g++)a(r,g,y?d(h[g],g):h[g]);else for(l=b.call(h),r=new v;!(i=l.next()).done;g++)a(r,g,y?u(l,d,[i.value,g],!0):i.value);return r.length=g,r}})},function(t,n,r){"use strict";var e=r(1),i=r(117)(!1),o=[].indexOf,u=!!o&&1/[1].indexOf(1,-0)<0;e(e.P+e.F*(u||!r(47)(o)),"Array",{indexOf:function(t){return u?o.apply(this,arguments)||0:i(this,t,arguments[1])}})},function(t,n,r){var e=r(1);e(e.S,"Array",{isArray:r(138)})},function(t,n,r){"use strict";var e=r(1),i=r(30),o=[].join;e(e.P+e.F*(r(115)!=Object||!r(47)(o)),"Array",{join:function(t){return o.call(i(this),void 0===t?",":t)}})},function(t,n,r){"use strict";var e=r(1),i=r(30),o=r(67),u=r(16),c=[].lastIndexOf,f=!!c&&1/[1].lastIndexOf(1,-0)<0;e(e.P+e.F*(f||!r(47)(c)),"Array",{lastIndexOf:function(t){if(f)return c.apply(this,arguments)||0;var n=i(this),r=u(n.length),e=r-1;for(arguments.length>1&&(e=Math.min(e,o(arguments[1]))),e<0&&(e=r+e);e>=0;e--)if(e in n&&n[e]===t)return e||0;return-1}})},function(t,n,r){"use strict";var e=r(1),i=r(48)(1);e(e.P+e.F*!r(47)([].map,!0),"Array",{map:function(t){return i(this,t,arguments[1])}})},function(t,n,r){"use strict";var e=r(1),i=r(131);e(e.S+e.F*r(4)(function(){function t(){}return!(Array.of.call(t)instanceof t)}),"Array",{of:function(){for(var t=0,n=arguments.length,r=new("function"==typeof this?this:Array)(n);n>t;)i(r,t,arguments[t++]);return r.length=n,r}})},function(t,n,r){"use strict";var e=r(1),i=r(162);e(e.P+e.F*!r(47)([].reduceRight,!0),"Array",{reduceRight:function(t){return i(this,t,arguments.length,arguments[1],!0)}})},function(t,n,r){"use strict";var e=r(1),i=r(162);e(e.P+e.F*!r(47)([].reduce,!0),"Array",{reduce:function(t){return i(this,t,arguments.length,arguments[1],!1)}})},function(t,n,r){"use strict";var e=r(1),i=r(135),o=r(45),u=r(75),c=r(16),f=[].slice;e(e.P+e.F*r(4)(function(){i&&f.call(i)}),"Array",{slice:function(t,n){var r=c(this.length),e=o(this);if(n=void 0===n?r:n,"Array"==e)return f.call(this,t,n);for(var i=u(t,r),a=u(n,r),s=c(a-i),l=Array(s),h=0;h<s;h++)l[h]="String"==e?this.charAt(i+h):this[i+h];return l}})},function(t,n,r){"use strict";var e=r(1),i=r(48)(3);e(e.P+e.F*!r(47)([].some,!0),"Array",{some:function(t){return i(this,t,arguments[1])}})},function(t,n,r){"use strict";var e=r(1),i=r(26),o=r(17),u=r(4),c=[].sort,f=[1,2,3];e(e.P+e.F*(u(function(){f.sort(void 0)})||!u(function(){f.sort(null)})||!r(47)(c)),"Array",{sort:function(t){return void 0===t?c.call(o(this)):c.call(o(this),i(t))}})},function(t,n,r){r(74)("Array")},function(t,n,r){var e=r(1);e(e.S,"Date",{now:function(){return(new Date).getTime()}})},function(t,n,r){"use strict";var e=r(1),i=r(4),o=Date.prototype.getTime,u=function(t){return t>9?t:"0"+t};e(e.P+e.F*(i(function(){return"0385-07-25T07:06:39.999Z"!=new Date(-5e13-1).toISOString()})||!i(function(){new Date(NaN).toISOString()})),"Date",{toISOString:function(){
if(!isFinite(o.call(this)))throw RangeError("Invalid time value");var t=this,n=t.getUTCFullYear(),r=t.getUTCMilliseconds(),e=n<0?"-":n>9999?"+":"";return e+("00000"+Math.abs(n)).slice(e?-6:-4)+"-"+u(t.getUTCMonth()+1)+"-"+u(t.getUTCDate())+"T"+u(t.getUTCHours())+":"+u(t.getUTCMinutes())+":"+u(t.getUTCSeconds())+"."+(r>99?r:"0"+u(r))+"Z"}})},function(t,n,r){"use strict";var e=r(1),i=r(17),o=r(50);e(e.P+e.F*r(4)(function(){return null!==new Date(NaN).toJSON()||1!==Date.prototype.toJSON.call({toISOString:function(){return 1}})}),"Date",{toJSON:function(t){var n=i(this),r=o(n);return"number"!=typeof r||isFinite(r)?n.toISOString():null}})},function(t,n,r){var e=r(7)("toPrimitive"),i=Date.prototype;e in i||r(27)(i,e,r(204))},function(t,n,r){var e=Date.prototype,i="Invalid Date",o="toString",u=e[o],c=e.getTime;new Date(NaN)+""!=i&&r(28)(e,o,function(){var t=c.call(this);return t===t?u.call(this):i})},function(t,n,r){var e=r(1);e(e.P,"Function",{bind:r(163)})},function(t,n,r){"use strict";var e=r(6),i=r(32),o=r(7)("hasInstance"),u=Function.prototype;o in u||r(11).f(u,o,{value:function(t){if("function"!=typeof this||!e(t))return!1;if(!e(this.prototype))return t instanceof this;for(;t=i(t);)if(this.prototype===t)return!0;return!1}})},function(t,n,r){var e=r(11).f,i=r(66),o=r(24),u=Function.prototype,c="name",f=Object.isExtensible||function(){return!0};c in u||r(10)&&e(u,c,{configurable:!0,get:function(){try{var t=this,n=(""+t).match(/^\s*function ([^ (]*)/)[1];return o(t,c)||!f(t)||e(t,c,i(5,n)),n}catch(t){return""}}})},function(t,n,r){var e=r(1),i=r(171),o=Math.sqrt,u=Math.acosh;e(e.S+e.F*!(u&&710==Math.floor(u(Number.MAX_VALUE))&&u(1/0)==1/0),"Math",{acosh:function(t){return(t=+t)<1?NaN:t>94906265.62425156?Math.log(t)+Math.LN2:i(t-1+o(t-1)*o(t+1))}})},function(t,n,r){function e(t){return isFinite(t=+t)&&0!=t?t<0?-e(-t):Math.log(t+Math.sqrt(t*t+1)):t}var i=r(1),o=Math.asinh;i(i.S+i.F*!(o&&1/o(0)>0),"Math",{asinh:e})},function(t,n,r){var e=r(1),i=Math.atanh;e(e.S+e.F*!(i&&1/i(-0)<0),"Math",{atanh:function(t){return 0==(t=+t)?t:Math.log((1+t)/(1-t))/2}})},function(t,n,r){var e=r(1),i=r(142);e(e.S,"Math",{cbrt:function(t){return i(t=+t)*Math.pow(Math.abs(t),1/3)}})},function(t,n,r){var e=r(1);e(e.S,"Math",{clz32:function(t){return(t>>>=0)?31-Math.floor(Math.log(t+.5)*Math.LOG2E):32}})},function(t,n,r){var e=r(1),i=Math.exp;e(e.S,"Math",{cosh:function(t){return(i(t=+t)+i(-t))/2}})},function(t,n,r){var e=r(1),i=r(141);e(e.S+e.F*(i!=Math.expm1),"Math",{expm1:i})},function(t,n,r){var e=r(1),i=r(142),o=Math.pow,u=o(2,-52),c=o(2,-23),f=o(2,127)*(2-c),a=o(2,-126),s=function(t){return t+1/u-1/u};e(e.S,"Math",{fround:function(t){var n,r,e=Math.abs(t),o=i(t);return e<a?o*s(e/a/c)*a*c:(n=(1+c/u)*e,r=n-(n-e),r>f||r!=r?o*(1/0):o*r)}})},function(t,n,r){var e=r(1),i=Math.abs;e(e.S,"Math",{hypot:function(t,n){for(var r,e,o=0,u=0,c=arguments.length,f=0;u<c;)r=i(arguments[u++]),f<r?(e=f/r,o=o*e*e+1,f=r):r>0?(e=r/f,o+=e*e):o+=r;return f===1/0?1/0:f*Math.sqrt(o)}})},function(t,n,r){var e=r(1),i=Math.imul;e(e.S+e.F*r(4)(function(){return-5!=i(4294967295,5)||2!=i.length}),"Math",{imul:function(t,n){var r=65535,e=+t,i=+n,o=r&e,u=r&i;return 0|o*u+((r&e>>>16)*u+o*(r&i>>>16)<<16>>>0)}})},function(t,n,r){var e=r(1);e(e.S,"Math",{log10:function(t){return Math.log(t)/Math.LN10}})},function(t,n,r){var e=r(1);e(e.S,"Math",{log1p:r(171)})},function(t,n,r){var e=r(1);e(e.S,"Math",{log2:function(t){return Math.log(t)/Math.LN2}})},function(t,n,r){var e=r(1);e(e.S,"Math",{sign:r(142)})},function(t,n,r){var e=r(1),i=r(141),o=Math.exp;e(e.S+e.F*r(4)(function(){return-2e-17!=!Math.sinh(-2e-17)}),"Math",{sinh:function(t){return Math.abs(t=+t)<1?(i(t)-i(-t))/2:(o(t-1)-o(-t-1))*(Math.E/2)}})},function(t,n,r){var e=r(1),i=r(141),o=Math.exp;e(e.S,"Math",{tanh:function(t){var n=i(t=+t),r=i(-t);return n==1/0?1:r==1/0?-1:(n-r)/(o(t)+o(-t))}})},function(t,n,r){var e=r(1);e(e.S,"Math",{trunc:function(t){return(t>0?Math.floor:Math.ceil)(t)}})},function(t,n,r){"use strict";var e=r(3),i=r(24),o=r(45),u=r(136),c=r(50),f=r(4),a=r(71).f,s=r(31).f,l=r(11).f,h=r(82).trim,v="Number",p=e[v],d=p,y=p.prototype,g=o(r(70)(y))==v,b="trim"in String.prototype,m=function(t){var n=c(t,!1);if("string"==typeof n&&n.length>2){n=b?n.trim():h(n,3);var r,e,i,o=n.charCodeAt(0);if(43===o||45===o){if(88===(r=n.charCodeAt(2))||120===r)return NaN}else if(48===o){switch(n.charCodeAt(1)){case 66:case 98:e=2,i=49;break;case 79:case 111:e=8,i=55;break;default:return+n}for(var u,f=n.slice(2),a=0,s=f.length;a<s;a++)if((u=f.charCodeAt(a))<48||u>i)return NaN;return parseInt(f,e)}}return+n};if(!p(" 0o1")||!p("0b1")||p("+0x1")){p=function(t){var n=arguments.length<1?0:t,r=this;return r instanceof p&&(g?f(function(){y.valueOf.call(r)}):o(r)!=v)?u(new d(m(n)),r,p):m(n)};for(var x,w=r(10)?a(d):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),S=0;w.length>S;S++)i(d,x=w[S])&&!i(p,x)&&l(p,x,s(d,x));p.prototype=y,y.constructor=p,r(28)(e,v,p)}},function(t,n,r){var e=r(1);e(e.S,"Number",{EPSILON:Math.pow(2,-52)})},function(t,n,r){var e=r(1),i=r(3).isFinite;e(e.S,"Number",{isFinite:function(t){return"number"==typeof t&&i(t)}})},function(t,n,r){var e=r(1);e(e.S,"Number",{isInteger:r(168)})},function(t,n,r){var e=r(1);e(e.S,"Number",{isNaN:function(t){return t!=t}})},function(t,n,r){var e=r(1),i=r(168),o=Math.abs;e(e.S,"Number",{isSafeInteger:function(t){return i(t)&&o(t)<=9007199254740991}})},function(t,n,r){var e=r(1);e(e.S,"Number",{MAX_SAFE_INTEGER:9007199254740991})},function(t,n,r){var e=r(1);e(e.S,"Number",{MIN_SAFE_INTEGER:-9007199254740991})},function(t,n,r){var e=r(1),i=r(178);e(e.S+e.F*(Number.parseFloat!=i),"Number",{parseFloat:i})},function(t,n,r){var e=r(1),i=r(179);e(e.S+e.F*(Number.parseInt!=i),"Number",{parseInt:i})},function(t,n,r){"use strict";var e=r(1),i=r(67),o=r(159),u=r(149),c=1..toFixed,f=Math.floor,a=[0,0,0,0,0,0],s="Number.toFixed: incorrect invocation!",l="0",h=function(t,n){for(var r=-1,e=n;++r<6;)e+=t*a[r],a[r]=e%1e7,e=f(e/1e7)},v=function(t){for(var n=6,r=0;--n>=0;)r+=a[n],a[n]=f(r/t),r=r%t*1e7},p=function(){for(var t=6,n="";--t>=0;)if(""!==n||0===t||0!==a[t]){var r=String(a[t]);n=""===n?r:n+u.call(l,7-r.length)+r}return n},d=function(t,n,r){return 0===n?r:n%2==1?d(t,n-1,r*t):d(t*t,n/2,r)},y=function(t){for(var n=0,r=t;r>=4096;)n+=12,r/=4096;for(;r>=2;)n+=1,r/=2;return n};e(e.P+e.F*(!!c&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0))||!r(4)(function(){c.call({})})),"Number",{toFixed:function(t){var n,r,e,c,f=o(this,s),a=i(t),g="",b=l;if(a<0||a>20)throw RangeError(s);if(f!=f)return"NaN";if(f<=-1e21||f>=1e21)return String(f);if(f<0&&(g="-",f=-f),f>1e-21)if(n=y(f*d(2,69,1))-69,r=n<0?f*d(2,-n,1):f/d(2,n,1),r*=4503599627370496,(n=52-n)>0){for(h(0,r),e=a;e>=7;)h(1e7,0),e-=7;for(h(d(10,e,1),0),e=n-1;e>=23;)v(1<<23),e-=23;v(1<<e),h(1,1),v(2),b=p()}else h(0,r),h(1<<-n,0),b=p()+u.call(l,a);return a>0?(c=b.length,b=g+(c<=a?"0."+u.call(l,a-c)+b:b.slice(0,c-a)+"."+b.slice(c-a))):b=g+b,b}})},function(t,n,r){"use strict";var e=r(1),i=r(4),o=r(159),u=1..toPrecision;e(e.P+e.F*(i(function(){return"1"!==u.call(1,void 0)})||!i(function(){u.call({})})),"Number",{toPrecision:function(t){var n=o(this,"Number#toPrecision: incorrect invocation!");return void 0===t?u.call(n):u.call(n,t)}})},function(t,n,r){var e=r(1);e(e.S+e.F,"Object",{assign:r(172)})},function(t,n,r){var e=r(1);e(e.S,"Object",{create:r(70)})},function(t,n,r){var e=r(1);e(e.S+e.F*!r(10),"Object",{defineProperties:r(173)})},function(t,n,r){var e=r(1);e(e.S+e.F*!r(10),"Object",{defineProperty:r(11).f})},function(t,n,r){var e=r(6),i=r(65).onFreeze;r(49)("freeze",function(t){return function(n){return t&&e(n)?t(i(n)):n}})},function(t,n,r){var e=r(30),i=r(31).f;r(49)("getOwnPropertyDescriptor",function(){return function(t,n){return i(e(t),n)}})},function(t,n,r){r(49)("getOwnPropertyNames",function(){return r(174).f})},function(t,n,r){var e=r(17),i=r(32);r(49)("getPrototypeOf",function(){return function(t){return i(e(t))}})},function(t,n,r){var e=r(6);r(49)("isExtensible",function(t){return function(n){return!!e(n)&&(!t||t(n))}})},function(t,n,r){var e=r(6);r(49)("isFrozen",function(t){return function(n){return!e(n)||!!t&&t(n)}})},function(t,n,r){var e=r(6);r(49)("isSealed",function(t){return function(n){return!e(n)||!!t&&t(n)}})},function(t,n,r){var e=r(1);e(e.S,"Object",{is:r(180)})},function(t,n,r){var e=r(17),i=r(72);r(49)("keys",function(){return function(t){return i(e(t))}})},function(t,n,r){var e=r(6),i=r(65).onFreeze;r(49)("preventExtensions",function(t){return function(n){return t&&e(n)?t(i(n)):n}})},function(t,n,r){var e=r(6),i=r(65).onFreeze;r(49)("seal",function(t){return function(n){return t&&e(n)?t(i(n)):n}})},function(t,n,r){var e=r(1);e(e.S,"Object",{setPrototypeOf:r(144).set})},function(t,n,r){"use strict";var e=r(114),i={};i[r(7)("toStringTag")]="z",i+""!="[object z]"&&r(28)(Object.prototype,"toString",function(){return"[object "+e(this)+"]"},!0)},function(t,n,r){var e=r(1),i=r(178);e(e.G+e.F*(parseFloat!=i),{parseFloat:i})},function(t,n,r){var e=r(1),i=r(179);e(e.G+e.F*(parseInt!=i),{parseInt:i})},function(t,n,r){"use strict";var e,i,o,u=r(69),c=r(3),f=r(53),a=r(114),s=r(1),l=r(6),h=r(26),v=r(68),p=r(79),d=r(146),y=r(151).set,g=r(143)(),b="Promise",m=c.TypeError,x=c.process,w=c[b],x=c.process,S="process"==a(x),_=function(){},O=!!function(){try{var t=w.resolve(1),n=(t.constructor={})[r(7)("species")]=function(t){t(_,_)};return(S||"function"==typeof PromiseRejectionEvent)&&t.then(_)instanceof n}catch(t){}}(),E=function(t,n){return t===n||t===w&&n===o},P=function(t){var n;return!(!l(t)||"function"!=typeof(n=t.then))&&n},j=function(t){return E(w,t)?new F(t):new i(t)},F=i=function(t){var n,r;this.promise=new t(function(t,e){if(void 0!==n||void 0!==r)throw m("Bad Promise constructor");n=t,r=e}),this.resolve=h(n),this.reject=h(r)},M=function(t){try{t()}catch(t){return{error:t}}},A=function(t,n){if(!t._n){t._n=!0;var r=t._c;g(function(){for(var e=t._v,i=1==t._s,o=0;r.length>o;)!function(n){var r,o,u=i?n.ok:n.fail,c=n.resolve,f=n.reject,a=n.domain;try{u?(i||(2==t._h&&I(t),t._h=1),!0===u?r=e:(a&&a.enter(),r=u(e),a&&a.exit()),r===n.promise?f(m("Promise-chain cycle")):(o=P(r))?o.call(r,c,f):c(r)):f(e)}catch(t){f(t)}}(r[o++]);t._c=[],t._n=!1,n&&!t._h&&N(t)})}},N=function(t){y.call(c,function(){var n,r,e,i=t._v;if(T(t)&&(n=M(function(){S?x.emit("unhandledRejection",i,t):(r=c.onunhandledrejection)?r({promise:t,reason:i}):(e=c.console)&&e.error&&e.error("Unhandled promise rejection",i)}),t._h=S||T(t)?2:1),t._a=void 0,n)throw n.error})},T=function(t){if(1==t._h)return!1;for(var n,r=t._a||t._c,e=0;r.length>e;)if(n=r[e++],n.fail||!T(n.promise))return!1;return!0},I=function(t){y.call(c,function(){var n;S?x.emit("rejectionHandled",t):(n=c.onrejectionhandled)&&n({promise:t,reason:t._v})})},k=function(t){var n=this;n._d||(n._d=!0,n=n._w||n,n._v=t,n._s=2,n._a||(n._a=n._c.slice()),A(n,!0))},L=function(t){var n,r=this;if(!r._d){r._d=!0,r=r._w||r;try{if(r===t)throw m("Promise can't be resolved itself");(n=P(t))?g(function(){var e={_w:r,_d:!1};try{n.call(t,f(L,e,1),f(k,e,1))}catch(t){k.call(e,t)}}):(r._v=t,r._s=1,A(r,!1))}catch(t){k.call({_w:r,_d:!1},t)}}};O||(w=function(t){v(this,w,b,"_h"),h(t),e.call(this);try{t(f(L,this,1),f(k,this,1))}catch(t){k.call(this,t)}},e=function(t){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1},e.prototype=r(73)(w.prototype,{then:function(t,n){var r=j(d(this,w));return r.ok="function"!=typeof t||t,r.fail="function"==typeof n&&n,r.domain=S?x.domain:void 0,this._c.push(r),this._a&&this._a.push(r),this._s&&A(this,!1),r.promise},catch:function(t){return this.then(void 0,t)}}),F=function(){var t=new e;this.promise=t,this.resolve=f(L,t,1),this.reject=f(k,t,1)}),s(s.G+s.W+s.F*!O,{Promise:w}),r(81)(w,b),r(74)(b),o=r(52)[b],s(s.S+s.F*!O,b,{reject:function(t){var n=j(this);return(0,n.reject)(t),n.promise}}),s(s.S+s.F*(u||!O),b,{resolve:function(t){if(t instanceof w&&E(t.constructor,this))return t;var n=j(this);return(0,n.resolve)(t),n.promise}}),s(s.S+s.F*!(O&&r(123)(function(t){w.all(t).catch(_)})),b,{all:function(t){var n=this,r=j(n),e=r.resolve,i=r.reject,o=M(function(){var r=[],o=0,u=1;p(t,!1,function(t){var c=o++,f=!1;r.push(void 0),u++,n.resolve(t).then(function(t){f||(f=!0,r[c]=t,--u||e(r))},i)}),--u||e(r)});return o&&i(o.error),r.promise},race:function(t){var n=this,r=j(n),e=r.reject,i=M(function(){p(t,!1,function(t){n.resolve(t).then(r.resolve,e)})});return i&&e(i.error),r.promise}})},function(t,n,r){var e=r(1),i=r(26),o=r(2),u=(r(3).Reflect||{}).apply,c=Function.apply;e(e.S+e.F*!r(4)(function(){u(function(){})}),"Reflect",{apply:function(t,n,r){var e=i(t),f=o(r);return u?u(e,n,f):c.call(e,n,f)}})},function(t,n,r){var e=r(1),i=r(70),o=r(26),u=r(2),c=r(6),f=r(4),a=r(163),s=(r(3).Reflect||{}).construct,l=f(function(){function t(){}return!(s(function(){},[],t)instanceof t)}),h=!f(function(){s(function(){})});e(e.S+e.F*(l||h),"Reflect",{construct:function(t,n){o(t),u(n);var r=arguments.length<3?t:o(arguments[2]);if(h&&!l)return s(t,n,r);if(t==r){switch(n.length){case 0:return new t;case 1:return new t(n[0]);case 2:return new t(n[0],n[1]);case 3:return new t(n[0],n[1],n[2]);case 4:return new t(n[0],n[1],n[2],n[3])}var e=[null];return e.push.apply(e,n),new(a.apply(t,e))}var f=r.prototype,v=i(c(f)?f:Object.prototype),p=Function.apply.call(t,v,n);return c(p)?p:v}})},function(t,n,r){var e=r(11),i=r(1),o=r(2),u=r(50);i(i.S+i.F*r(4)(function(){Reflect.defineProperty(e.f({},1,{value:1}),1,{value:2})}),"Reflect",{defineProperty:function(t,n,r){o(t),n=u(n,!0),o(r);try{return e.f(t,n,r),!0}catch(t){return!1}}})},function(t,n,r){var e=r(1),i=r(31).f,o=r(2);e(e.S,"Reflect",{deleteProperty:function(t,n){var r=i(o(t),n);return!(r&&!r.configurable)&&delete t[n]}})},function(t,n,r){"use strict";var e=r(1),i=r(2),o=function(t){this._t=i(t),this._i=0;var n,r=this._k=[];for(n in t)r.push(n)};r(139)(o,"Object",function(){var t,n=this,r=n._k;do{if(n._i>=r.length)return{value:void 0,done:!0}}while(!((t=r[n._i++])in n._t));return{value:t,done:!1}}),e(e.S,"Reflect",{enumerate:function(t){return new o(t)}})},function(t,n,r){var e=r(31),i=r(1),o=r(2);i(i.S,"Reflect",{getOwnPropertyDescriptor:function(t,n){return e.f(o(t),n)}})},function(t,n,r){var e=r(1),i=r(32),o=r(2);e(e.S,"Reflect",{getPrototypeOf:function(t){return i(o(t))}})},function(t,n,r){function e(t,n){var r,c,s=arguments.length<3?t:arguments[2];return a(t)===s?t[n]:(r=i.f(t,n))?u(r,"value")?r.value:void 0!==r.get?r.get.call(s):void 0:f(c=o(t))?e(c,n,s):void 0}var i=r(31),o=r(32),u=r(24),c=r(1),f=r(6),a=r(2);c(c.S,"Reflect",{get:e})},function(t,n,r){var e=r(1);e(e.S,"Reflect",{has:function(t,n){return n in t}})},function(t,n,r){var e=r(1),i=r(2),o=Object.isExtensible;e(e.S,"Reflect",{isExtensible:function(t){return i(t),!o||o(t)}})},function(t,n,r){var e=r(1);e(e.S,"Reflect",{ownKeys:r(177)})},function(t,n,r){var e=r(1),i=r(2),o=Object.preventExtensions;e(e.S,"Reflect",{preventExtensions:function(t){i(t);try{return o&&o(t),!0}catch(t){return!1}}})},function(t,n,r){var e=r(1),i=r(144);i&&e(e.S,"Reflect",{setPrototypeOf:function(t,n){i.check(t,n);try{return i.set(t,n),!0}catch(t){return!1}}})},function(t,n,r){function e(t,n,r){var f,h,v=arguments.length<4?t:arguments[3],p=o.f(s(t),n);if(!p){if(l(h=u(t)))return e(h,n,r,v);p=a(0)}return c(p,"value")?!(!1===p.writable||!l(v)||(f=o.f(v,n)||a(0),f.value=r,i.f(v,n,f),0)):void 0!==p.set&&(p.set.call(v,r),!0)}var i=r(11),o=r(31),u=r(32),c=r(24),f=r(1),a=r(66),s=r(2),l=r(6);f(f.S,"Reflect",{set:e})},function(t,n,r){var e=r(3),i=r(136),o=r(11).f,u=r(71).f,c=r(122),f=r(120),a=e.RegExp,s=a,l=a.prototype,h=/a/g,v=/a/g,p=new a(h)!==h;if(r(10)&&(!p||r(4)(function(){return v[r(7)("match")]=!1,a(h)!=h||a(v)==v||"/a/i"!=a(h,"i")}))){a=function(t,n){var r=this instanceof a,e=c(t),o=void 0===n;return!r&&e&&t.constructor===a&&o?t:i(p?new s(e&&!o?t.source:t,n):s((e=t instanceof a)?t.source:t,e&&o?f.call(t):n),r?this:l,a)};for(var d=u(s),y=0;d.length>y;)!function(t){t in a||o(a,t,{configurable:!0,get:function(){return s[t]},set:function(n){s[t]=n}})}(d[y++]);l.constructor=a,a.prototype=l,r(28)(e,"RegExp",a)}r(74)("RegExp")},function(t,n,r){r(119)("match",1,function(t,n,r){return[function(r){"use strict";var e=t(this),i=void 0==r?void 0:r[n];return void 0!==i?i.call(r,e):new RegExp(r)[n](String(e))},r]})},function(t,n,r){r(119)("replace",2,function(t,n,r){return[function(e,i){"use strict";var o=t(this),u=void 0==e?void 0:e[n];return void 0!==u?u.call(e,o,i):r.call(String(o),e,i)},r]})},function(t,n,r){r(119)("search",1,function(t,n,r){return[function(r){"use strict";var e=t(this),i=void 0==r?void 0:r[n];return void 0!==i?i.call(r,e):new RegExp(r)[n](String(e))},r]})},function(t,n,r){r(119)("split",2,function(t,n,e){"use strict";var i=r(122),o=e,u=[].push,c="split",f="length",a="lastIndex";if("c"=="abbc"[c](/(b)*/)[1]||4!="test"[c](/(?:)/,-1)[f]||2!="ab"[c](/(?:ab)*/)[f]||4!="."[c](/(.?)(.?)/)[f]||"."[c](/()()/)[f]>1||""[c](/.?/)[f]){var s=void 0===/()??/.exec("")[1];e=function(t,n){var r=String(this);if(void 0===t&&0===n)return[];if(!i(t))return o.call(r,t,n);var e,c,l,h,v,p=[],d=(t.ignoreCase?"i":"")+(t.multiline?"m":"")+(t.unicode?"u":"")+(t.sticky?"y":""),y=0,g=void 0===n?4294967295:n>>>0,b=new RegExp(t.source,d+"g");for(s||(e=new RegExp("^"+b.source+"$(?!\\s)",d));(c=b.exec(r))&&!((l=c.index+c[0][f])>y&&(p.push(r.slice(y,c.index)),!s&&c[f]>1&&c[0].replace(e,function(){for(v=1;v<arguments[f]-2;v++)void 0===arguments[v]&&(c[v]=void 0)}),c[f]>1&&c.index<r[f]&&u.apply(p,c.slice(1)),h=c[0][f],y=l,p[f]>=g));)b[a]===c.index&&b[a]++;return y===r[f]?!h&&b.test("")||p.push(""):p.push(r.slice(y)),p[f]>g?p.slice(0,g):p}}else"0"[c](void 0,0)[f]&&(e=function(t,n){return void 0===t&&0===n?[]:o.call(this,t,n)});return[function(r,i){var o=t(this),u=void 0==r?void 0:r[n];return void 0!==u?u.call(r,o,i):e.call(String(o),r,i)},e]})},function(t,n,r){"use strict";r(184);var e=r(2),i=r(120),o=r(10),u="toString",c=/./[u],f=function(t){r(28)(RegExp.prototype,u,t,!0)};r(4)(function(){return"/a/b"!=c.call({source:"a",flags:"b"})})?f(function(){var t=e(this);return"/".concat(t.source,"/","flags"in t?t.flags:!o&&t instanceof RegExp?i.call(t):void 0)}):c.name!=u&&f(function(){return c.call(this)})},function(t,n,r){"use strict";r(29)("anchor",function(t){return function(n){return t(this,"a","name",n)}})},function(t,n,r){"use strict";r(29)("big",function(t){return function(){return t(this,"big","","")}})},function(t,n,r){"use strict";r(29)("blink",function(t){return function(){return t(this,"blink","","")}})},function(t,n,r){"use strict";r(29)("bold",function(t){return function(){return t(this,"b","","")}})},function(t,n,r){"use strict";var e=r(1),i=r(147)(!1);e(e.P,"String",{codePointAt:function(t){return i(this,t)}})},function(t,n,r){"use strict";var e=r(1),i=r(16),o=r(148),u="endsWith",c=""[u];e(e.P+e.F*r(134)(u),"String",{endsWith:function(t){var n=o(this,t,u),r=arguments.length>1?arguments[1]:void 0,e=i(n.length),f=void 0===r?e:Math.min(i(r),e),a=String(t);return c?c.call(n,a,f):n.slice(f-a.length,f)===a}})},function(t,n,r){"use strict";r(29)("fixed",function(t){return function(){return t(this,"tt","","")}})},function(t,n,r){"use strict";r(29)("fontcolor",function(t){return function(n){return t(this,"font","color",n)}})},function(t,n,r){"use strict";r(29)("fontsize",function(t){return function(n){return t(this,"font","size",n)}})},function(t,n,r){var e=r(1),i=r(75),o=String.fromCharCode,u=String.fromCodePoint;e(e.S+e.F*(!!u&&1!=u.length),"String",{fromCodePoint:function(t){for(var n,r=[],e=arguments.length,u=0;e>u;){if(n=+arguments[u++],i(n,1114111)!==n)throw RangeError(n+" is not a valid code point");r.push(n<65536?o(n):o(55296+((n-=65536)>>10),n%1024+56320))}return r.join("")}})},function(t,n,r){"use strict";var e=r(1),i=r(148),o="includes";e(e.P+e.F*r(134)(o),"String",{includes:function(t){return!!~i(this,t,o).indexOf(t,arguments.length>1?arguments[1]:void 0)}})},function(t,n,r){"use strict";r(29)("italics",function(t){return function(){return t(this,"i","","")}})},function(t,n,r){"use strict";var e=r(147)(!0);r(140)(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,n=this._t,r=this._i;return r>=n.length?{value:void 0,done:!0}:(t=e(n,r),this._i+=t.length,{value:t,done:!1})})},function(t,n,r){"use strict";r(29)("link",function(t){return function(n){return t(this,"a","href",n)}})},function(t,n,r){var e=r(1),i=r(30),o=r(16);e(e.S,"String",{raw:function(t){for(var n=i(t.raw),r=o(n.length),e=arguments.length,u=[],c=0;r>c;)u.push(String(n[c++])),c<e&&u.push(String(arguments[c]));return u.join("")}})},function(t,n,r){var e=r(1);e(e.P,"String",{repeat:r(149)})},function(t,n,r){"use strict";r(29)("small",function(t){return function(){return t(this,"small","","")}})},function(t,n,r){"use strict";var e=r(1),i=r(16),o=r(148),u="startsWith",c=""[u];e(e.P+e.F*r(134)(u),"String",{startsWith:function(t){var n=o(this,t,u),r=i(Math.min(arguments.length>1?arguments[1]:void 0,n.length)),e=String(t);return c?c.call(n,e,r):n.slice(r,r+e.length)===e}})},function(t,n,r){"use strict";r(29)("strike",function(t){return function(){return t(this,"strike","","")}})},function(t,n,r){"use strict";r(29)("sub",function(t){return function(){return t(this,"sub","","")}})},function(t,n,r){"use strict";r(29)("sup",function(t){return function(){return t(this,"sup","","")}})},function(t,n,r){"use strict";r(82)("trim",function(t){return function(){return t(this,3)}})},function(t,n,r){"use strict";var e=r(3),i=r(24),o=r(10),u=r(1),c=r(28),f=r(65).KEY,a=r(4),s=r(126),l=r(81),h=r(76),v=r(7),p=r(182),d=r(153),y=r(206),g=r(205),b=r(138),m=r(2),x=r(30),w=r(50),S=r(66),_=r(70),O=r(174),E=r(31),P=r(11),j=r(72),F=E.f,M=P.f,A=O.f,N=e.Symbol,T=e.JSON,I=T&&T.stringify,k="prototype",L=v("_hidden"),R=v("toPrimitive"),C={}.propertyIsEnumerable,D=s("symbol-registry"),U=s("symbols"),W=s("op-symbols"),G=Object[k],B="function"==typeof N,V=e.QObject,z=!V||!V[k]||!V[k].findChild,q=o&&a(function(){return 7!=_(M({},"a",{get:function(){return M(this,"a",{value:7}).a}})).a})?function(t,n,r){var e=F(G,n);e&&delete G[n],M(t,n,r),e&&t!==G&&M(G,n,e)}:M,K=function(t){var n=U[t]=_(N[k]);return n._k=t,n},J=B&&"symbol"==typeof N.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof N},Y=function(t,n,r){return t===G&&Y(W,n,r),m(t),n=w(n,!0),m(r),i(U,n)?(r.enumerable?(i(t,L)&&t[L][n]&&(t[L][n]=!1),r=_(r,{enumerable:S(0,!1)})):(i(t,L)||M(t,L,S(1,{})),t[L][n]=!0),q(t,n,r)):M(t,n,r)},H=function(t,n){m(t);for(var r,e=g(n=x(n)),i=0,o=e.length;o>i;)Y(t,r=e[i++],n[r]);return t},$=function(t,n){return void 0===n?_(t):H(_(t),n)},X=function(t){var n=C.call(this,t=w(t,!0));return!(this===G&&i(U,t)&&!i(W,t))&&(!(n||!i(this,t)||!i(U,t)||i(this,L)&&this[L][t])||n)},Q=function(t,n){if(t=x(t),n=w(n,!0),t!==G||!i(U,n)||i(W,n)){var r=F(t,n);return!r||!i(U,n)||i(t,L)&&t[L][n]||(r.enumerable=!0),r}},Z=function(t){for(var n,r=A(x(t)),e=[],o=0;r.length>o;)i(U,n=r[o++])||n==L||n==f||e.push(n);return e},tt=function(t){for(var n,r=t===G,e=A(r?W:x(t)),o=[],u=0;e.length>u;)!i(U,n=e[u++])||r&&!i(G,n)||o.push(U[n]);return o};B||(N=function(){if(this instanceof N)throw TypeError("Symbol is not a constructor!");var t=h(arguments.length>0?arguments[0]:void 0),n=function(r){this===G&&n.call(W,r),i(this,L)&&i(this[L],t)&&(this[L][t]=!1),q(this,t,S(1,r))};return o&&z&&q(G,t,{configurable:!0,set:n}),K(t)},c(N[k],"toString",function(){return this._k}),E.f=Q,P.f=Y,r(71).f=O.f=Z,r(116).f=X,r(125).f=tt,o&&!r(69)&&c(G,"propertyIsEnumerable",X,!0),p.f=function(t){return K(v(t))}),u(u.G+u.W+u.F*!B,{Symbol:N});for(var nt="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),rt=0;nt.length>rt;)v(nt[rt++]);for(var nt=j(v.store),rt=0;nt.length>rt;)d(nt[rt++]);u(u.S+u.F*!B,"Symbol",{for:function(t){return i(D,t+="")?D[t]:D[t]=N(t)},keyFor:function(t){if(J(t))return y(D,t);throw TypeError(t+" is not a symbol!")},useSetter:function(){z=!0},useSimple:function(){z=!1}}),u(u.S+u.F*!B,"Object",{create:$,defineProperty:Y,defineProperties:H,getOwnPropertyDescriptor:Q,getOwnPropertyNames:Z,getOwnPropertySymbols:tt}),T&&u(u.S+u.F*(!B||a(function(){var t=N();return"[null]"!=I([t])||"{}"!=I({a:t})||"{}"!=I(Object(t))})),"JSON",{stringify:function(t){if(void 0!==t&&!J(t)){for(var n,r,e=[t],i=1;arguments.length>i;)e.push(arguments[i++]);return n=e[1],"function"==typeof n&&(r=n),!r&&b(n)||(n=function(t,n){if(r&&(n=r.call(this,t,n)),!J(n))return n}),e[1]=n,I.apply(T,e)}}}),N[k][R]||r(27)(N[k],R,N[k].valueOf),l(N,"Symbol"),l(Math,"Math",!0),l(e.JSON,"JSON",!0)},function(t,n,r){"use strict";var e=r(1),i=r(127),o=r(152),u=r(2),c=r(75),f=r(16),a=r(6),s=r(3).ArrayBuffer,l=r(146),h=o.ArrayBuffer,v=o.DataView,p=i.ABV&&s.isView,d=h.prototype.slice,y=i.VIEW,g="ArrayBuffer";e(e.G+e.W+e.F*(s!==h),{ArrayBuffer:h}),e(e.S+e.F*!i.CONSTR,g,{isView:function(t){return p&&p(t)||a(t)&&y in t}}),e(e.P+e.U+e.F*r(4)(function(){return!new h(2).slice(1,void 0).byteLength}),g,{slice:function(t,n){if(void 0!==d&&void 0===n)return d.call(u(this),t);for(var r=u(this).byteLength,e=c(t,r),i=c(void 0===n?r:n,r),o=new(l(this,h))(f(i-e)),a=new v(this),s=new v(o),p=0;e<i;)s.setUint8(p++,a.getUint8(e++));return o}}),r(74)(g)},function(t,n,r){var e=r(1);e(e.G+e.W+e.F*!r(127).ABV,{DataView:r(152).DataView})},function(t,n,r){r(55)("Float32",4,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Float64",8,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Int16",2,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Int32",4,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Int8",1,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Uint16",2,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Uint32",4,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Uint8",1,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Uint8",1,function(t){return function(n,r,e){return t(this,n,r,e)}},!0)},function(t,n,r){"use strict";var e=r(166);r(118)("WeakSet",function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},{add:function(t){return e.def(this,t,!0)}},e,!1,!0)},function(t,n,r){"use strict";var e=r(1),i=r(117)(!0);e(e.P,"Array",{includes:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0)}}),r(78)("includes")},function(t,n,r){var e=r(1),i=r(143)(),o=r(3).process,u="process"==r(45)(o);e(e.G,{asap:function(t){var n=u&&o.domain;i(n?n.bind(t):t)}})},function(t,n,r){var e=r(1),i=r(45);e(e.S,"Error",{isError:function(t){return"Error"===i(t)}})},function(t,n,r){var e=r(1);e(e.P+e.R,"Map",{toJSON:r(165)("Map")})},function(t,n,r){var e=r(1);e(e.S,"Math",{iaddh:function(t,n,r,e){var i=t>>>0,o=n>>>0,u=r>>>0;return o+(e>>>0)+((i&u|(i|u)&~(i+u>>>0))>>>31)|0}})},function(t,n,r){var e=r(1);e(e.S,"Math",{imulh:function(t,n){var r=65535,e=+t,i=+n,o=e&r,u=i&r,c=e>>16,f=i>>16,a=(c*u>>>0)+(o*u>>>16);return c*f+(a>>16)+((o*f>>>0)+(a&r)>>16)}})},function(t,n,r){var e=r(1);e(e.S,"Math",{isubh:function(t,n,r,e){var i=t>>>0,o=n>>>0,u=r>>>0;return o-(e>>>0)-((~i&u|~(i^u)&i-u>>>0)>>>31)|0}})},function(t,n,r){var e=r(1);e(e.S,"Math",{umulh:function(t,n){var r=65535,e=+t,i=+n,o=e&r,u=i&r,c=e>>>16,f=i>>>16,a=(c*u>>>0)+(o*u>>>16);return c*f+(a>>>16)+((o*f>>>0)+(a&r)>>>16)}})},function(t,n,r){"use strict";var e=r(1),i=r(17),o=r(26),u=r(11);r(10)&&e(e.P+r(124),"Object",{__defineGetter__:function(t,n){u.f(i(this),t,{get:o(n),enumerable:!0,configurable:!0})}})},function(t,n,r){"use strict";var e=r(1),i=r(17),o=r(26),u=r(11);r(10)&&e(e.P+r(124),"Object",{__defineSetter__:function(t,n){u.f(i(this),t,{set:o(n),enumerable:!0,configurable:!0})}})},function(t,n,r){var e=r(1),i=r(176)(!0);e(e.S,"Object",{entries:function(t){return i(t)}})},function(t,n,r){var e=r(1),i=r(177),o=r(30),u=r(31),c=r(131);e(e.S,"Object",{getOwnPropertyDescriptors:function(t){for(var n,r=o(t),e=u.f,f=i(r),a={},s=0;f.length>s;)c(a,n=f[s++],e(r,n));return a}})},function(t,n,r){"use strict";var e=r(1),i=r(17),o=r(50),u=r(32),c=r(31).f;r(10)&&e(e.P+r(124),"Object",{__lookupGetter__:function(t){var n,r=i(this),e=o(t,!0);do{if(n=c(r,e))return n.get}while(r=u(r))}})},function(t,n,r){"use strict";var e=r(1),i=r(17),o=r(50),u=r(32),c=r(31).f;r(10)&&e(e.P+r(124),"Object",{__lookupSetter__:function(t){var n,r=i(this),e=o(t,!0);do{if(n=c(r,e))return n.set}while(r=u(r))}})},function(t,n,r){var e=r(1),i=r(176)(!1);e(e.S,"Object",{values:function(t){return i(t)}})},function(t,n,r){"use strict";var e=r(1),i=r(3),o=r(52),u=r(143)(),c=r(7)("observable"),f=r(26),a=r(2),s=r(68),l=r(73),h=r(27),v=r(79),p=v.RETURN,d=function(t){return null==t?void 0:f(t)},y=function(t){var n=t._c;n&&(t._c=void 0,n())},g=function(t){return void 0===t._o},b=function(t){g(t)||(t._o=void 0,y(t))},m=function(t,n){a(t),this._c=void 0,this._o=t,t=new x(this);try{var r=n(t),e=r;null!=r&&("function"==typeof r.unsubscribe?r=function(){e.unsubscribe()}:f(r),this._c=r)}catch(n){return void t.error(n)}g(this)&&y(this)};m.prototype=l({},{unsubscribe:function(){b(this)}});var x=function(t){this._s=t};x.prototype=l({},{next:function(t){var n=this._s;if(!g(n)){var r=n._o;try{var e=d(r.next);if(e)return e.call(r,t)}catch(t){try{b(n)}finally{throw t}}}},error:function(t){var n=this._s;if(g(n))throw t;var r=n._o;n._o=void 0;try{var e=d(r.error);if(!e)throw t;t=e.call(r,t)}catch(t){try{y(n)}finally{throw t}}return y(n),t},complete:function(t){var n=this._s;if(!g(n)){var r=n._o;n._o=void 0;try{var e=d(r.complete);t=e?e.call(r,t):void 0}catch(t){try{y(n)}finally{throw t}}return y(n),t}}});var w=function(t){s(this,w,"Observable","_f")._f=f(t)};l(w.prototype,{subscribe:function(t){return new m(t,this._f)},forEach:function(t){var n=this;return new(o.Promise||i.Promise)(function(r,e){f(t);var i=n.subscribe({next:function(n){try{return t(n)}catch(t){e(t),i.unsubscribe()}},error:e,complete:r})})}}),l(w,{from:function(t){var n="function"==typeof this?this:w,r=d(a(t)[c]);if(r){var e=a(r.call(t));return e.constructor===n?e:new n(function(t){return e.subscribe(t)})}return new n(function(n){var r=!1;return u(function(){if(!r){try{if(v(t,!1,function(t){if(n.next(t),r)return p})===p)return}catch(t){if(r)throw t;return void n.error(t)}n.complete()}}),function(){r=!0}})},of:function(){for(var t=0,n=arguments.length,r=Array(n);t<n;)r[t]=arguments[t++];return new("function"==typeof this?this:w)(function(t){var n=!1;return u(function(){if(!n){for(var e=0;e<r.length;++e)if(t.next(r[e]),n)return;t.complete()}}),function(){n=!0}})}}),h(w.prototype,c,function(){return this}),e(e.G,{Observable:w}),r(74)("Observable")},function(t,n,r){var e=r(54),i=r(2),o=e.key,u=e.set;e.exp({defineMetadata:function(t,n,r,e){u(t,n,i(r),o(e))}})},function(t,n,r){var e=r(54),i=r(2),o=e.key,u=e.map,c=e.store;e.exp({deleteMetadata:function(t,n){var r=arguments.length<3?void 0:o(arguments[2]),e=u(i(n),r,!1);if(void 0===e||!e.delete(t))return!1;if(e.size)return!0;var f=c.get(n);return f.delete(r),!!f.size||c.delete(n)}})},function(t,n,r){var e=r(185),i=r(161),o=r(54),u=r(2),c=r(32),f=o.keys,a=o.key,s=function(t,n){var r=f(t,n),o=c(t);if(null===o)return r;var u=s(o,n);return u.length?r.length?i(new e(r.concat(u))):u:r};o.exp({getMetadataKeys:function(t){return s(u(t),arguments.length<2?void 0:a(arguments[1]))}})},function(t,n,r){var e=r(54),i=r(2),o=r(32),u=e.has,c=e.get,f=e.key,a=function(t,n,r){if(u(t,n,r))return c(t,n,r);var e=o(n);return null!==e?a(t,e,r):void 0};e.exp({getMetadata:function(t,n){return a(t,i(n),arguments.length<3?void 0:f(arguments[2]))}})},function(t,n,r){var e=r(54),i=r(2),o=e.keys,u=e.key;e.exp({getOwnMetadataKeys:function(t){
return o(i(t),arguments.length<2?void 0:u(arguments[1]))}})},function(t,n,r){var e=r(54),i=r(2),o=e.get,u=e.key;e.exp({getOwnMetadata:function(t,n){return o(t,i(n),arguments.length<3?void 0:u(arguments[2]))}})},function(t,n,r){var e=r(54),i=r(2),o=r(32),u=e.has,c=e.key,f=function(t,n,r){if(u(t,n,r))return!0;var e=o(n);return null!==e&&f(t,e,r)};e.exp({hasMetadata:function(t,n){return f(t,i(n),arguments.length<3?void 0:c(arguments[2]))}})},function(t,n,r){var e=r(54),i=r(2),o=e.has,u=e.key;e.exp({hasOwnMetadata:function(t,n){return o(t,i(n),arguments.length<3?void 0:u(arguments[2]))}})},function(t,n,r){var e=r(54),i=r(2),o=r(26),u=e.key,c=e.set;e.exp({metadata:function(t,n){return function(r,e){c(t,n,(void 0!==e?i:o)(r),u(e))}}})},function(t,n,r){var e=r(1);e(e.P+e.R,"Set",{toJSON:r(165)("Set")})},function(t,n,r){"use strict";var e=r(1),i=r(147)(!0);e(e.P,"String",{at:function(t){return i(this,t)}})},function(t,n,r){"use strict";var e=r(1),i=r(46),o=r(16),u=r(122),c=r(120),f=RegExp.prototype,a=function(t,n){this._r=t,this._s=n};r(139)(a,"RegExp String",function(){var t=this._r.exec(this._s);return{value:t,done:null===t}}),e(e.P,"String",{matchAll:function(t){if(i(this),!u(t))throw TypeError(t+" is not a regexp!");var n=String(this),r="flags"in f?String(t.flags):c.call(t),e=new RegExp(t.source,~r.indexOf("g")?r:"g"+r);return e.lastIndex=o(t.lastIndex),new a(e,n)}})},function(t,n,r){"use strict";var e=r(1),i=r(181);e(e.P,"String",{padEnd:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0,!1)}})},function(t,n,r){"use strict";var e=r(1),i=r(181);e(e.P,"String",{padStart:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0,!0)}})},function(t,n,r){"use strict";r(82)("trimLeft",function(t){return function(){return t(this,1)}},"trimStart")},function(t,n,r){"use strict";r(82)("trimRight",function(t){return function(){return t(this,2)}},"trimEnd")},function(t,n,r){r(153)("asyncIterator")},function(t,n,r){r(153)("observable")},function(t,n,r){var e=r(1);e(e.S,"System",{global:r(3)})},function(t,n,r){for(var e=r(155),i=r(28),o=r(3),u=r(27),c=r(80),f=r(7),a=f("iterator"),s=f("toStringTag"),l=c.Array,h=["NodeList","DOMTokenList","MediaList","StyleSheetList","CSSRuleList"],v=0;v<5;v++){var p,d=h[v],y=o[d],g=y&&y.prototype;if(g){g[a]||u(g,a,l),g[s]||u(g,s,d),c[d]=l;for(p in e)g[p]||i(g,p,e[p],!0)}}},function(t,n,r){var e=r(1),i=r(151);e(e.G+e.B,{setImmediate:i.set,clearImmediate:i.clear})},function(t,n,r){var e=r(3),i=r(1),o=r(121),u=r(207),c=e.navigator,f=!!c&&/MSIE .\./.test(c.userAgent),a=function(t){return f?function(n,r){return t(o(u,[].slice.call(arguments,2),"function"==typeof n?n:Function(n)),r)}:t};i(i.G+i.B+i.F*f,{setTimeout:a(e.setTimeout),setInterval:a(e.setInterval)})},function(t,n,r){r(330),r(269),r(271),r(270),r(273),r(275),r(280),r(274),r(272),r(282),r(281),r(277),r(278),r(276),r(268),r(279),r(283),r(284),r(236),r(238),r(237),r(286),r(285),r(256),r(266),r(267),r(257),r(258),r(259),r(260),r(261),r(262),r(263),r(264),r(265),r(239),r(240),r(241),r(242),r(243),r(244),r(245),r(246),r(247),r(248),r(249),r(250),r(251),r(252),r(253),r(254),r(255),r(317),r(322),r(329),r(320),r(312),r(313),r(318),r(323),r(325),r(308),r(309),r(310),r(311),r(314),r(315),r(316),r(319),r(321),r(324),r(326),r(327),r(328),r(231),r(233),r(232),r(235),r(234),r(220),r(218),r(224),r(221),r(227),r(229),r(217),r(223),r(214),r(228),r(212),r(226),r(225),r(219),r(222),r(211),r(213),r(216),r(215),r(230),r(155),r(302),r(307),r(184),r(303),r(304),r(305),r(306),r(287),r(183),r(185),r(186),r(342),r(331),r(332),r(337),r(340),r(341),r(335),r(338),r(336),r(339),r(333),r(334),r(288),r(289),r(290),r(291),r(292),r(295),r(293),r(294),r(296),r(297),r(298),r(299),r(301),r(300),r(343),r(369),r(372),r(371),r(373),r(374),r(370),r(375),r(376),r(354),r(357),r(353),r(351),r(352),r(355),r(356),r(346),r(368),r(377),r(345),r(347),r(349),r(348),r(350),r(359),r(360),r(362),r(361),r(364),r(363),r(365),r(366),r(367),r(344),r(358),r(380),r(379),r(378),t.exports=r(52)},function(t,n){function r(t,n){if("string"==typeof n)return t.insertAdjacentHTML("afterend",n);var r=t.nextSibling;return r?t.parentNode.insertBefore(n,r):t.parentNode.appendChild(n)}t.exports=r},,,,,,,,,function(t,n,r){(function(n,r){!function(n){"use strict";function e(t,n,r,e){var i=n&&n.prototype instanceof o?n:o,u=Object.create(i.prototype),c=new p(e||[]);return u._invoke=s(t,r,c),u}function i(t,n,r){try{return{type:"normal",arg:t.call(n,r)}}catch(t){return{type:"throw",arg:t}}}function o(){}function u(){}function c(){}function f(t){["next","throw","return"].forEach(function(n){t[n]=function(t){return this._invoke(n,t)}})}function a(t){function n(r,e,o,u){var c=i(t[r],t,e);if("throw"!==c.type){var f=c.arg,a=f.value;return a&&"object"==typeof a&&m.call(a,"__await")?Promise.resolve(a.__await).then(function(t){n("next",t,o,u)},function(t){n("throw",t,o,u)}):Promise.resolve(a).then(function(t){f.value=t,o(f)},u)}u(c.arg)}function e(t,r){function e(){return new Promise(function(e,i){n(t,r,e,i)})}return o=o?o.then(e,e):e()}"object"==typeof r&&r.domain&&(n=r.domain.bind(n));var o;this._invoke=e}function s(t,n,r){var e=P;return function(o,u){if(e===F)throw new Error("Generator is already running");if(e===M){if("throw"===o)throw u;return y()}for(r.method=o,r.arg=u;;){var c=r.delegate;if(c){var f=l(c,r);if(f){if(f===A)continue;return f}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(e===P)throw e=M,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);e=F;var a=i(t,n,r);if("normal"===a.type){if(e=r.done?M:j,a.arg===A)continue;return{value:a.arg,done:r.done}}"throw"===a.type&&(e=M,r.method="throw",r.arg=a.arg)}}}function l(t,n){var r=t.iterator[n.method];if(r===g){if(n.delegate=null,"throw"===n.method){if(t.iterator.return&&(n.method="return",n.arg=g,l(t,n),"throw"===n.method))return A;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return A}var e=i(r,t.iterator,n.arg);if("throw"===e.type)return n.method="throw",n.arg=e.arg,n.delegate=null,A;var o=e.arg;return o?o.done?(n[t.resultName]=o.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=g),n.delegate=null,A):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,A)}function h(t){var n={tryLoc:t[0]};1 in t&&(n.catchLoc=t[1]),2 in t&&(n.finallyLoc=t[2],n.afterLoc=t[3]),this.tryEntries.push(n)}function v(t){var n=t.completion||{};n.type="normal",delete n.arg,t.completion=n}function p(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(h,this),this.reset(!0)}function d(t){if(t){var n=t[w];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,e=function n(){for(;++r<t.length;)if(m.call(t,r))return n.value=t[r],n.done=!1,n;return n.value=g,n.done=!0,n};return e.next=e}}return{next:y}}function y(){return{value:g,done:!0}}var g,b=Object.prototype,m=b.hasOwnProperty,x="function"==typeof Symbol?Symbol:{},w=x.iterator||"@@iterator",S=x.asyncIterator||"@@asyncIterator",_=x.toStringTag||"@@toStringTag",O="object"==typeof t,E=n.regeneratorRuntime;if(E)return void(O&&(t.exports=E));E=n.regeneratorRuntime=O?t.exports:{},E.wrap=e;var P="suspendedStart",j="suspendedYield",F="executing",M="completed",A={},N={};N[w]=function(){return this};var T=Object.getPrototypeOf,I=T&&T(T(d([])));I&&I!==b&&m.call(I,w)&&(N=I);var k=c.prototype=o.prototype=Object.create(N);u.prototype=k.constructor=c,c.constructor=u,c[_]=u.displayName="GeneratorFunction",E.isGeneratorFunction=function(t){var n="function"==typeof t&&t.constructor;return!!n&&(n===u||"GeneratorFunction"===(n.displayName||n.name))},E.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,c):(t.__proto__=c,_ in t||(t[_]="GeneratorFunction")),t.prototype=Object.create(k),t},E.awrap=function(t){return{__await:t}},f(a.prototype),a.prototype[S]=function(){return this},E.AsyncIterator=a,E.async=function(t,n,r,i){var o=new a(e(t,n,r,i));return E.isGeneratorFunction(n)?o:o.next().then(function(t){return t.done?t.value:o.next()})},f(k),k[_]="Generator",k.toString=function(){return"[object Generator]"},E.keys=function(t){var n=[];for(var r in t)n.push(r);return n.reverse(),function r(){for(;n.length;){var e=n.pop();if(e in t)return r.value=e,r.done=!1,r}return r.done=!0,r}},E.values=d,p.prototype={constructor:p,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=g,this.done=!1,this.delegate=null,this.method="next",this.arg=g,this.tryEntries.forEach(v),!t)for(var n in this)"t"===n.charAt(0)&&m.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=g)},stop:function(){this.done=!0;var t=this.tryEntries[0],n=t.completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(t){function n(n,e){return o.type="throw",o.arg=t,r.next=n,e&&(r.method="next",r.arg=g),!!e}if(this.done)throw t;for(var r=this,e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e],o=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var u=m.call(i,"catchLoc"),c=m.call(i,"finallyLoc");if(u&&c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,n){for(var r=this.tryEntries.length-1;r>=0;--r){var e=this.tryEntries[r];if(e.tryLoc<=this.prev&&m.call(e,"finallyLoc")&&this.prev<e.finallyLoc){var i=e;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=n&&n<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=t,o.arg=n,i?(this.method="next",this.next=i.finallyLoc,A):this.complete(o)},complete:function(t,n){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&n&&(this.next=n),A},finish:function(t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),v(r),A}},catch:function(t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc===t){var e=r.completion;if("throw"===e.type){var i=e.arg;v(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:d(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=g),A}}}("object"==typeof n?n:"object"==typeof window?window:"object"==typeof self?self:this)}).call(n,function(){return this}(),r(158))}])</script><script src="/./main.0cf68a.js"></script><script>!function(){!function(e){var t=document.createElement("script");document.getElementsByTagName("body")[0].appendChild(t),t.setAttribute("src",e)}("/slider.e37972.js")}()</script>


    
<div class="tools-col" q-class="show:isShow,hide:isShow|isFalse" q-on="click:stop(e)">
  <div class="tools-nav header-menu">
    
    
      
      
      
    
      
      
      
    
      
      
      
    
    

    <ul style="width: 70%">
    
    
      
      <li style="width: 33.333333333333336%" q-on="click: openSlider(e, 'innerArchive')"><a href="javascript:void(0)" q-class="active:innerArchive">所有文章</a></li>
      
        
      
      <li style="width: 33.333333333333336%" q-on="click: openSlider(e, 'friends')"><a href="javascript:void(0)" q-class="active:friends">友链</a></li>
      
        
      
      <li style="width: 33.333333333333336%" q-on="click: openSlider(e, 'aboutme')"><a href="javascript:void(0)" q-class="active:aboutme">关于我</a></li>
      
        
    </ul>
  </div>
  <div class="tools-wrap">
    
    	<section class="tools-section tools-section-all" q-show="innerArchive">
        <div class="search-wrap">
          <input class="search-ipt" q-model="search" type="text" placeholder="find something…">
          <i class="icon-search icon" q-show="search|isEmptyStr"></i>
          <i class="icon-close icon" q-show="search|isNotEmptyStr" q-on="click:clearChose(e)"></i>
        </div>
        <div class="widget tagcloud search-tag">
          <p class="search-tag-wording">tag:</p>
          <label class="search-switch">
            <input type="checkbox" q-on="click:toggleTag(e)" q-attr="checked:showTags">
          </label>
          <ul class="article-tag-list" q-show="showTags">
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color2">Celery</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">爬虫</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">BS4</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">数据提取</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color1">linux</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">服务器</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">定时</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">GIT</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">MongoDB</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">数据库</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color1">redis</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">python操作</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">Scrapyd</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">部署</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color2">python</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">扩展包</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color1">xpath</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">多线程</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">json</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color1">Flask</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color1">web后端</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color1">MySql</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">协程</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">aiohttp</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color2">Scrapy</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">信号</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">Selenium</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color1">jieba</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">正则</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">日志</a>
              </li>
            
            <div class="clearfix"></div>
          </ul>
        </div>
        <ul class="search-ul">
          <p q-show="jsonFail" style="padding: 20px; font-size: 12px;">
            缺失模块。<br/>1、请确保node版本大于6.2<br/>2、在博客根目录（注意不是yilia根目录）执行以下命令：<br/> npm i hexo-generator-json-content --save<br/><br/>
            3、在根目录_config.yml里添加配置：
<pre style="font-size: 12px;" q-show="jsonFail">
  jsonContent:
    meta: false
    pages: false
    posts:
      title: true
      date: true
      path: true
      text: false
      raw: false
      content: false
      slug: false
      updated: false
      comments: false
      link: false
      permalink: false
      excerpt: false
      categories: false
      tags: true
</pre>
          </p>
          <li class="search-li" q-repeat="items" q-show="isShow">
            <a q-attr="href:path|urlformat" class="search-title"><i class="icon-quo-left icon"></i><span q-text="title"></span></a>
            <p class="search-time">
              <i class="icon-calendar icon"></i>
              <span q-text="date|dateformat"></span>
            </p>
            <p class="search-tag">
              <i class="icon-price-tags icon"></i>
              <span q-repeat="tags" q-on="click:choseTag(e, name)" q-text="name|tagformat"></span>
            </p>
          </li>
        </ul>
    	</section>
    

    
    	<section class="tools-section tools-section-friends" q-show="friends">
  		
        <ul class="search-ul">
          
            <li class="search-li">
              <a href="http://localhost:4000/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>友情链接1</a>
            </li>
          
            <li class="search-li">
              <a href="http://localhost:4000/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>友情链接2</a>
            </li>
          
            <li class="search-li">
              <a href="http://localhost:4000/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>友情链接3</a>
            </li>
          
            <li class="search-li">
              <a href="http://localhost:4000/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>友情链接4</a>
            </li>
          
            <li class="search-li">
              <a href="http://localhost:4000/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>友情链接5</a>
            </li>
          
            <li class="search-li">
              <a href="http://localhost:4000/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>友情链接6</a>
            </li>
          
        </ul>
  		
    	</section>
    

    
    	<section class="tools-section tools-section-me" q-show="aboutme">
  	  	
  	  		<div class="aboutme-wrap" id="js-aboutme">你好&lt;br&gt;&lt;br&gt;我是帅比萌木盖，爱搞机&lt;br&gt;欢迎观看&lt;br&gt;如想联系：grmg@foxmail.com</div>
  	  	
    	</section>
    
  </div>
  
</div>
    <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>
  </div>
</body>
</html>